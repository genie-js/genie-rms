void *__thiscall TRIBE_RMM_Script_Controller__constructor(void *this_, int a2, int a3);
void *__thiscall RandomMapScript__destructor(void *Memory, char a2);
int sub_534C80(void); // weak
char __thiscall _RandomMapScript__sub_534EC0_placing_players_maybe(int this_);
char __thiscall _rms__type_0x2A_5353E0(int this_, int a2);
int __thiscall RGE_RMM_Terrain_Generator__constructor(int this_, int a2, int a3, const void *a4);
int sub_535470(void); // weak
char __thiscall sub_535480(int this_);
bool __stdcall sub_535580(bool a1);
int __thiscall sub_5355B0(int this_);
char __thiscall sub_535970(int this_, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14);
int __thiscall sub_535B20(int this_);
double __stdcall sub_535C20(int a1, int a2, int a3, int a4);
int __thiscall sub_535C40(int this_, int a2, int a3);
char __thiscall sub_535D20(int this_, signed int a2, int a3, char a4, signed int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12);
int __thiscall sub_536580(int this_, const char *a2, const char *a3, const char *a4, const char *Filename);
void *__thiscall sub_5365B0(void *Memory, char a2);
int sub_5365D0(void); // weak
int __thiscall sub_5365E0(int this_, int hFile);
char __thiscall sub_536600(void *this_, int a2, int a3, unsigned __int8 a4, int a5, int a6);
char __thiscall sub_536640(int this_);
void __thiscall sub_536650(int this_, char a2);
void __thiscall sub_536970(int this_);
void __thiscall sub_536B20(int this_);
void __thiscall sub_537210(int this_);
void __thiscall sub_5372A0(void *this_);
int __thiscall RGE_RMM_Shallows_Generator__constructor(int this_, int a2, int a3, const void *a4);
char __thiscall RGE_RMM_Shallows_Generator__sub_537440(int this_);
int __thiscall RGE_RMM_Shallows_Generator__sub_5374E0(void *this_, int a2, float a3, int a4);
void *__thiscall RGE_RMM_Script_Controller__constructor(void *this_, const char *a2, int a3);
void *__thiscall RGE_RMM_Script_Controller__destructor(void *Memory, char a2);
void __thiscall sub_537950(int this_);
char __thiscall RandomMapScript__generate(int this_);
signed int __thiscall _RandomMapScript__reset(int this_);
int __thiscall sub_537E00(int this_);
char __thiscall _RandomMapScript__sub_5386A0_if_teams_together(int this_);
int __thiscall RGE_RMM_Script_Controller__sub_538A10(void *this_);
void *__thiscall sub_539230(void *this_, int a2, const char *a3);
int __thiscall sub_5392D0(int this_, const char *a2, char a3);
bool __stdcall sub_539540(FILE *File, int a2);
bool __thiscall sub_539560(int this_, FILE *File, int a3);
bool __thiscall sub_539610(void *this_, FILE *File, int a3);
char __thiscall sub_5396A0(void *this_, FILE *File, char *a3);
bool __thiscall sub_5398A0(void *this_, FILE *File, char *a3);
bool __thiscall sub_539940(void *this_, FILE *File, int a3);
void __thiscall sub_5399C0(void *this_, int a2, char a3, int a4, char a5, char a6, char a7, char a8);
void __thiscall sub_539AA0(void *this_, int a2, int a3, char a4, char a5, char a6, char a7);
void __thiscall sub_539AE0(void *this_, int a2, char a3, int a4, char a5, char a6, char a7, char a8);
int __stdcall sub_539BB0(int a1, signed int a2, char a3);
signed int __stdcall sub_539C70(int a1, int a2);
int __thiscall sub_539CF0(int this_, int a2);
void __stdcall sub_539D30(void **a1);
char __thiscall sub_539D80(void *this_, FILE *File, int a3);
int __thiscall sub_53A650(int this_, int a2);
char __stdcall _rms__type_0xB_53A740(int a1);
char __thiscall _rms__type_0x11_53A770(int this_, int a2);
int __thiscall sub_53AEF0(int this_, int a2, int a3);
char __thiscall _rms__sub_53AFB0(RandomMapScript* this_, int a2);
char __thiscall _rms__type_0x22_53B2B0(int this_, int a2);
char __thiscall _rms__type_0x2F_53B380(int this_, int a2);
char __thiscall _rms__type_0x3E_53B930(int this_, int a2);
char __thiscall _rms__type_0x4F_53BB70(int this_, int a2);
int __thiscall RGE_RMM_Objects_Generator__constructor(int this_, int a2, int a3, int a4, const void *a5, char a6);
int __thiscall RGE_RMM_Objects_Generator__sub_53BFF0(int this_, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9);
char __fastcall sub_53C1B0(int a1);
int __thiscall sub_53C260(int this_, int a2);
int __thiscall sub_53C340(int this_, int a2, __int64 a3, int a4, int a5);
char __thiscall sub_53C500(int this_, int a2, int a3, int a4);
void __thiscall sub_53C560(int this_, int a2, int a3, int a4, char a5, int a6);
int __thiscall sub_53C680(void *this_, int a2, int a3, int a4);
int __thiscall sub_53C720(void *this_, int a2, int a3);
int __thiscall sub_53C9D0(void *this_, int a2);
char __thiscall sub_53CC60(int this_, int a2, __int64 a3, int a4, int a5, int a6);
int __thiscall sub_53D1B0(void *this_, int a2, __int64 a3, int a4);
int __thiscall sub_53D370(void *this_, int a2, int a3, int a4, int a5);
bool __thiscall sub_53D710(int this_, int a2, int a3, int a4, int a5);
char __thiscall sub_53D820(int this_, int a2, int a3);
char __thiscall sub_53D870(int this_, int a2, int a3, int a4, int a5);
int __thiscall RGE_RMM_Land_Generator__constructor(int this_, int a2, int a3, const void *a4);
char __thiscall sub_53DB30(int this_);
char __thiscall sub_53DBB0(void *this_, int a2, unsigned __int8 a3, int a4, int a5);
char __thiscall sub_53DD90(void *this_, int a2, int a3, int a4);
char __thiscall sub_53DEA0(int this_);
int __thiscall RGE_RMM_Elevation_Generator__constructor(int this_, int a2, int a3, const void *a4);
char __thiscall sub_53E570(int this_);
char __thiscall sub_53E620(int this_, int a2, int a3, char a4, unsigned __int8 a5, unsigned __int8 a6);
char __thiscall sub_53E6E0(int this_, char a2, int a3, int a4, int a5, char a6, unsigned __int8 a7);
int __thiscall sub_53E840(int this_);
double __stdcall sub_53E940(int a1, int a2, int a3);
int __thiscall sub_53E960(void *this_, int a2, char a3, char a4);
int __thiscall sub_53EA10(int this_, int a2, int a3, int a4);
char __thiscall sub_53EA90(int this_, signed int a2, char a3, signed int a4, int a5, unsigned int a6, char a7);
int __thiscall sub_53EF60(int this_, const char *a2, const char *a3, const char *a4, const char *Filename);
void *__thiscall sub_53F3F0(void *Memory, char a2);

//----- (00534C40) --------------------------------------------------------
void *__thiscall TRIBE_RMM_Script_Controller__constructor(void *this, const char* filename, int drs_id)
{
  RGE_RMM_Script_Controller__constructor(this, filename, drs_id);
  *this = &vtbl_rms_64035C;
  return this;
}
// 64035C: using guessed type int (__thiscall *vtbl_rms_64035C)(void *Memory, char);

//----- (00534C60) --------------------------------------------------------
void *__thiscall RandomMapScript__destructor(void *Memory, char a2)
{
  void *v2; // esi@1

  v2 = Memory;
  sub_534C80();
  if ( a2 & 1 )
    operator delete(v2);
  return v2;
}
// 534C80: using guessed type int sub_534C80(void);

//----- (00534C90) --------------------------------------------------------
// #error "534CAC: switch analysis failed (funcsize=65)"

//----- (00534D52) --------------------------------------------------------
// #error "534D6A: positive sp value has been found (funcsize=9)"

//----- (00534EC0) --------------------------------------------------------
char __thiscall _RandomMapScript__sub_534EC0_placing_players_maybe(int this)
{
  int this; // ebx@1
  signed int v2; // ebp@1
  signed int v3; // edi@2
  signed int v4; // esi@3
  int v6; // eax@9
  int v7; // esi@9
  int v8; // ebp@9
  signed int v9; // edi@9
  int v10; // edx@10
  int v11; // ebx@10
  int v12; // eax@12
  int v13; // ecx@14
  int v14; // eax@14
  int v15; // eax@16
  int v16; // eax@18
  bool v17; // zf@20
  int v18; // ebx@23
  int v19; // ecx@23
  int v20; // ebp@23
  char *v21; // esi@23
  int v22; // eax@23
  signed int v23; // edi@23
  int v24; // eax@24
  char *v25; // eax@27
  signed int v26; // ecx@27
  unsigned int v27; // ecx@33
  int v28; // edx@34
  unsigned int v29; // ecx@34
  char *v30; // edi@34
  int i; // ecx@34
  int v32; // eax@37
  signed int v33; // edx@37
  int v34; // edi@37
  int v35; // eax@39
  int v36; // esi@39
  int v37; // ebx@42
  char *v38; // esi@43
  int v39; // eax@47
  int v40; // ecx@49
  int v41; // esi@58
  int v42; // ecx@60
  int v43; // edi@61
  int v44; // edi@64
  char v45; // [sp+13h] [bp-251h]@24
  int v46; // [sp+14h] [bp-250h]@10
  char *v47; // [sp+14h] [bp-250h]@37
  int v48; // [sp+14h] [bp-250h]@58
  int v49; // [sp+18h] [bp-24Ch]@10
  char *v50; // [sp+18h] [bp-24Ch]@38
  char *v51; // [sp+18h] [bp-24Ch]@58
  int v52; // [sp+1Ch] [bp-248h]@1
  int v53; // [sp+20h] [bp-244h]@9
  int v54; // [sp+24h] [bp-240h]@23
  int v55; // [sp+28h] [bp-23Ch]@9
  signed int v56; // [sp+2Ch] [bp-238h]@37
  int v57; // [sp+2Ch] [bp-238h]@57
  int v58; // [sp+30h] [bp-234h]@23
  int v59; // [sp+34h] [bp-230h]@43
  int v60; // [sp+38h] [bp-22Ch]@38
  signed int v61; // [sp+3Ch] [bp-228h]@38
  signed int v62; // [sp+40h] [bp-224h]@23
  int v63; // [sp+44h] [bp-220h]@23
  int v64; // [sp+48h] [bp-21Ch]@23
  int v65; // [sp+4Ch] [bp-218h]@39
  int v66; // [sp+50h] [bp-214h]@23
  char v67; // [sp+54h] [bp-210h]@23
  char v68[100]; // [sp+74h] [bp-1F0h]@34
  char v69; // [sp+D8h] [bp-18Ch]@43

  v2 = 1;
  if ( *(_WORD *)(*(_DWORD *)(this + 320) + 72) > 1 )
  {
    v3 = 4;
    do
    {
      v4 = 1;
      if ( v3 > 4 )
      {
        do
        {
          if ( (*(int (__stdcall **)(signed int))(**(_DWORD **)(*(_DWORD *)(*(_DWORD *)(this + 320) + 76) + v3) + 28))(v4) )
            break;
          ++v4;
        }
        while ( v4 < v2 );
      }
      ++v2;
      v3 += 4;
    }
    while ( v2 < *(_WORD *)(*(_DWORD *)(this + 320) + 72) );
  }
  if ( RGE_Game__is_teams_together(g_game) )
    return _RandomMapScript__sub_5386A0_if_teams_together(this);
  v6 = *(_DWORD *)(this + 259392);
  v7 = *(_DWORD *)(this + 20);
  v8 = *(_DWORD *)(this + 24);
  v9 = 0;
  v55 = 0;
  v53 = 0;
  if ( v6 <= 0 )
    goto LABEL_73;
  v10 = this + 254276;
  v11 = this + 251448;
  v46 = v11;
  v49 = v6;
  do
  {
    if ( *(_DWORD *)v11 > 0 )
    {
      ++v9;
      v12 = -2 * *(_DWORD *)(v10 - 16);
      if ( v12 + *(_DWORD *)(v10 + 8) - *(_DWORD *)v10 < v7 )
        v7 = v12 + *(_DWORD *)(v10 + 8) - *(_DWORD *)v10;
      v13 = *(_DWORD *)(v10 + 4);
      v14 = *(_DWORD *)(v10 + 12) + v12 - v13;
      if ( v14 < v8 )
        v8 = v14;
      v15 = *(_DWORD *)(v10 - 16);
      if ( v15 + *(_DWORD *)v10 > v55 )
        v55 = v15 + *(_DWORD *)v10;
      v16 = v13 + v15;
      if ( v16 > v53 )
        v53 = v16;
    }
    v11 = v46 + 16;
    v10 += 52;
    v17 = v49 == 1;
    v46 += 16;
    --v49;
  }
  while ( !v17 );
  if ( v9 < 1 )
LABEL_73:
    v9 = 1;
  v18 = 6 * v7 / 10;
  v54 = 6 * v8 / 10;
  v63 = v18;
  v19 = v18 + 6 * v8 / 10;
  v20 = 2 * v7 / 10;
  v58 = v19;
  v21 = &v67;
  v64 = v18 + v19;
  v66 = 2 * v19 / v9;
  v22 = v66 / v9;
  v23 = 0;
  v62 = v22;
  while ( 1 )
  {
    v45 = 1;
    v24 = 8 * rand() / 32767 + 1;
    *(_DWORD *)v21 = v24;
    if ( v24 == 9 )
      *(_DWORD *)v21 = 8;
    if ( v23 <= 0 )
      goto LABEL_74;
    v25 = &v67;
    v26 = v23;
    do
    {
      if ( *(_DWORD *)v25 == *(_DWORD *)v21 )
        v45 = 0;
      v25 += 4;
      --v26;
    }
    while ( v26 );
    if ( v45 )
    {
LABEL_74:
      ++v23;
      v21 += 4;
      if ( v23 >= 8 )
        break;
    }
  }
  v27 = *(_DWORD *)(this + 259392);
  if ( (signed int)v27 > 0 )
  {
    v28 = *(_DWORD *)(this + 259392);
    v29 = v27 >> 2; // = v27 / 4
    memset(v68, 0, 4 * v29);
    v30 = &v68[4 * v29];
    for ( i = v28 & 3; i; --i )
      *v30++ = 0;
  }
  v32 = rand();
  v56 = 8;
  v33 = (signed int)(2 * v58 * v32 + ((unsigned __int64)(-2147418109i64 * 2 * v58 * v32) >> 32)) >> 14;
  v34 = ((unsigned int)v33 >> 31) + v33;
  v47 = &v67;
  do
  {
    v50 = &v67;
    v61 = 8;
    v60 = *(_DWORD *)v47;
    do
    {
      v35 = *(_DWORD *)(this + 320);
      v36 = *(_DWORD *)v50;
      v65 = *(_DWORD *)v50;
      if ( *(_DWORD *)v50 < (signed int)*(_WORD *)(v35 + 72)
        && ((*(int (__stdcall **)(int))(**(_DWORD **)(*(_DWORD *)(v35 + 76) + 4 * v36) + 28))(v60) || v36 == v60) )
      {
        v37 = 0;
        if ( *(_DWORD *)(this + 259392) > 0 )
        {
          v38 = &v69;
          v59 = this + 251448;
          do
          {
            if ( !v68[v37] && *(_DWORD *)v59 > 0 && *(_DWORD *)v59 == v65 )
            {
              v68[v37] = 1;
              v39 = v62 * rand() / 32767 - v62 / 2 + v34;
              *(_DWORD *)v38 = v39;
              if ( v39 < 0 )
                *(_DWORD *)v38 = 2 * v58 + v39;
              v40 = 2 * v58;
              if ( *(_DWORD *)v38 > 2 * v58 )
                *(_DWORD *)v38 -= v40;
              v34 += v66;
              if ( v34 >= v40 )
                v34 -= v40;
            }
            ++v37;
            v38 += 4;
            v59 += 16;
          }
          while ( v37 < *(_DWORD *)(this + 259392) );
        }
        v18 = v63;
      }
      v17 = v61 == 1;
      v50 += 4;
      --v61;
    }
    while ( !v17 );
    v17 = v56 == 1;
    v47 += 4;
    --v56;
  }
  while ( !v17 );
  v57 = 0;
  if ( *(_DWORD *)(this + 259392) > 0 )
  {
    v41 = this + 254252;
    v51 = &v69;
    v48 = this + 251448;
    do
    {
      if ( *(_DWORD *)v48 > 0 )
      {
        v42 = *(_DWORD *)v51;
        if ( *(_DWORD *)v51 >= v18 )
        {
          if ( v42 < v58 )
          {
            v44 = v20 / 2;
            *(_DWORD *)v41 = v55 + v18 + v20 / 2 + v20;
            *(_DWORD *)(v41 + 4) = v53 + v20 + v42 - v18;
LABEL_68:
            *(_DWORD *)v41 += v20 * rand() / 32767 - v44;
            goto LABEL_69;
          }
          if ( v42 >= v64 )
          {
            v44 = v20 / 2;
            *(_DWORD *)v41 = v20 / 2 + v55;
            *(_DWORD *)(v41 + 4) = v53 + v54 + v20 + v64 - v42;
            goto LABEL_68;
          }
          *(_DWORD *)v41 = v55 + v18 + v20 + v58 - v42;
          v43 = v20 / 2;
          *(_DWORD *)(v41 + 4) = v53 + v54 + v20 / 2 + v20;
        }
        else
        {
          *(_DWORD *)v41 = v55 + v20 + v42;
          v43 = v20 / 2;
          *(_DWORD *)(v41 + 4) = v20 / 2 + v53;
        }
        *(_DWORD *)(v41 + 4) += v20 * rand() / 32767 - v43;
      }
LABEL_69:
      v51 += 4;
      v48 += 16;
      v41 += 52;
      ++v57;
    }
    while ( v57 < *(_DWORD *)(this + 259392) );
  }
  return 1;
}
// 4459E0: using guessed type int __thiscall RGE_Game__is_teams_together(_DWORD);
// 534EC0: using guessed type char var_1F0[100];

//----- (005353E0) --------------------------------------------------------
char __thiscall _rms__type_0x2A_5353E0(int this, int a2)
{
  int v2; // esi@1
  char result; // al@1
  int v4; // ecx@3

  v2 = this;
  result = _rms__sub_53AFB0(this, a2);
  if ( !*(_DWORD *)(v2 + 259444) && *(_DWORD *)(a2 + 104) == 43 )
  {
    v4 = v2 + 44 * *(_DWORD *)(v2 + 287068);
    if ( *(_DWORD *)(v4 + 239948) == 1 )
      *(_DWORD *)(v4 + 239980) = 1;
  }
  return result;
}

//----- (00535430) --------------------------------------------------------
int __thiscall RGE_RMM_Terrain_Generator__constructor(int this, int a2, int a3, const void *a4)
{
  int v4; // ebx@1

  v4 = this;
  _RGE_Random_Map_Module(this, a2, a3, 1);
  *(_DWORD *)v4 = &off_640410;
  memcpy((void *)(v4 + 56), a4, 0x173Cu);
  *(_DWORD *)(v4 + 36) = 2.0f;
  return v4;
}
// 640410: using guessed type int (__thiscall *off_640410)(void *Memory, char);

//----- (00535480) --------------------------------------------------------
char __thiscall sub_535480(int this)
{
  int v1; // ebp@1
  signed int v2; // eax@1
  int *v3; // ecx@1
  double v4; // st7@2
  int v5; // eax@3
  int v6; // ebx@3
  int v7; // eax@5
  int v8; // eax@6
  int v9; // esi@6
  int v10; // edx@7
  int i; // ecx@8
  int v12; // eax@9
  int v13; // ecx@13
  int v14; // edx@13
  signed int v16; // [sp-2Ch] [bp-1CCh]@5
  int v17; // [sp-28h] [bp-1C8h]@5
  char v18; // [sp-24h] [bp-1C4h]@5
  signed int v19; // [sp-20h] [bp-1C0h]@5
  int v20; // [sp-1Ch] [bp-1BCh]@5
  int v21; // [sp-18h] [bp-1B8h]@5
  int v22; // [sp-14h] [bp-1B4h]@5
  int v23; // [sp-10h] [bp-1B0h]@5
  int v24; // [sp-Ch] [bp-1ACh]@5
  int v25; // [sp-8h] [bp-1A8h]@5
  int v26; // [sp-4h] [bp-1A4h]@5
  const void *v27; // [sp+10h] [bp-190h]@1
  int v28; // [sp+14h] [bp-18Ch]@1

  v1 = this;
  sub_535B20(this);
  v2 = 0;
  v3 = &v28;
  v27 = 0;
  do
  {
    v4 = (double)(signed int)v27;
    ++v2;
    ++v3;
    v27 = (const void *)v2;
    *((float *)v3 - 1) = v4;
  }
  while ( v2 < 99 );
  v5 = constructor_408DC0(*(_DWORD *)(*(_DWORD *)(v1 + 12) + 41588), &v28, 0x63u);
  *(_DWORD *)(v1 + 6004) = players_408FF0(*(_DWORD *)(*(_DWORD *)(v1 + 12) + 41588), v5);
  v6 = 0;
  if ( *(_DWORD *)(v1 + 4412) > 0 )
  {
    v27 = (const void *)(v1 + 56);
    do
    {
      memcpy(&v16, v27, 0x2Cu);
      sub_535D20(v1, v16, v17, v18, v19, v20, v21, v22, v23, v24, v25, v26);
      v7 = *(_DWORD *)(v1 + 4412);
      ++v6;
      v27 = (char *)v27 + 44;
    }
    while ( v6 < v7 );
  }
  v8 = *(_DWORD *)(v1 + 20);
  v9 = 0;
  if ( v8 > 0 )
  {
    v10 = 0;
    do
    {
      for ( i = 0; i < *(_DWORD *)(v1 + 24); ++i )
      {
        v12 = v10 + *(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * i);
        if ( *(_BYTE *)(v12 + 5) == 16 )
          *(_BYTE *)(v12 + 5) = 0;
      }
      v8 = *(_DWORD *)(v1 + 20);
      ++v9;
      v10 += 32;
    }
    while ( v9 < v8 );
  }
  v13 = *(_DWORD *)(v1 + 24);
  v14 = *(_DWORD *)(v1 + 20);
  v26 = 1;
  v25 = v13;
  sub_581DD0(v8, *(_DWORD *)(v1 + 12), 0, 0, v14, v13, 1);
  sub_5355B0(v1);
  return 1;
}

//----- (00535580) --------------------------------------------------------
bool __stdcall sub_535580(bool a1)
{
  bool result; // al@1

  result = a1;
  if ( a1 != 1 )
  {
    if ( a1 == 4 )
    {
      result = 1;
    }
    else
    {
      if ( a1 == 22 )
        result = 1;
      else
        result = a1 == 23;
    }
  }
  return result;
}

//----- (005355B0) --------------------------------------------------------
int __thiscall sub_5355B0(int this)
{
  int v1; // esi@1
  int v2; // edi@1
  int v3; // ecx@1
  int result; // eax@1
  int v5; // ebp@2
  char v6; // bl@4
  char v7; // al@24
  char v8; // bl@26
  char v9; // bl@47
  int v10; // [sp+8h] [bp-Ch]@1
  int i; // [sp+Ch] [bp-8h]@2
  int v12; // [sp+10h] [bp-4h]@1

  v1 = this;
  v2 = 0;
  v3 = *(_DWORD *)(this + 24);
  v10 = v3 - 1;
  result = *(_DWORD *)(v1 + 20);
  v12 = result - 1;
  if ( v3 > 0 )
  {
    do
    {
      v5 = 0;
      for ( i = 0; i < result; ++i )
      {
        if ( sub_460C10(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 5)) )
        {
          v6 = 0;
          if ( v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 + 5))
            || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 + 5)) )
            v6 = 1;
          if ( v5 > 0
            && (sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 - 27))
             || v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 - 27))
             || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 - 27))) )
            v6 = 1;
          if ( i < v12
            && (sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 37))
             || v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 + 37))
             || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 + 37)))
            || v6 == 1 )
            *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 5) = 37;
        }
        else
        {
          v7 = *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 5);
          if ( v7 != 2 )
          {
            if ( sub_460C30(v7) )
            {
              v8 = 0;
              if ( v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 + 5))
                || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 + 5)) )
                v8 = 1;
              if ( v5 > 0
                && (sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 - 27))
                 || v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 - 27))
                 || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 - 27))) )
                v8 = 1;
              if ( i < v12
                && (sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 37))
                 || v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 + 37))
                 || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 + 37)))
                || v8 == 1 )
                *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 5) = 37;
            }
            else
            {
              if ( !sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 5)) )
              {
                v9 = 0;
                if ( v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 + 5))
                  || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 + 5)) )
                  v9 = 1;
                if ( v5 > 0
                  && (sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 - 27))
                   || v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 - 27))
                   || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 - 27))) )
                  v9 = 1;
                if ( i < v12
                  && (sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 37))
                   || v2 > 0 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 - 4) + v5 + 37))
                   || v2 < v10 && sub_535580(*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2 + 4) + v5 + 37)))
                  || v9 == 1 )
                  *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v2) + v5 + 5) = 2;
              }
            }
          }
        }
        result = *(_DWORD *)(v1 + 20);
        v5 += 32;
      }
      ++v2;
    }
    while ( v2 < *(_DWORD *)(v1 + 24) );
  }
  return result;
}

//----- (00535970) --------------------------------------------------------
char __thiscall sub_535970(int this, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12, int a13, int a14)
{
  int v14; // edx@1
  int v15; // ebx@1
  int v16; // edi@1
  int v17; // edx@1
  int v18; // ebp@4
  int v19; // esi@4
  int v20; // eax@4
  int v21; // edx@8
  int v22; // edx@10
  int v23; // edi@12
  int v24; // edx@12
  int v25; // ecx@12
  int v26; // esi@13
  int v27; // edi@14
  int v28; // edx@15
  int v29; // esi@16
  int v30; // ebp@24
  int v31; // esi@24
  int v32; // eax@24
  int v33; // edx@24
  int v34; // edi@28
  int v35; // ecx@30
  int v36; // edi@32
  int v37; // ecx@32
  int v38; // esi@35
  int v39; // ecx@35
  int v40; // esi@39
  int v42; // [sp+10h] [bp-18h]@4
  signed int v43; // [sp+14h] [bp-14h]@1
  int v44; // [sp+18h] [bp-10h]@4
  int v45; // [sp+1Ch] [bp-Ch]@13
  int v46; // [sp+20h] [bp-8h]@1
  int v47; // [sp+24h] [bp-4h]@1
  int v48; // [sp+2Ch] [bp+4h]@33

  v14 = *(_DWORD *)(this + 16);
  v15 = a3;
  v16 = a2;
  v47 = v14;
  v46 = this;
  v43 = 1;
  v17 = *(_BYTE *)(*(_DWORD *)(v14 + 4 * a3) + 32 * a2 + 6);
  if ( v17 < a12 || v17 > a13 )
    return 0;
  if ( a8 > 0 )
  {
    v18 = a2 - a8;
    v19 = a3 - a8;
    v20 = a8 + a3;
    v42 = a8 + a2;
    v44 = a8 + a3;
    if ( a2 - a8 < 0 )
      v18 = 0;
    if ( v19 < 0 )
      v19 = 0;
    v21 = *(_DWORD *)(this + 20);
    if ( a8 + a2 >= v21 )
      v42 = v21 - 1;
    v22 = *(_DWORD *)(this + 24);
    if ( v20 >= v22 )
    {
      v20 = v22 - 1;
      v44 = v22 - 1;
    }
    v23 = v47 + 4 * v19;
    v24 = *(_DWORD *)v23 + 32 * v18;
    v25 = v19;
    if ( v19 <= v20 )
    {
      v26 = v42;
      v45 = v23;
      while ( 1 )
      {
        v27 = v18;
        if ( v18 <= v26 )
          break;
LABEL_22:
        ++v25;
        v45 += 4;
        v24 = *(_DWORD *)v45 + 32 * v18;
        if ( v25 > v20 )
          goto LABEL_23;
      }
      v28 = v24 + 5;
      while ( 1 )
      {
        v29 = *(_BYTE *)v28;
        if ( v29 != a9 )
        {
          if ( v29 != a6 )
            return 0;
        }
        if ( a14 && *(_BYTE *)(v28 - 1) )
          return 0;
        v26 = v42;
        ++v27;
        v28 += 32;
        if ( v27 > v42 )
        {
          v20 = v44;
          goto LABEL_22;
        }
      }
    }
LABEL_23:
    v16 = a2;
    v15 = a3;
    this = v46;
  }
  v30 = v16 - 2;
  v31 = v15 - 2;
  v32 = v16 + 2;
  v33 = v15 + 2;
  if ( v16 - 2 < 0 )
    v30 = 0;
  if ( v31 < 0 )
    v31 = 0;
  v34 = *(_DWORD *)(this + 20);
  if ( v32 >= v34 )
    v32 = v34 - 1;
  v35 = *(_DWORD *)(this + 24);
  if ( v33 >= v35 )
    v33 = v35 - 1;
  v36 = v47 + 4 * v31;
  v37 = *(_DWORD *)v36 + 32 * v30;
  if ( v31 <= v33 )
  {
    v48 = v33 - v31 + 1;
    do
    {
      if ( v30 <= v32 )
      {
        v38 = v37 + 5;
        v39 = v32 - v30 + 1;
        do
        {
          if ( *(_BYTE *)v38 == a6 )
            ++v43;
          v38 += 32;
          --v39;
        }
        while ( v39 );
      }
      v40 = *(_DWORD *)(v36 + 4);
      v36 += 4;
      v37 = v40 + 32 * v30;
      --v48;
    }
    while ( v48 );
  }
  return v43;
}

//----- (00535B20) --------------------------------------------------------
int __thiscall sub_535B20(int this)
{
  int v1; // ebp@1
  int v2; // ebx@1
  void *v3; // edi@1
  unsigned int v4; // edx@1
  int v5; // edi@1
  int i; // ecx@1
  int result; // eax@4
  int j; // edi@5
  int v9; // esi@7
  int v10; // eax@8
  int v11; // ecx@8
  int v12; // ecx@12
  signed int v13; // [sp+Ch] [bp-Ch]@6
  int v14; // [sp+10h] [bp-8h]@7

  v1 = this;
  v2 = 0;
  v3 = *(void **)(this + 40);
  v4 = *(_DWORD *)(this + 24) * *(_DWORD *)(this + 20);
  memset(v3, 0, 4 * (v4 >> 2));
  v5 = (int)((char *)v3 + 4 * (v4 >> 2));
  for ( i = v4 & 3; i; --i )
    *(_BYTE *)v5++ = 0;
  result = *(_DWORD *)(v1 + 24);
  if ( result > 0 )
  {
    do
    {
      for ( j = 0; j < *(_DWORD *)(v1 + 20); ++j )
      {
        v13 = 0;
        if ( *(_DWORD *)(v1 + 6000) <= 0 )
          goto LABEL_22;
        v9 = v1 + 4420;
        v14 = *(_DWORD *)(v1 + 6000);
        do
        {
          v10 = j - *(_DWORD *)(v9 - 4);
          v11 = v2 - *(_DWORD *)v9;
          if ( v10 < 0 )
            v10 = -v10;
          if ( v11 < 0 )
            v11 = -v11;
          v12 = *(_DWORD *)(v9 + 4) - (unsigned __int64)(signed __int64)sqrt((double)(v10 * v10 + v11 * v11));
          if ( v12 > 0 )
            v13 += v12 * *(_DWORD *)(v9 + 8);
          v9 += 16;
          --v14;
        }
        while ( v14 );
        if ( v13 <= 100 )
LABEL_22:
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v2) + j) = v13;
        else
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v2) + j) = 101;
      }
      result = *(_DWORD *)(v1 + 24);
      ++v2;
    }
    while ( v2 < result );
  }
  return result;
}

//----- (00535C20) --------------------------------------------------------
double __stdcall sub_535C20(int a1, int a2, int a3, int a4)
{
  return (double)(250 - a4 * a1);
}

//----- (00535C40) --------------------------------------------------------
int __thiscall sub_535C40(int this, int a2, int a3)
{
  int v3; // esi@1
  int v4; // ebx@1
  int v5; // ecx@1
  int v6; // edx@1
  int v7; // eax@1
  int v8; // ebp@1
  int v9; // ecx@1
  int v10; // eax@1
  __int64 v11; // qax@3
  int result; // eax@3
  int v13; // edi@5
  int v14; // eax@5
  signed int v15; // edx@5
  int v16; // [sp+10h] [bp-4h]@1
  int v17; // [sp+18h] [bp+4h]@4

  v3 = this;
  v4 = a2;
  v5 = *(_DWORD *)(this + 24);
  v6 = *(_DWORD *)(v3 + 20);
  v16 = v5 - 1;
  v7 = *(_DWORD *)(v3 + 48);
  v8 = v6 - 1;
  *(_DWORD *)(v7 + 20) = a2;
  v9 = v7 + 24 * v6 * v5 - 24;
  *(_DWORD *)(v7 + 16) = v7 + 24;
  *(_DWORD *)(a2 + 16) = v7;
  v10 = v7 + 24;
  *(_DWORD *)(v9 + 16) = 0;
  for ( *(_DWORD *)(v9 + 20) = v9 - 24; v10 < (unsigned int)v9; v10 += 24 )
  {
    *(_DWORD *)(v10 + 16) = v10 + 24;
    *(_DWORD *)(v10 + 20) = v10 - 24;
  }
  v11 = *(_DWORD *)(v3 + 20) * *(_DWORD *)(v3 + 24);
  result = ((BYTE4(v11) & 7) + (signed int)v11) >> 3;
  if ( result > 0 )
  {
    v17 = result;
    do
    {
      v13 = v8 * rand() / 32767;
      v14 = rand();
      v15 = (signed int)(v16 * v14 + ((unsigned __int64)(-2147418109i64 * v16 * v14) >> 32)) >> 14;
      sub_541860(v4, *(_DWORD *)(*(_DWORD *)(v3 + 52) + 4 * (((unsigned int)v15 >> 31) + v15)) + 24 * v13);
      result = v17-- - 1;
    }
    while ( v17 );
  }
  return result;
}

//----- (00535D20) --------------------------------------------------------
char __thiscall sub_535D20(int this, signed int a2, int a3, char a4, signed int a5, int a6, int a7, int a8, int a9, int a10, int a11, int a12)
{
  int v12; // ebp@1
  signed int v13; // ebx@1
  int v14; // esi@1
  int v15; // eax@1
  int v16; // edi@5
  int v17; // eax@6
  int v18; // esi@9
  signed int v19; // edi@9
  int v20; // ebx@15
  int v21; // esi@19
  int v22; // eax@21
  int v23; // ecx@23
  int v24; // ecx@29
  char v25; // al@29
  int v26; // edx@30
  int v27; // ecx@30
  float v28; // esi@31
  int v29; // ebx@40
  char v30; // al@45
  int v31; // edx@45
  int i; // ecx@45
  int v33; // eax@50
  int v34; // edx@50
  int v35; // eax@50
  int v36; // ecx@52
  int v37; // edx@65
  int v38; // eax@65
  int v39; // ebx@68
  int v40; // eax@68
  int v41; // edi@73
  int v42; // eax@74
  int v43; // esi@74
  signed int v44; // edx@74
  bool v45; // zf@87
  signed int v46; // edi@89
  int v47; // ebx@90
  int v48; // eax@92
  int v49; // ecx@97
  int v50; // esi@105
  int v52; // [sp-28h] [bp-5F0Ch]@18
  int v53; // [sp-24h] [bp-5F08h]@18
  int v54; // [sp-20h] [bp-5F04h]@18
  int v55; // [sp-1Ch] [bp-5F00h]@18
  int v56; // [sp-18h] [bp-5EFCh]@18
  int v57; // [sp-14h] [bp-5EF8h]@18
  int v58; // [sp-10h] [bp-5EF4h]@18
  int v59; // [sp-Ch] [bp-5EF0h]@18
  int v60; // [sp-8h] [bp-5EECh]@18
  int v61; // [sp-4h] [bp-5EE8h]@18
  int v62; // [sp+0h] [bp-5EE4h]@18
  int v63; // [sp+14h] [bp-5ED0h]@16
  int v64; // [sp+18h] [bp-5ECCh]@16
  float v65; // [sp+1Ch] [bp-5EC8h]@1
  char v66; // [sp+23h] [bp-5EC1h]@60
  int v67; // [sp+24h] [bp-5EC0h]@12
  int v68; // [sp+28h] [bp-5EBCh]@71
  int v69; // [sp+2Ch] [bp-5EB8h]@14
  int v70; // [sp+30h] [bp-5EB4h]@1
  int v71; // [sp+34h] [bp-5EB0h]@61
  char v72; // [sp+38h] [bp-5EACh]@16
  int v73; // [sp+3Ch] [bp-5EA8h]@1
  int v74; // [sp+40h] [bp-5EA4h]@1
  char v75; // [sp+44h] [bp-5EA0h]@12
  int v76; // [sp+54h] [bp-5E90h]@12
  int v77; // [sp+58h] [bp-5E8Ch]@12
  char v78[100]; // [sp+5Ch] [bp-5E88h]@6
  char v79[100]; // [sp+C0h] [bp-5E24h]@6
  int v80[6000]; // [sp+124h] [bp-5DC0h]@9

  v12 = this;
  v13 = a5;
  v14 = 0;
  v15 = *(_DWORD *)(this + 20) - 1;
  v70 = 0;
  v74 = v15;
  v73 = *(_DWORD *)(this + 24) - 1;
  v65 = 0.0;
  if ( a5 > 999 )
  {
    v13 = 999;
    a5 = 999;
  }
  if ( a9 == 2 && *(_DWORD *)(this + 6000) > 0 )
  {
    v16 = this + 4416;
    do
    {
      v79[v14] = sub_4089A0(*(_DWORD *)(v12 + 6004), *(_DWORD *)v16, *(_DWORD *)(v16 + 4));
      v17 = *(_DWORD *)(v12 + 6000);
      v78[v14++] = 0;
      v16 += 16;
    }
    while ( v14 < v17 );
    v14 = 0;
  }
  if ( v13 > v14 )
  {
    v18 = (int)v80;
    v19 = v13;
    do
    {
      sub_541740(v18);
      v18 += 24;
      --v19;
    }
    while ( v19 );
    v14 = 0;
  }
  v76 = v14;
  v77 = v14;
  sub_535C40(v12, (int)&v75, a7);
  v67 = 2 * (unsigned __int64)(signed __int64)sqrt((double)a2 / (double)a5);
  if ( v67 < 2 )
    v67 = 2;
  v69 = 0;
  if ( v13 > 0 )
  {
    v20 = (int)v80;
    do
    {
      if ( !sub_541820((int)&v75, (int)&v63, (int)&v64, (int)&v72) )
        break;
      if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 16) + 4 * v64) + 32 * v63 + 5) == a7 )
      {
        memcpy(&v52, &a2, 0x2Cu);
        if ( sub_535970(v12, v63, v64, v52, v53, v54, v55, v56, v57, v58, v59, v60, v61, v62) )
        {
          v21 = a9;
          if ( !a9 || !*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 44) + 4 * v64) + v63) )
          {
            sub_53C680((void *)v12, v63, v64, v67);
            *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 16) + 4 * v64) + 32 * v63 + 5) = a4;
            v22 = v63;
            if ( v63 > 0 )
            {
              sub_541790(v12, v20, v63 - 1, v64, 0, 0);
              v22 = v63;
            }
            v23 = v64;
            if ( v64 > 0 )
            {
              sub_541790(v12, v20, v22, v64 - 1, 0, 0);
              v23 = v64;
              v22 = v63;
            }
            if ( v22 < *(_DWORD *)(v12 + 20) - 1 )
            {
              sub_541790(v12, v20, v22 + 1, v23, 0, 0);
              v23 = v64;
              v22 = v63;
            }
            if ( v23 < *(_DWORD *)(v12 + 24) - 1 )
            {
              sub_541790(v12, v20, v22, v23 + 1, 0, 0);
              v23 = v64;
              v22 = v63;
            }
            v62 = v23;
            v24 = *(_DWORD *)(v12 + 6004);
            ++v70;
            ++v69;
            v20 += 24;
            v25 = sub_4089A0(v24, v22, v62);
            if ( v21 == 2 )
            {
              v26 = *(_DWORD *)(v12 + 6000);
              v27 = 0;
              if ( v26 > 0 )
              {
                v28 = v65;
                do
                {
                  if ( v79[v27] == v25 && !v78[v27] )
                  {
                    v78[v27] = 1;
                    ++LODWORD(v28);
                  }
                  ++v27;
                }
                while ( v27 < v26 );
                v65 = v28;
              }
            }
          }
        }
      }
    }
    while ( v69 < a5 );
  }
  if ( a9 == 2 && SLODWORD(v65) < *(_DWORD *)(v12 + 6000) )
  {
    v29 = (int)&v80[6 * v69];
    do
    {
      if ( !sub_541820((int)&v75, (int)&v63, (int)&v64, (int)&v72) )
        break;
      if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 16) + 4 * v64) + 32 * v63 + 5) == a7 )
      {
        memcpy(&v52, &a2, 0x2Cu);
        if ( sub_535970(v12, v63, v64, v52, v53, v54, v55, v56, v57, v58, v59, v60, v61, v62) )
        {
          if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 44) + 4 * v64) + v63) < 0x1Eu )
          {
            v62 = v64;
            v61 = v63;
            v30 = sub_4089A0(*(_DWORD *)(v12 + 6004), v63, v64);
            v31 = *(_DWORD *)(v12 + 6000);
            for ( i = 0; i < v31; ++i )
            {
              if ( v79[i] == v30 && !v78[i] )
                break;
            }
            if ( i != v31 )
            {
              v33 = v67;
              v34 = LODWORD(v65) + 1;
              v78[i] = 1;
              LODWORD(v65) = v34;
              sub_53C680((void *)v12, v63, v64, v33);
              *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 16) + 4 * v64) + 32 * v63 + 5) = a4;
              v35 = v63;
              if ( v63 > 0 )
              {
                sub_541790(v12, v29, v63 - 1, v64, 0, 0);
                v35 = v63;
              }
              v36 = v64;
              if ( v64 > 0 )
              {
                sub_541790(v12, v29, v35, v64 - 1, 0, 0);
                v36 = v64;
                v35 = v63;
              }
              if ( v35 < *(_DWORD *)(v12 + 20) - 1 )
              {
                sub_541790(v12, v29, v35 + 1, v36, 0, 0);
                v36 = v64;
                v35 = v63;
              }
              if ( v36 < *(_DWORD *)(v12 + 24) - 1 )
                sub_541790(v12, v29, v35, v36 + 1, 0, 0);
              ++v70;
              ++v69;
              v29 += 24;
            }
          }
        }
      }
    }
    while ( SLODWORD(v65) < *(_DWORD *)(v12 + 6000) );
  }
  do
  {
    v66 = 1;
    if ( v69 <= 0 )
      break;
    v67 = (int)v80;
    v71 = v69;
    do
    {
      if ( v70 < a2 && sub_541820(v67, (int)&v63, (int)&v64, (int)&v72) )
      {
        v66 = 0;
        if ( a9 )
        {
          v37 = 100 * rand() / 32767;
          v38 = v64;
          if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 44) + 4 * v64) + v63) > v37 )
            goto LABEL_87;
        }
        else
        {
          v38 = v64;
        }
        v39 = 32 * v63 + *(_DWORD *)(*(_DWORD *)(v12 + 16) + 4 * v38);
        memcpy(&v52, &a2, 0x2Cu);
        v40 = (unsigned __int8)sub_535970(v12, v63, v38, v52, v53, v54, v55, v56, v57, v58, v59, v60, v61, v62);
        if ( *(_BYTE *)(v39 + 5) == a7 && v40 > 0 )
        {
          v65 = sub_535C20(v40, v63, v64, a8);
          if ( a9 )
          {
            v68 = *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v12 + 44) + 4 * v64) + v63);
            v65 = (double)v68 + v65;
          }
          *(_BYTE *)(v39 + 5) = a4;
          if ( v63 <= 0 )
          {
            v43 = v67;
            v41 = a7;
          }
          else
          {
            v41 = a7;
            if ( *(_BYTE *)(v39 - 27) == a7 )
            {
              v42 = rand();
              v43 = v67;
              v44 = (signed int)(100 * v42 + ((unsigned __int64)(-214741810900i64 * v42) >> 32)) >> 14;
              v68 = ((unsigned int)v44 >> 31) + v44;
              *(float *)&v62 = (double)v68 + v65;
              sub_541790(v12, v67, v63 - 1, v64, 0, v62);
            }
            else
            {
              v43 = v67;
            }
          }
          if ( v63 < v74 && *(_BYTE *)(v39 + 37) == v41 )
          {
            v68 = 100 * rand() / 32767;
            *(float *)&v62 = (double)v68 + v65;
            sub_541790(v12, v43, v63 + 1, v64, 0, v62);
          }
          if ( v64 > 0 && *(_BYTE *)(v39 - 32 * *(_DWORD *)(v12 + 20) + 5) == v41 )
          {
            v68 = 100 * rand() / 32767;
            *(float *)&v62 = (double)v68 + v65;
            sub_541790(v12, v43, v63, v64 - 1, 0, v62);
          }
          if ( v64 < v73 && *(_BYTE *)(32 * *(_DWORD *)(v12 + 20) + v39 + 5) == v41 )
          {
            v68 = 100 * rand() / 32767;
            *(float *)&v62 = (double)v68 + v65;
            sub_541790(v12, v43, v63, v64 + 1, 0, v62);
          }
          ++v70;
        }
      }
LABEL_87:
      v45 = v71 == 1;
      v67 += 24;
      --v71;
    }
    while ( !v45 );
  }
  while ( !v66 );
  v46 = a5;
  if ( a5 > 0 )
  {
    v47 = (int)v80;
    v71 = a5;
    do
    {
      if ( sub_541820(v47, (int)&v63, (int)&v64, (int)&v72) )
      {
        do
        {
          v48 = 32 * v63 + *(_DWORD *)(*(_DWORD *)(v12 + 16) + 4 * v64);
          if ( v63 <= 0 || *(_BYTE *)(v48 - 27) != a4 || v63 >= v74 || *(_BYTE *)(v48 + 37) != a4 )
          {
            if ( v64 <= 0 )
              continue;
            v49 = 32 * *(_DWORD *)(v12 + 20);
            if ( *(_BYTE *)(v48 - v49 + 5) != a4 )
              continue;
            if ( v64 <= v73 || *(_BYTE *)(v49 + v48 + 5) != a4 )
              continue;
          }
          *(_BYTE *)(v48 + 5) = a4;
        }
        while ( sub_541820(v47, (int)&v63, (int)&v64, (int)&v72) );
        v46 = a5;
      }
      v47 += 24;
      --v71;
    }
    while ( v71 );
    if ( v46 > 0 )
    {
      v50 = (int)v80;
      do
      {
        sub_541770(v50);
        v50 += 24;
        --v46;
      }
      while ( v46 );
    }
  }
  return 1;
}
// 535D20: using guessed type char var_5E24[100];
// 535D20: using guessed type char var_5E88[100];
// 535D20: using guessed type int var_5DC0[6000];

//----- (00536580) --------------------------------------------------------
int __thiscall sub_536580(int this, const char *a2, const char *a3, const char *a4, const char *Filename)
{
  int v5; // esi@1

  v5 = this;
  sub_53EF60(this, a2, a3, a4, Filename);
  *(_DWORD *)v5 = &off_640498;
  return v5;
}
// 640498: using guessed type int (__thiscall *off_640498)(void *Memory, char);

//----- (005365B0) --------------------------------------------------------
void *__thiscall sub_5365B0(void *Memory, char a2)
{
  void *v2; // esi@1

  v2 = Memory;
  sub_5365D0();
  if ( a2 & 1 )
    operator delete(v2);
  return v2;
}
// 5365D0: using guessed type int sub_5365D0(void);

//----- (005365E0) --------------------------------------------------------
int __thiscall sub_5365E0(int this, int hFile)
{
  int v2; // esi@1

  v2 = this;
  _RandomMaps__constructor_from_file(this, hFile);
  *(_DWORD *)v2 = &off_640498;
  return v2;
}
// 640498: using guessed type int (__thiscall *off_640498)(void *Memory, char);

//----- (00536600) --------------------------------------------------------
char __thiscall sub_536600(void *this, int a2, int a3, unsigned __int8 a4, int a5, int a6)
{
  int v6; // esi@1

  v6 = (int)this;
  LOBYTE(a6) = RGE_Game__is_teams_together(g_game) == 0;
  sub_53F930(v6, a2, a3, a4, a5, a6);
  return 1;
}
// 4459E0: using guessed type int __thiscall RGE_Game__is_teams_together(_DWORD);

//----- (00536640) --------------------------------------------------------
char __thiscall sub_536640(int this)
{
  sub_53F990(this);
  return 1;
}

//----- (00536650) --------------------------------------------------------
void __thiscall sub_536650(int this, char a2)
{
  int v2; // esi@1
  int v3; // ecx@3
  int v4; // eax@3
  int v5; // ecx@4
  int v6; // ecx@7
  int v7; // eax@7
  int v8; // ecx@8
  int v9; // eax@11
  int v10; // ecx@12
  int v11; // ecx@15
  int v12; // eax@15
  int v13; // ecx@16
  int v14; // ecx@20
  int v15; // eax@20
  int v16; // eax@21
  int v17; // ecx@24
  int v18; // eax@24
  int v19; // eax@25
  signed int v20; // eax@27
  int v21; // eax@32
  int v22; // ecx@33
  int v23; // eax@36
  int v24; // ecx@37
  int v25; // eax@39
  signed int v26; // ecx@39
  bool v27; // sf@39
  unsigned __int8 v28; // of@39
  signed int v29; // eax@39
  int v30; // ecx@41
  int v31; // ecx@45
  signed int v32; // eax@48
  int v33; // eax@49
  int v34; // ecx@50
  int v35; // eax@54
  int v36; // ecx@55
  int v37; // eax@57
  signed int v38; // ecx@59
  signed int v39; // edi@59
  signed int v40; // ebp@59
  int v41; // ebx@60

  v2 = this;
  sub_53FD90(this, a2);
  if ( *(_DWORD *)(v2 + 60) < 5 )
  {
    if ( rand() < 16383 )
    {
      v3 = *(_DWORD *)(v2 + 5216);
      v4 = 0;
      *(_DWORD *)(v2 + 5224) = -1;
      if ( v3 > 0 )
      {
        v5 = v2 + 100;
        do
        {
          *(_DWORD *)v5 = -1;
          ++v4;
          v5 += 52;
        }
        while ( v4 < *(_DWORD *)(v2 + 5216) );
      }
    }
    if ( rand() < 16383 )
    {
      v6 = *(_DWORD *)(v2 + 5216);
      v7 = 0;
      *(_DWORD *)(v2 + 5228) = -1;
      if ( v6 > 0 )
      {
        v8 = v2 + 104;
        do
        {
          *(_DWORD *)v8 = -1;
          ++v7;
          v8 += 52;
        }
        while ( v7 < *(_DWORD *)(v2 + 5216) );
      }
    }
    if ( rand() < 16383 )
    {
      v9 = 0;
      *(_DWORD *)(v2 + 5232) = *(_DWORD *)(v2 + 20);
      if ( *(_DWORD *)(v2 + 5216) > 0 )
      {
        v10 = v2 + 108;
        do
        {
          ++v9;
          *(_DWORD *)v10 = *(_DWORD *)(v2 + 20);
          v10 += 52;
        }
        while ( v9 < *(_DWORD *)(v2 + 5216) );
      }
    }
    if ( rand() < 16383 )
    {
      v11 = *(_DWORD *)(v2 + 5216);
      *(_DWORD *)(v2 + 5236) = *(_DWORD *)(v2 + 24);
      v12 = 0;
      if ( v11 > 0 )
      {
        v13 = v2 + 112;
        do
        {
          ++v12;
          *(_DWORD *)v13 = *(_DWORD *)(v2 + 24);
          v13 += 52;
        }
        while ( v12 < *(_DWORD *)(v2 + 5216) );
      }
    }
  }
  if ( *(_DWORD *)(v2 + 60) == 8 )
  {
    if ( rand() >= 16383 )
    {
      v17 = 0;
      *(_DWORD *)(v2 + 5236) = *(_DWORD *)(v2 + 24);
      v18 = *(_DWORD *)(v2 + 5216);
      *(_DWORD *)(v2 + 5228) = -1;
      if ( v18 > 0 )
      {
        v19 = v2 + 112;
        do
        {
          *(_DWORD *)(v19 - 8) = -1;
          *(_DWORD *)v19 = *(_DWORD *)(v2 + 24);
          ++v17;
          v19 += 52;
        }
        while ( v17 < *(_DWORD *)(v2 + 5216) );
      }
    }
    else
    {
      v14 = 0;
      *(_DWORD *)(v2 + 5232) = *(_DWORD *)(v2 + 20);
      v15 = *(_DWORD *)(v2 + 5216);
      *(_DWORD *)(v2 + 5224) = -1;
      if ( v15 > 0 )
      {
        v16 = v2 + 108;
        do
        {
          *(_DWORD *)(v16 - 8) = -1;
          *(_DWORD *)v16 = *(_DWORD *)(v2 + 20);
          ++v14;
          v16 += 52;
        }
        while ( v14 < *(_DWORD *)(v2 + 5216) );
      }
    }
  }
  v20 = *(_DWORD *)(v2 + 60);
  if ( v20 >= 2 && v20 <= 6 || v20 == 8 )
  {
    if ( rand() < 16383 )
    {
      if ( rand() >= 16383 )
      {
        v23 = 0;
        if ( *(_DWORD *)(v2 + 5216) > 0 )
        {
          v24 = v2 + 92;
          do
          {
            *(_BYTE *)v24 = v23;
            v23 += 2;
            v24 += 104;
          }
          while ( v23 < *(_DWORD *)(v2 + 5216) );
        }
      }
      else
      {
        v21 = 0;
        if ( *(_DWORD *)(v2 + 5216) > 0 )
        {
          v22 = v2 + 92;
          do
          {
            *(_BYTE *)v22 = 0;
            v21 += 2;
            v22 += 104;
          }
          while ( v21 < *(_DWORD *)(v2 + 5216) );
        }
      }
      v25 = rand();
      v26 = *(_DWORD *)(v2 + 5216);
      v28 = __OFSUB__(v25, 16383);
      v27 = v25 - 16383 < 0;
      v29 = 1;
      if ( v27 ^ v28 )
      {
        if ( v26 > 1 )
        {
          v30 = v2 + 144;
          do
          {
            *(_BYTE *)v30 = 1;
            v29 += 2;
            v30 += 104;
          }
          while ( v29 < *(_DWORD *)(v2 + 5216) );
          sub_5372A0((void *)v2);
          goto LABEL_57;
        }
      }
      else
      {
        if ( v26 > 1 )
        {
          v31 = v2 + 144;
          do
          {
            *(_BYTE *)v31 = v29;
            v29 += 2;
            v31 += 104;
          }
          while ( v29 < *(_DWORD *)(v2 + 5216) );
        }
      }
      sub_5372A0((void *)v2);
      goto LABEL_57;
    }
    v32 = *(_DWORD *)(v2 + 60);
    if ( v32 == 4 )
    {
      v33 = 0;
      if ( *(_DWORD *)(v2 + 5216) > 0 )
      {
        v34 = v2 + 92;
        do
        {
          *(_BYTE *)v34 = 0;
          ++v33;
          v34 += 52;
        }
        while ( v33 < *(_DWORD *)(v2 + 5216) );
      }
      *(_BYTE *)(v2 + 5220) = 0;
    }
    else
    {
      if ( v32 >= 5 )
      {
        v35 = 0;
        if ( *(_DWORD *)(v2 + 5216) > 0 )
        {
          v36 = v2 + 92;
          do
          {
            *(_BYTE *)v36 = 0;
            ++v35;
            v36 += 52;
          }
          while ( v35 < *(_DWORD *)(v2 + 5216) );
        }
      }
    }
  }
LABEL_57:
  v37 = *(_DWORD *)(v2 + 60);
  if ( v37 == 5 || v37 == 8 )
  {
    v38 = *(_DWORD *)(v2 + 5216);
    v39 = 0;
    v40 = (signed __int64)((double)((*(_DWORD *)(v2 + 24) - 20) * (*(_DWORD *)(v2 + 20) - 40)) * 0.69999999);
    if ( v38 > 0 )
    {
      v41 = v2 + 68;
      do
      {
        v41 += 52;
        ++v39;
        *(_DWORD *)(v41 - 52) = v40 / v38;
        v38 = *(_DWORD *)(v2 + 5216);
      }
      while ( v39 < v38 );
    }
  }
  rand();
  Pinfo_DEPRECATED(dword_78BF34);
}

//----- (00536970) --------------------------------------------------------
void __thiscall sub_536970(int this)
{
  int v1; // esi@1
  int v2; // ST18_4@1
  int v3; // edi@1
  int v4; // ebx@2
  int v5; // edi@8
  int v6; // ecx@9
  int v7; // eax@10
  int v8; // edx@22
  int v9; // eax@23
  int v10; // ecx@24
  float v11; // [sp+0h] [bp-4h]@1

  v1 = this;
  v2 = *(_DWORD *)(this + 20)
     * *(_DWORD *)(this + 24)
     * *(_DWORD *)(*(_DWORD *)(this + 22300) + 72 * *(_DWORD *)(this + 60) + 32)
     / 100;
  sub_5404D0(this);
  v3 = 0;
  v11 = (double)v2 * 0.000049999999;
  if ( *(_DWORD *)(v1 + 9600) > 0 )
  {
    v4 = v1 + 5256;
    do
    {
      if ( *(_DWORD *)(v4 - 4) != 6 && v11 > 1.0 )
        *(_DWORD *)v4 = (signed __int64)((double)*(signed int *)v4 * v11);
      ++v3;
      v4 += 44;
    }
    while ( v3 < *(_DWORD *)(v1 + 9600) );
  }
  if ( rand() >= 8191 )
  {
    v8 = 0;
    if ( *(_DWORD *)(v1 + 9600) > 0 )
    {
      v9 = v1 + 5272;
      do
      {
        v10 = *(_DWORD *)(v9 - 20);
        if ( v10 == 6 )
        {
          *(_DWORD *)v9 = 0;
        }
        else
        {
          if ( v10 == 10 || v10 == 13 )
            *(_DWORD *)v9 = 2;
        }
        ++v8;
        v9 += 44;
      }
      while ( v8 < *(_DWORD *)(v1 + 9600) );
    }
  }
  else
  {
    v5 = 0;
    if ( *(_DWORD *)(v1 + 9600) > 0 )
    {
      v6 = v1 + 5256;
      do
      {
        v7 = *(_DWORD *)(v6 - 4);
        switch ( v7 )
        {
          case 13:
            *(_DWORD *)(v6 - 12) *= 3;
            *(_DWORD *)v6 *= 3;
            *(_DWORD *)(v6 + 16) = 2;
            break;
          case 20:
            *(_DWORD *)(v6 - 12) /= 2;
            *(_DWORD *)v6 /= 2;
            break;
          case 19:
            *(_DWORD *)(v6 - 12) /= 2;
            *(_DWORD *)v6 /= 2;
            break;
          case 10:
            *(_DWORD *)(v6 - 12) /= 2;
            *(_DWORD *)v6 /= 2;
            *(_DWORD *)(v6 + 16) = 2;
            break;
          case 6:
            *(_DWORD *)(v6 - 12) *= 2;
            *(_DWORD *)(v6 + 16) = 0;
            break;
        }
        ++v5;
        v6 += 44;
      }
      while ( v5 < *(_DWORD *)(v1 + 9600) );
    }
  }
  rand();
  Pinfo_DEPRECATED(dword_78BF34);
}

//----- (00536B20) --------------------------------------------------------
void __thiscall sub_536B20(int this)
{
  int v1; // ebp@1
  int v2; // ecx@2
  int v3; // eax@3
  int v4; // ecx@7
  int v5; // eax@8
  int v6; // eax@13
  void *v7; // edi@14
  int v8; // edx@14
  signed int v9; // esi@16
  int v10; // ebx@16
  int v11; // ecx@16
  int v12; // eax@16
  int v13; // esi@18
  int v14; // eax@18
  signed int v15; // ecx@20
  __int64 v16; // qax@20
  int v17; // ecx@21
  int v18; // ebx@22
  signed int v19; // edi@23
  int v20; // ebx@23
  int v21; // esi@24
  int v22; // eax@27
  signed int v23; // edx@27
  int v24; // esi@27
  int v25; // edi@27
  int v26; // edx@28
  int v27; // ecx@32
  bool v28; // sf@32
  unsigned __int8 v29; // of@32
  int v30; // eax@38
  int v31; // eax@38
  int v32; // eax@41
  int v33; // esi@44
  int v34; // ecx@45
  int v35; // eax@46
  signed int v36; // edx@51
  __int64 v37; // qax@52
  char v38; // [sp+Bh] [bp-15h]@27
  int v39; // [sp+Ch] [bp-14h]@18
  signed int v40; // [sp+10h] [bp-10h]@26
  int v41; // [sp+14h] [bp-Ch]@24
  int v42; // [sp+18h] [bp-8h]@27
  int v43; // [sp+1Ch] [bp-4h]@28

  v1 = this;
  sub_540690(this);
  rand();
  if ( RGE_Game__get_starting_age(g_game) == 1 )
  {
    v2 = 0;
    if ( *(_DWORD *)(v1 + 16736) > 0 )
    {
      v3 = v1 + 11212;
      do
      {
        if ( *(_DWORD *)(v3 - 20) == 83 )
          *(_DWORD *)v3 = 1;
        ++v2;
        v3 += 56;
      }
      while ( v2 < *(_DWORD *)(v1 + 16736) );
    }
    v4 = 0;
    if ( *(_DWORD *)(v1 + 16736) > 0 )
    {
      v5 = v1 + 11212;
      do
      {
        if ( *(_DWORD *)(v5 - 20) == 109 )
          *(_DWORD *)v5 = 0;
        ++v4;
        v5 += 56;
      }
      while ( v4 < *(_DWORD *)(v1 + 16736) );
    }
  }
  if ( *(_DWORD *)(v1 + 60) == 6 )
  {
    v6 = *(_DWORD *)(v1 + 5216);
    if ( v6 > 0 )
    {
      v7 = (void *)(v1 + 52 * v6 + 68);
      v8 = *(_DWORD *)(v1 + 5216);
      do
      {
        --v8;
        memcpy(v7, (char *)v7 - 52, 0x34u);
        v7 = (char *)v7 - 52;
      }
      while ( v8 );
    }
    v9 = *(_DWORD *)(v1 + 20);
    v10 = *(_DWORD *)(v1 + 24);
    *(_BYTE *)(v1 + 92) = *(_BYTE *)(v1 + 5216);
    *(_DWORD *)(v1 + 72) = 1;
    *(_DWORD *)(v1 + 88) = 7;
    *(_DWORD *)(v1 + 84) = 2;
    v11 = *(_DWORD *)(v1 + 12);
    *(_DWORD *)(v1 + 68) = (signed __int64)((double)((v9 - 2 * v9 / 6) * (v10 - 2 * v9 / 6)) * 0.69999999);
    *(_DWORD *)(v1 + 96) = 10;
    *(_DWORD *)(v1 + 76) = *(_DWORD *)(v11 + 8) / 2;
    *(_DWORD *)(v1 + 100) = v9 / 6;
    *(_DWORD *)(v1 + 80) = *(_DWORD *)(v11 + 12) / 2;
    v12 = *(_DWORD *)(v1 + 5216) + 1;
    *(_DWORD *)(v1 + 104) = v9 / 6;
    *(_DWORD *)(v1 + 108) = v9 - v9 / 6;
    *(_DWORD *)(v1 + 112) = v10 - v9 / 6;
    *(_BYTE *)(v1 + 116) = 10;
    *(_DWORD *)(v1 + 5216) = v12;
  }
  if ( *(_DWORD *)(v1 + 60) < 2 )
  {
    v13 = 4 * rand() / 32767 + 1;
    v14 = *(_DWORD *)(v1 + 64);
    v39 = v13;
    if ( v14 + v13 > 10 )
    {
      v39 = 10 - v14;
      v13 = 10 - v14;
    }
    v15 = *(_DWORD *)(v1 + 5216);
    v16 = v13 * (*(_DWORD *)(v1 + 24) + *(_DWORD *)(v1 + 20)) / v15;
    if ( v15 > 0 )
    {
      v17 = v1 + 68;
      do
      {
        v18 = *(_DWORD *)v17;
        v17 += 52;
        ++HIDWORD(v16);
        *(_DWORD *)(v17 - 52) = v18 - v16;
      }
      while ( SHIDWORD(v16) < *(_DWORD *)(v1 + 5216) );
    }
    v19 = 0;
    v20 = 0;
    if ( v13 > 0 )
    {
      v21 = v1 + 104;
      v41 = v1 + 104;
      while ( 2 )
      {
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 72) = v19;
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 88) = 7;
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 84) = 2;
        *(_BYTE *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 92) = *(_BYTE *)(v1 + 5216) + v20;
        v40 = v19;
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 68) = (signed __int64)((double)(*(_DWORD *)(v1 + 24)
                                                                                             + *(_DWORD *)(v1 + 20))
                                                                                    * 1.25);
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 96) = 10;
        *(_DWORD *)(v21 - 4) = *(_DWORD *)(v1 + 5224);
        *(_DWORD *)v21 = *(_DWORD *)(v1 + 5228);
        *(_DWORD *)(v21 + 4) = *(_DWORD *)(v1 + 5232);
        *(_DWORD *)(v21 + 8) = *(_DWORD *)(v1 + 5236);
        *(_BYTE *)(v21 + 12) = *(_BYTE *)(v1 + 5240);
        while ( 1 )
        {
          v38 = 1;
          ++v40;
          v22 = rand();
          v23 = (signed int)((*(_DWORD *)(v1 + 20) - 16) * v22
                           + ((unsigned __int64)(-2147418109i64 * (*(_DWORD *)(v1 + 20) - 16) * v22) >> 32)) >> 14;
          v24 = v23 + ((unsigned int)v23 >> 31) + 8;
          v42 = 0;
          v25 = (*(_DWORD *)(v1 + 24) - 16) * rand() / 32767 + 8;
          if ( *(_DWORD *)(v1 + 5216) <= 0 )
            break;
          v26 = v1 + 80;
          v43 = v1 + 80;
          while ( v38 )
          {
            if ( (v24 - *(_DWORD *)(v26 - 4)) * (v24 - *(_DWORD *)(v26 - 4))
               + (v25 - *(_DWORD *)v26) * (v25 - *(_DWORD *)v26) < 400 )
              v38 = 0;
            v27 = *(_DWORD *)(v1 + 5216);
            v26 = v43 + 52;
            v29 = __OFSUB__(v42 + 1, v27);
            v28 = v42++ + 1 - v27 < 0;
            v43 += 52;
            if ( !(v28 ^ v29) )
            {
              if ( v38 )
                goto LABEL_36;
              break;
            }
          }
          if ( v40 >= 1000 )
            goto LABEL_37;
        }
LABEL_36:
        if ( v40 < 1000 )
          goto LABEL_38;
LABEL_37:
        v39 = v20;
LABEL_38:
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 76) = v24;
        *(_DWORD *)(v1 + 52 * (*(_DWORD *)(v1 + 5216) + v20) + 80) = v25;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11196) = -1;
        *(_BYTE *)(v1 + 56 * (*(_DWORD *)(v1 + 16736) + 200)) = 2;
        *(_BYTE *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11201) = 0;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11204) = 8;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11208) = 0;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11212) = 1;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11216) = 4;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11220) = 0;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11224) = *(_DWORD *)(v1 + 5216) + v20;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11228) = 0;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11232) = 26;
        *(_DWORD *)(v1 + 56 * *(_DWORD *)(v1 + 16736) + 11236) = 0;
        v30 = rand();
        v29 = __OFSUB__(v30, 16383);
        v28 = v30 - 16383 < 0;
        v31 = *(_DWORD *)(v1 + 16736);
        if ( v28 ^ v29 )
          *(_DWORD *)(v1 + 56 * v31 + 11192) = 102;
        else
          *(_DWORD *)(v1 + 56 * v31 + 11192) = 66;
        v32 = 16 * *(_DWORD *)(v1 + 18324);
        ++*(_DWORD *)(v1 + 16736);
        *(_DWORD *)(v32 + v1 + 16744) = v25;
        *(_DWORD *)(16 * *(_DWORD *)(v1 + 18324) + v1 + 16740) = v24;
        *(_DWORD *)(16 * *(_DWORD *)(v1 + 18324) + v1 + 16748) = *(_DWORD *)(v1 + 5216) + v20;
        *(_DWORD *)(16 * (*(_DWORD *)(v1 + 18324) + 1047) + v1) = 0;
        ++v20;
        ++*(_DWORD *)(v1 + 18324);
        v41 += 52;
        if ( v20 < v39 )
        {
          v21 = v41;
          v19 = 0;
          continue;
        }
        break;
      }
      v13 = v39;
    }
    *(_DWORD *)(v1 + 5216) += v13;
  }
  v33 = 0;
  if ( *(_DWORD *)(v1 + 16736) > 0 )
  {
    v34 = v1 + 11236;
    do
    {
      v35 = *(_DWORD *)(v34 - 12);
      if ( v35 < 0 )
      {
        if ( v35 == -2 )
        {
          switch ( *(_DWORD *)(v34 - 44) )
          {
            case 0x3B:
            case 0x42:
              v36 = *(_DWORD *)(*(_DWORD *)(v1 + 12) + 8);
              goto LABEL_54;
            case 0x41:
              v37 = *(_DWORD *)(*(_DWORD *)(v1 + 12) + 8);
              *(_DWORD *)v34 = ((BYTE4(v37) & 7) + (signed int)v37) >> 3;
              break;
            case 0x66:
              v36 = *(_DWORD *)(*(_DWORD *)(v1 + 12) + 8);
LABEL_54:
              *(_DWORD *)v34 = v36 / 6;
              break;
            default:
              break;
          }
        }
      }
      else
      {
        switch ( *(_DWORD *)(v34 - 44) )
        {
          case 0x3B:
          case 0x41:
          case 0x42:
          case 0x66:
            *(_DWORD *)v34 = 12;
            break;
          default:
            break;
        }
      }
      ++v33;
      v34 += 56;
    }
    while ( v33 < *(_DWORD *)(v1 + 16736) );
  }
  rand();
  Pinfo_DEPRECATED(dword_78BF34);
}
// 445A10: using guessed type int __thiscall RGE_Game__get_starting_age(_DWORD);

//----- (00537210) --------------------------------------------------------
void __thiscall sub_537210(int this)
{
  int v1; // ebx@1
  double v2; // st7@1
  int v3; // edi@3
  int v4; // esi@4

  v1 = this;
  sub_5407E0(this);
  v2 = ((double)rand() * 0.0018311106 + 70.0) * 0.0099999998;
  if ( *(_DWORD *)(v1 + 60) == 7 )
    v2 = v2 * 5.0;
  v3 = 0;
  if ( *(_DWORD *)(v1 + 20704) > 0 )
  {
    v4 = v1 + 18328;
    do
    {
      *(_DWORD *)v4 = (signed __int64)((double)*(signed int *)v4 * v2);
      ++v3;
      v4 += 24;
    }
    while ( v3 < *(_DWORD *)(v1 + 20704) );
  }
  rand();
  Pinfo_DEPRECATED(dword_78BF34);
}

//----- (005372A0) --------------------------------------------------------
void __thiscall sub_5372A0(void *this)
{
  char *v2; // eax@1
  signed int v3; // ecx@1
  int v4; // eax@3
  int v5; // edx@3
  char *v6; // ecx@4
  int v7; // eax@4
  int v8; // eax@6
  char v9; // [sp+Ch] [bp-39874h]@7
  char v10; // [sp+10h] [bp-39870h]@4
  int v11; // [sp+324h] [bp-3955Ch]@3
  int v12; // [sp+32Ch] [bp-39554h]@3
  int v13; // [sp+380h] [bp-39500h]@3
  char v14; // [sp+4B4h] [bp-393CCh]@1
  int v15; // [sp+4B8h] [bp-393C8h]@3
  int v16; // [sp+50Ch] [bp-39374h]@3
  int v17; // [sp+644h] [bp-3923Ch]@3
  int v18; // [sp+698h] [bp-391E8h]@3
  int v19; // [sp+7D0h] [bp-390B0h]@3
  int v20; // [sp+7DCh] [bp-390A4h]@3
  int v21; // [sp+824h] [bp-3905Ch]@3
  int v22; // [sp+39870h] [bp-10h]@1
  int v23; // [sp+3987Ch] [bp-4h]@6

  v22 = 1;
  v2 = &v14;
  v3 = 99;
  do
  {
    *((_DWORD *)v2 - 99) = 1;
    *(_DWORD *)v2 = 0;
    *((_DWORD *)v2 + 99) = -1;
    *((_DWORD *)v2 + 198) = 1.0f;
    v2 += 4;
    --v3;
  }
  while ( v3 );
  v15 = 1;
  v12 = 2;
  v13 = 2;
  v4 = *(_DWORD *)(this + 5216);
  v16 = 1;
  v5 = 0;
  v19 = 7.0f;
  v21 = 14.0f;
  v20 = 2.0f;
  v17 = 4;
  v18 = 4;
  v11 = v4;
  if ( v4 > 0 )
  {
    v6 = &v10;
    v7 = this + 80;
    do
    {
      ++v5;
      *((_DWORD *)v6 - 1) = *(_DWORD *)(v7 - 4);
      *(_DWORD *)v6 = *(_DWORD *)v7;
      v7 += 52;
      v6 += 8;
    }
    while ( v5 < v11 );
  }
  v8 = operator new(0x398A0u);
  v23 = 0;
  if ( v8 )
    RGE_RMM_Shallows_Generator__constructor(v8, *(_DWORD *)(this + 12), this, &v9);
  v23 = -1;
  rand();
  Pinfo_DEPRECATED(dword_78BF34); // Random Map shallows initilization, rand: %d
}

//----- (00537400) --------------------------------------------------------
int __thiscall RGE_RMM_Shallows_Generator__constructor(int this, int a2, int a3, const void *a4)
{
  _RGE_Random_Map_Module(this, a2, a3, 1);
  __SET_VTABLE__(this, off_RGE_RMM_Shallows_Generator_vtbl_640550);
  *(_DWORD *)(this + 36) = 1074161254; // 0x66 0x66 0x06 0x40
  memcpy((void *)(this + 56), a4, 0x39868u);
  // *(v4 + 235676) = 0
  return this;
}
// 640550: using guessed type int (__thiscall *off_RGE_RMM_Shallows_Generator_vtbl_640550)(void *Memory, char);

//----- (00537440) --------------------------------------------------------
char __thiscall RGE_RMM_Shallows_Generator__sub_537440(int this)
{
  int some_max; // eax@1
  int some_ptr; // ebx@2
  float some_max; // edi@3
  int v5; // esi@4
  int some_count; // [sp+4h] [bp-8h]@1
  
  sub_5418D0(this);
  some_max = *(_DWORD *)(this + 235676);
  some_count = 0;
  if ( some_max > 0 )
  {
    some_ptr = this + 848;
    do
    {
      LODWORD(v4) = 0;
      if ( *(_DWORD *)some_ptr > 0 )
      {
        do
        {
          v5 = LODWORD(v4) + 1;
          if ( LODWORD(v4) + 1 < *(_DWORD *)some_ptr )
          {
            do
              RGE_RMM_Shallows_Generator__sub_5374E0((void *)this, some_count, v4, v5++);
            while ( v5 < *(_DWORD *)some_ptr );
            v5 = LODWORD(v4) + 1;
          }
          LODWORD(v4) = v5;
        }
        while ( v5 < *(_DWORD *)some_ptr );
      }
      some_max = some_count + 1;
      some_ptr += 2380;
      ++some_count;
    }
    while ( some_count < *(_DWORD *)(this + 235676) );
  }
  sub_581DD0(some_max, *(_DWORD *)(this + 12), 0, 0, *(_DWORD *)(this + 20), *(_DWORD *)(this + 24), 1);
  sub_5355B0(this);
  return 1;
}

//----- (005374E0) --------------------------------------------------------
int __thiscall RGE_RMM_Shallows_Generator__sub_5374E0(void *this, int a2, float a3, int a4)
{
  int v4; // edi@1
  int v6; // ebx@1
  float v7; // ebp@1
  int result; // eax@1
  float v9; // ecx@2
  int v10; // edx@23
  int v11; // eax@23
  int v12; // edx@23
  int v13; // edi@23
  int v14; // ebx@23
  int v15; // ebp@23
  int v16; // eax@25
  signed int v17; // edx@25
  int v18; // eax@27
  signed int v19; // ecx@27
  int v20; // edx@27
  int v21; // eax@27
  int v22; // eax@29
  unsigned int v23; // edx@29
  int v24; // eax@29
  int v25; // edx@29
  int i; // ebx@31
  int v27; // edi@32
  int v28; // eax@38
  signed int v29; // ebx@38
  int v30; // [sp+10h] [bp-38h]@1
  float v31; // [sp+14h] [bp-34h]@1
  int v32; // [sp+18h] [bp-30h]@27
  int v33; // [sp+1Ch] [bp-2Ch]@29
  int v34; // [sp+20h] [bp-28h]@1
  int v35; // [sp+24h] [bp-24h]@1
  char *v36; // [sp+28h] [bp-20h]@1
  char v37; // [sp+2Ch] [bp-1Ch]@37
  int v38; // [sp+30h] [bp-18h]@1
  int v39; // [sp+40h] [bp-8h]@7
  int v40; // [sp+44h] [bp-4h]@7

  v4 = a2;
  this = (int)this;
  v34 = *((_DWORD *)this + 14 + 595 * a2 + 2 * LODWORD(a3));
  v35 = *((_DWORD *)this + 15 + 595 * a2 + 2 * LODWORD(a3));
  LODWORD(v7) = *((_DWORD *)this + 15 + 595 * a2 + 2 * a4);
  v30 = *((_DWORD *)this + 14 + 595 * a2 + 2 * a4);
  v6 = v30;
  v31 = v7;
  v36 = (char *)this + 2380 * a2;
  sub_541740((int)&v38);
  sub_541A10((void *)this, v34, v35, (int)&v30, COERCE_FLOAT(&v31), (int)(v36 + 2040));
  result = v30;
  if ( v30 == v6 )
  {
    v9 = v31;
    if ( LODWORD(v31) == LODWORD(v7) )
    {
      a3 = v31;
      a4 = v30;
      if ( v30 >= 0 )
      {
        if ( v30 < *(_DWORD *)(this + 20) && SLODWORD(v31) >= 0 && SLODWORD(v31) < *(_DWORD *)(this + 24) )
        {
          v39 = 0;
          v40 = 0;
          v34 = 0;
          while ( 1 )
          {
            switch ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(this + 44) + 4 * LODWORD(v9)) + result) )
            {
              case 7:
                --LODWORD(v9);
                a3 = v9;
                break;
              case 6:
                ++LODWORD(v9);
                a3 = v9;
                break;
              case 0xB:
                --LODWORD(v9);
                --result;
                a3 = v9;
                a4 = result;
                break;
              case 9:
                --LODWORD(v9);
                ++result;
                a3 = v9;
                a4 = result;
                break;
              case 0xA:
                ++LODWORD(v9);
                a3 = v9;
                goto LABEL_14;
              case 5:
LABEL_14:
                --result;
                a4 = result;
                break;
              case 8:
                ++LODWORD(v9);
                a3 = v9;
                goto LABEL_16;
              case 4:
LABEL_16:
                ++result;
                a4 = result;
                break;
              default:
                v34 = 1;
                break;
            }
            if ( result < 0 )
              break;
            if ( result >= *(_DWORD *)(this + 20) || SLODWORD(v9) < 0 || SLODWORD(v9) >= *(_DWORD *)(this + 24) || v34 )
              break;
            v10 = *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(this + 16) + 4 * LODWORD(v9)) + 32 * result + 5);
            v11 = v10 + 595 * v4;
            v12 = *(_DWORD *)(this + 4 * (595 * v4 + v10) + 1248);
            v13 = *(_DWORD *)(this + 4 * v11 + 852) - v12;
            v14 = 2 * v12;
            v15 = a4 - 2 * v12 * rand() / 32767 - v13;
            if ( v15 < 0 )
              v15 = 0;
            v16 = rand();
            v17 = (signed int)(v14 * v16 + ((unsigned __int64)(-2147418109i64 * v14 * v16) >> 32)) >> 14;
            v35 = LODWORD(a3) - (((unsigned int)v17 >> 31) + v17) - v13;
            if ( v35 < 0 )
              v35 = 0;
            v18 = rand();
            v19 = v14 * v18;
            v20 = a4 + v13 + v14 * v18 / 32767;
            v21 = *(_DWORD *)(this + 20);
            v32 = a4 + v13 + v19 / 32767;
            if ( v20 >= v21 )
              v32 = v21 - 1;
            v22 = rand();
            v23 = v14 * v22 + ((unsigned __int64)(-2147418109i64 * v14 * v22) >> 32);
            v24 = *(_DWORD *)(this + 24);
            v25 = LODWORD(a3) + v13 + (v23 >> 31) + ((signed int)v23 >> 14);
            v33 = v25;
            if ( v25 >= v24 )
            {
              v33 = v24 - 1;
              v25 = v24 - 1;
            }
            for ( i = v35; i <= v25; ++i )
            {
              v27 = v15;
              if ( v15 <= v32 )
              {
                do
                  sub_541790(this, (int)&v38, v27++, i, 0, 0);
                while ( v27 <= v32 );
                v25 = v33;
              }
            }
            v4 = a2;
            *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(this + 44) + 4 * LODWORD(v31)) + v30) = -1;
            result = a4;
            v9 = a3;
            v30 = a4;
            v31 = a3;
          }
          while ( sub_541820((int)&v38, (int)&a4, (int)&a3, (int)&v37) )
          {
            v28 = *(_DWORD *)(*(_DWORD *)(v5 + 16) + 4 * LODWORD(a3)) + 32 * a4 + 5;
            v29 = *(_DWORD *)&v36[4 * *(_BYTE *)v28 + 1644];
            if ( v29 > -1 )
              *(_BYTE *)v28 = v29;
          }
          result = sub_541770((int)&v38);
        }
      }
    }
  }
  return result;
}

//----- (00537850) --------------------------------------------------------
void *__thiscall RGE_RMM_Script_Controller__constructor(void *this, const char *filename, int drs_id)
{
  _RGE_Random_Map_Module((int)this, 0, 0, 0);
  *(_DWORD *)this = &off_rms_vtbl_6405D8;
  *((_DWORD *)this + 79) = drs_id;
  *((_BYTE *)this + 56) = 0;
  if ( filename )
    strcpy((char *)this + 56, filename);
  *((_DWORD *)this + 81) = 0;
  *((_DWORD *)this + 64859) = -1;
  *((_DWORD *)this + 71463) = -1;
  *((_DWORD *)this + 82) = 0;
  *((_DWORD *)this + 83) = 0;
  *((_DWORD *)this + 84) = 0;
  *((_DWORD *)this + 85) = 0;
  *((_DWORD *)this + 86) = 0;
  *((_BYTE *)this + 259420 /* ->current_gen_stat_elevation */) = 0;
  *((_BYTE *)this + 259421 /* ->current_gen_stat_connections */) = 0;
  *((_BYTE *)this + 259422 /* ->current_gen_stat_terrain */) = 0;
  *((_BYTE *)this + 259423 /* ->current_gen_stat_objects */) = 0;
  *((_BYTE *)this + 259424 /* ->current_gen_stat_cliffs */) = 0;
  *((_BYTE *)this + 259425 /* ->current_gen_stat_land */) = 0;
  *((_DWORD *)this + 64857) = 0;
  *((_DWORD *)this + 64858) = 0;
  *((_DWORD *)this + 64860) = 0;
  *((_DWORD *)this + 64861) = 0;
  *((_DWORD *)this + 64962) = 0;
  *((_DWORD *)this + 64862) = 2;
  *((_BYTE *)this + 285856 /* ->current_random */) = 0;
  return this;
}
// 6405D8: using guessed type int (__thiscall *off_rms_vtbl_6405D8)(void *Memory, char);

//----- (00537930) --------------------------------------------------------
void *__thiscall RGE_RMM_Script_Controller__destructor(void *Memory, char a2)
{
  void *v2; // esi@1

  v2 = Memory;
  sub_537950((int)Memory);
  if ( a2 & 1 )
    operator delete(v2);
  return v2;
}

//----- (00537950) --------------------------------------------------------
void __thiscall sub_537950(int this)
{
  int v1; // esi@1

  v1 = this;
  *(_DWORD *)this = &off_rms_vtbl_6405D8;
  if ( *(_DWORD *)(this + 259428) )
    sub_539D30((void **)(this + 259428));
  sub_541330(v1);
}
// 6405D8: using guessed type int (__thiscall *off_rms_vtbl_6405D8)(void *Memory, char);

//----- (005379C0) --------------------------------------------------------
// RMS::generate ();
char __thiscall RandomMapScript__generate(RandomMapScript* this)
{
  int this_unused; // ebp@1
  const char *v2; // esi@1
  char result; // al@2
  int v4; // eax@3
  int v5; // eax@7
  int v6; // eax@8
  signed int v7; // edi@10
  int v8; // eax@15
  int v9; // eax@16
  int v10; // eax@20
  int v11; // eax@21
  int v12; // eax@25
  int v13; // eax@26
  int v14; // eax@30
  int v15; // eax@31
  int v16; // eax@35
  int v17; // edx@36
  int v18; // eax@36
  int v19; // eax@40
  int v20; // eax@41
  int v21; // edx@44
  int v22; // eax@45
  char v23; // [sp-4C4h] [bp-4E4h]@36
  int v24; // [sp-4C0h] [bp-4E0h]@36
  int v25; // [sp-4BCh] [bp-4DCh]@36
  int v26; // [sp-4B8h] [bp-4D8h]@36
  int v27; // [sp-4B4h] [bp-4D4h]@36
  int v28; // [sp-4B0h] [bp-4D0h]@36
  int v29; // [sp-4ACh] [bp-4CCh]@36
  int v30; // [sp-4A8h] [bp-4C8h]@36
  int v31; // [sp-4A4h] [bp-4C4h]@36
  int v32; // [sp-4A0h] [bp-4C0h]@36
  int v33; // [sp-49Ch] [bp-4BCh]@36
  int v34; // [sp-498h] [bp-4B8h]@36
  int v35; // [sp-494h] [bp-4B4h]@36
  int v36; // [sp-490h] [bp-4B0h]@36
  int v37; // [sp-48Ch] [bp-4ACh]@36
  int v38; // [sp-488h] [bp-4A8h]@36
  int v39; // [sp-484h] [bp-4A4h]@36
  int v40; // [sp-480h] [bp-4A0h]@36
  int v41; // [sp-47Ch] [bp-49Ch]@36
  int v42; // [sp-478h] [bp-498h]@36
  int v43; // [sp-474h] [bp-494h]@36
  int v44; // [sp-470h] [bp-490h]@36
  int v45; // [sp-46Ch] [bp-48Ch]@36
  int v46; // [sp-468h] [bp-488h]@36
  int v47; // [sp-464h] [bp-484h]@36
  int v48; // [sp-460h] [bp-480h]@36
  int v49; // [sp-45Ch] [bp-47Ch]@36
  int v50; // [sp-458h] [bp-478h]@36
  int v51; // [sp-454h] [bp-474h]@36
  int v52; // [sp-450h] [bp-470h]@36
  int v53; // [sp-44Ch] [bp-46Ch]@36
  int v54; // [sp-448h] [bp-468h]@36
  int v55; // [sp-444h] [bp-464h]@36
  int v56; // [sp-440h] [bp-460h]@36
  int v57; // [sp-43Ch] [bp-45Ch]@36
  int v58; // [sp-438h] [bp-458h]@36
  int v59; // [sp-434h] [bp-454h]@36
  int v60; // [sp-430h] [bp-450h]@36
  int v61; // [sp-42Ch] [bp-44Ch]@36
  int v62; // [sp-428h] [bp-448h]@36
  int v63; // [sp-424h] [bp-444h]@36
  int v64; // [sp-420h] [bp-440h]@36
  int v65; // [sp-41Ch] [bp-43Ch]@36
  int v66; // [sp-418h] [bp-438h]@36
  int v67; // [sp-414h] [bp-434h]@36
  int v68; // [sp-410h] [bp-430h]@36
  int v69; // [sp-40Ch] [bp-42Ch]@36
  int v70; // [sp-408h] [bp-428h]@36
  int v71; // [sp-404h] [bp-424h]@36
  int v72; // [sp-400h] [bp-420h]@36
  int v73; // [sp-3FCh] [bp-41Ch]@36
  int v74; // [sp-3F8h] [bp-418h]@36
  int v75; // [sp-3F4h] [bp-414h]@36
  int v76; // [sp-3F0h] [bp-410h]@36
  int v77; // [sp-3ECh] [bp-40Ch]@36
  int v78; // [sp-3E8h] [bp-408h]@36
  int v79; // [sp-3E4h] [bp-404h]@36
  int v80; // [sp-3E0h] [bp-400h]@36
  int v81; // [sp-3DCh] [bp-3FCh]@36
  int v82; // [sp-3D8h] [bp-3F8h]@36
  signed int v83; // [sp-4h] [bp-24h]@10
  int v84; // [sp+10h] [bp-10h]@7
  int v85; // [sp+1Ch] [bp-4h]@7

  filename = (const char *)(this + 56);
  if ( *filename )
  {
    v4 = g_game->world;
    *(_DWORD *)(this + 320) = v4;
    if ( v4 )
    {
      if ( dword_6B566C )
        (**(void (__stdcall ***)(_DWORD))dword_6B566C)(1);
      v5 = operator new(0xCECu);
      v84 = v5;
      v85 = 0;
      if ( v5 )
        v6 = constructor_5C3120(v5);
      else
        v6 = 0;
      v7 = -1;
      v85 = -1;
      dword_6B566C = v6;
      sub_5C33D0((void *)v6, (int)"aoe_rmap", 0);
      v83 = (signed int)"Initiating random map Script generation.";
      Pinfo_DEPRECATED(dword_6B566C);
      sub_5416A0(this, *(_DWORD *)(*(_DWORD *)(this + 320) + 52));
      sub_541620(this);
      sub_541540(this);
      (*(void (__thiscall **)(int))(*(_DWORD *)this + 44))(this); // _RandomMapScript__reset
      (*(void (__thiscall **)(int))(*(_DWORD *)this + 12))(this); // _rms__534C90
      sub_539230((void *)this, *(_DWORD *)(this + 316), filename);
      sub_537E00(this);
      if ( *(_BYTE *)(this + 259422 /* ->current_gen_stat_terrain */) )
        *(_BYTE *)(this + 259423 /* ->current_gen_stat_objects */) = 1;
      if ( *(_BYTE *)(this + 259425 /* ->current_gen_stat_land */) )
      {
        *(_BYTE *)(this + 259423 /* ->current_gen_stat_objects */) = 1;
        *(_BYTE *)(this + 259422 /* ->current_gen_stat_terrain */) = 1;
      }
      if ( *(_BYTE *)(this + 259420 /* ->current_gen_stat_elevation */) )
      {
        v8 = operator new(0xFB8u);
        v84 = v8;
        v85 = 1;
        if ( v8 )
          v9 = RGE_RMM_Elevation_Generator__constructor(v8, *(_DWORD *)(this + 12), this, (const void *)(this + 348));
        else
          v9 = 0;
        v85 = -1;
        *(_DWORD *)(this + 324) = v9;
      }
      if ( *(_BYTE *)(this + 259421 /* ->current_gen_stat_connections */) )
      {
        v10 = operator new(0x398A0u);
        v84 = v10;
        v85 = 2;
        if ( v10 )
          v11 = RGE_RMM_Shallows_Generator__constructor(v10, *(_DWORD *)(this + 12), this, (const void *)(this + 4316));
        else
          v11 = 0;
        v85 = -1;
        *(_DWORD *)(this + 328) = v11;
      }
      if ( *(_BYTE *)(this + 259422 /* ->current_gen_stat_terrain */) )
      {
        v12 = operator new(0x1778u);
        v84 = v12;
        v85 = 3;
        if ( v12 )
          v13 = RGE_RMM_Terrain_Generator__constructor(v12, *(_DWORD *)(this + 12), this, (const void *)(this + 239940));
        else
          v13 = 0;
        v85 = -1;
        *(_DWORD *)(this + 332) = v13;
      }
      if ( *(_BYTE *)(this + 259423 /* ->current_gen_stat_objects */) )
      {
        v14 = operator new(0x1C54u);
        v84 = v14;
        v85 = 4;
        if ( v14 )
          v15 = RGE_RMM_Objects_Generator__constructor(v14, *(_DWORD *)(this + 12), this, *(_DWORD *)(this + 320), (const void *)(this + 245888), 1);
        else
          v15 = 0;
        v85 = -1;
        *(_DWORD *)(this + 336) = v15;
      }
      if ( *(_BYTE *)(this + 259424 /* ->current_gen_stat_cliffs */) )
      {
        v16 = operator new(0x514u);
        v84 = v16;
        v85 = 5;
        if ( v16 )
        {
          v17 = *(_DWORD *)(this + 12);
          memcpy(&v23, (const void *)(this + 253024 /* ->cliffs_min_number */), 0x4C4u);
          v18 = RGE_RMM_Cliffs_Generator__constructor(
                  v16,
                  v17,
                  this,
                  v23,
                  v24,
                  v25,
                  v26,
                  v27,
                  v28,
                  v29,
                  v30,
                  v31,
                  v32,
                  v33,
                  v34,
                  v35,
                  v36,
                  v37,
                  v38,
                  v39,
                  v40,
                  v41,
                  v42,
                  v43,
                  v44,
                  v45,
                  v46,
                  v47,
                  v48,
                  v49,
                  v50,
                  v51,
                  v52,
                  v53,
                  v54,
                  v55,
                  v56,
                  v57,
                  v58,
                  v59,
                  v60,
                  v61,
                  v62,
                  v63,
                  v64,
                  v65,
                  v66,
                  v67,
                  v68,
                  v69,
                  v70,
                  v71,
                  v72,
                  v73,
                  v74,
                  v75,
                  v76,
                  v77,
                  v78,
                  v79,
                  v80,
                  v81,
                  v82);
          v7 = -1;
        }
        else
        {
          v18 = 0;
        }
        v85 = v7;
        *(_DWORD *)(this + 340) = v18;
      }
      if ( *(_BYTE *)(this + 259425 /* ->current_gen_stat_land */) )
      {
        v19 = operator new(0x1470u);
        v84 = v19;
        v85 = 6;
        if ( v19 )
          v20 = RGE_RMM_Land_Generator__constructor(v19, *(_DWORD *)(this + 12), this, (const void *)(this + 254244));
        else
          v20 = 0;
        v85 = v7;
        *(_DWORD *)(this + 344) = v20;
      }
      _Terrain__sub_5413A0(this);
      v84 = *(_DWORD *)(this + 332);
      v21 = *(_DWORD *)(this + 344);
      *(_DWORD *)(this + 324) = 0;
      *(_DWORD *)(this + 328) = 0;
      *(_DWORD *)(this + 332) = 0;
      *(_DWORD *)(this + 336) = 0;
      *(_DWORD *)(this + 340) = 0;
      *(_DWORD *)(this + 344) = 0;
      v84 = v21;
      if ( dword_6B566C )
      {
        v22 = *(_DWORD *)dword_6B566C;
        v83 = 1;
        (*(void (__stdcall **)(signed int))v22)(1);
      }
      dword_6B566C = 0;
      if ( *(_DWORD *)(this + 259428) )
        sub_539D30((void **)(this + 259428));
      result = 1;
    }
    else
    {
      result = 0;
    }
  }
  else
  {
    result = 0;
  }
  return result;
}
// 541540: using guessed type int __thiscall sub_541540(_DWORD);

//----- (00537D60) --------------------------------------------------------
signed int __thiscall _RandomMapScript__reset(int this)
{
  memset((void *)(this + 348), 0, 0xF80u);
  memset((void *)(this + 4316), 0, 0x39868u);
  memset((void *)(this + 239940), 0, 0x173Cu);
  memset((void *)(this + 245888), 0, 0x1BE0u);
  memset((void *)(this + 253024 /* ->cliffs_min_number */), 0, 0x4C4u);
  memset((void *)(this + 254244), 0, 0x1438u);
  *(_DWORD *)(this + 253024 /* ->cliffs_min_number */) = 3;
  *(_DWORD *)(this + 253028 /* ->cliffs_max_number */) = 9;
  *(_DWORD *)(this + 253036 /* ->max_length_cliffs */) = 9;
  *(_DWORD *)(this + 253032 /* ->min_length_cliffs */) = 5;
  *(_DWORD *)(this + 253040 /* ->cliff_curliness */) = 36;
  *(_DWORD *)(this + 253048 /* ->cliffs_min_distance */) = 2;
  *(_DWORD *)(this + 253044 /* ->terrain_min_distance */) = 2;
  return 2; // not used probably
}

//----- (00537E00) --------------------------------------------------------
int __thiscall sub_537E00(int this)
{
  int v1; // ebx@1
  signed int v2; // ebp@1
  signed int v3; // edi@2
  signed int v4; // esi@3
  int v5; // esi@11
  int v6; // eax@14
  signed int v7; // ebp@14
  signed int v8; // edi@14
  int v9; // eax@15
  signed int v10; // edx@15
  int v11; // edx@15
  int v12; // eax@15
  int v13; // ecx@19
  int v14; // eax@19
  int v15; // edi@20
  int v16; // ecx@24
  int v17; // edx@24
  int v18; // ebp@28
  int v19; // eax@30
  int v20; // ecx@44
  bool v21; // sf@44
  unsigned __int8 v22; // of@44
  int v23; // esi@45
  int v24; // ecx@46
  int v25; // eax@46
  int v26; // edx@46
  int v27; // eax@48
  int v28; // esi@49
  signed int v29; // ecx@49
  int v30; // edi@49
  int v31; // edx@50
  int v32; // eax@50
  int v33; // ebp@51
  int v34; // esi@55
  int v35; // ecx@56
  int v36; // eax@59
  int v37; // ecx@66
  int v38; // eax@67
  int v39; // edi@71
  int v40; // esi@72
  int v41; // ebp@72
  signed int v42; // edx@76
  int v43; // ecx@78
  int v44; // eax@79
  int result; // eax@83
  int v46; // edi@84
  int v47; // edx@84
  int v48; // ebp@88
  int v49; // edi@90
  int v50; // esi@91
  int v51; // eax@93
  int v52; // ecx@94
  int v53; // esi@99
  int v54; // ecx@100
  int v55; // eax@100
  int v56; // ebp@101
  int v57; // esi@103
  int v58; // eax@104
  int v59; // [sp+10h] [bp-54h]@10
  int v60; // [sp+10h] [bp-54h]@83
  int v61; // [sp+14h] [bp-50h]@1
  int v62; // [sp+18h] [bp-4Ch]@19
  signed int v63; // [sp+1Ch] [bp-48h]@14
  int v64; // [sp+1Ch] [bp-48h]@84
  int v65; // [sp+20h] [bp-44h]@11
  void *v66; // [sp+20h] [bp-44h]@88
  int v67; // [sp+24h] [bp-40h]@19
  signed int v68; // [sp+28h] [bp-3Ch]@14
  int v69; // [sp+2Ch] [bp-38h]@14
  int v70; // [sp+30h] [bp-34h]@14
  int v71; // [sp+34h] [bp-30h]@14
  int v72; // [sp+38h] [bp-2Ch]@14
  signed int v73; // [sp+3Ch] [bp-28h]@14
  int v74[9]; // [sp+40h] [bp-24h]@7

  v1 = this;
  v2 = 1;
  v61 = 0;
  if ( *(_WORD *)(*(_DWORD *)(this + 320) + 72) > 1 )
  {
    v3 = 1;
    do
    {
      v4 = 1;
      if ( v3 > 1 )
      {
        do
        {
          if ( (*(int (__stdcall **)(signed int))(**(_DWORD **)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + v3 * 4) + 28))(v4) )
            break;
          ++v4;
        }
        while ( v4 < v2 );
      }
      if ( v4 == v2 )
      {
        ++v61;
        v74[v3] = v61;
      }
      else
      {
        v74[v3] = v74[v4];
      }
      ++v2;
      ++v3;
    }
    while ( v2 < *(_WORD *)(*(_DWORD *)(v1 + 320) + 72) );
  }
  (*(void (__thiscall **)(int))(*(_DWORD *)v1 + 8))(v1);
  v59 = 0;
  if ( *(_DWORD *)(v1 + 259392) > 0 )
  {
    v5 = v1 + 254276;
    v65 = v1 + 286672;
    do
    {
      if ( *(_DWORD *)(v5 - 24) >= 0 && *(_DWORD *)(v5 - 20) >= 0 )
        goto LABEL_44;
      v6 = -2 * *(_DWORD *)(v5 - 16);
      v7 = v6 + *(_DWORD *)(v5 + 8) - *(_DWORD *)v5;
      v68 = v7;
      v8 = *(_DWORD *)(v5 + 12) + v6 - *(_DWORD *)(v5 + 4);
      v73 = v8;
      v69 = v7 / 3;
      v70 = v7 - v7 / 3;
      v63 = 990;
      v71 = v8 / 3;
      v72 = v8 - v8 / 3;
LABEL_15:
      while ( 2 )
      {
        v9 = rand();
        v10 = (signed int)(v7 * v9 + ((unsigned __int64)(-2147418109i64 * v7 * v9) >> 32)) >> 14;
        *(_DWORD *)(v5 - 24) = ((unsigned int)v10 >> 31) + v10;
        v11 = v8 * rand() / 32767;
        *(_DWORD *)(v5 - 20) = v11;
        v12 = *(_DWORD *)(v5 - 24);
        if ( v12 >= v69 && v12 <= v70 || v11 >= v71 && v11 <= v72 )
        {
          *(_DWORD *)(v5 - 24) = *(_DWORD *)v5 + v12 + *(_DWORD *)(v5 - 16);
          v13 = *(_DWORD *)(v5 - 16) + *(_DWORD *)(v5 + 4) + *(_DWORD *)(v5 - 20);
          v14 = 0;
          *(_DWORD *)(v5 - 20) = v13;
          v67 = v13;
          v62 = 0;
          if ( *(_DWORD *)(v1 + 259392) <= 0 )
            goto LABEL_38;
          v15 = v1 + 254252;
          while ( 1 )
          {
            if ( v14 != v59 && *(_DWORD *)v15 > -1 && v13 > -1 )
            {
              v16 = *(_DWORD *)(v5 - 24) - *(_DWORD *)v15;
              v17 = v67 - *(_DWORD *)(v15 + 4);
              if ( v16 < 0 )
                v16 = -v16;
              if ( v17 < 0 )
                v17 = -v17;
              v18 = *(_DWORD *)(v15 + 12);
              if ( *(_DWORD *)(v5 - 12) > v18 )
                v18 = *(_DWORD *)(v5 - 12);
              v19 = *(_DWORD *)v65;
              if ( *(_DWORD *)v65 < 0 )
                v19 = v18 + *(_DWORD *)(v5 - 16) + *(_DWORD *)(v15 + 8);
              if ( v16 < v19 && v17 < v19 )
              {
                v14 = v62;
                v7 = v68;
LABEL_38:
                if ( v14 == *(_DWORD *)(v1 + 259392) )
                  goto LABEL_44;
                --v63;
                if ( v63 <= 0 )
                  goto LABEL_43;
                v8 = v73;
                goto LABEL_15;
              }
              v14 = v62;
              v7 = v68;
              v13 = v67;
            }
            ++v14;
            v15 += 52;
            v62 = v14;
            if ( v14 >= *(_DWORD *)(v1 + 259392) )
              goto LABEL_38;
          }
        }
        if ( v63 > 0 )
          continue;
        break;
      }
      if ( v63 != -1 )
        goto LABEL_44;
LABEL_43:
      *(_DWORD *)(v5 - 24) = *(_DWORD *)(v1 + 20) / 2;
      *(_DWORD *)(v5 - 20) = *(_DWORD *)(v1 + 24) / 2;
LABEL_44:
      v20 = *(_DWORD *)(v1 + 259392);
      v5 += 52;
      v22 = __OFSUB__(v59 + 1, v20);
      v21 = v59++ + 1 - v20 < 0;
      v65 += 4;
    }
    while ( v21 ^ v22 );
  }
  v23 = 0;
  if ( *(_DWORD *)(v1 + 259392) > 0 )
  {
    v24 = v1 + 253056;
    v25 = v1 + 254256;
    v26 = v1 + 251440;
    do
    {
      ++v23;
      *(_DWORD *)(v26 - 4) = *(_DWORD *)(v25 - 4);
      *(_DWORD *)v26 = *(_DWORD *)v25;
      *(_DWORD *)(v24 - 4) = *(_DWORD *)(v25 - 4);
      *(_DWORD *)v24 = *(_DWORD *)v25;
      *(_DWORD *)(v24 + 4) = 15;
      v26 += 16;
      v25 += 52;
      v24 += 12;
    }
    while ( v23 < *(_DWORD *)(v1 + 259392) );
  }
  v27 = *(_DWORD *)(v1 + 259392);
  *(_DWORD *)(v1 + 254240) = v27;
  if ( v27 <= 0 )
  {
    v28 = *(_DWORD *)(v1 + 320);
    v29 = 1;
    v30 = 0;
    if ( *(_WORD *)(v28 + 72) > 1 )
    {
      v31 = v1 + 253056;
      v32 = v1 + 251440;
      do
      {
        v33 = *(_DWORD *)(*(_DWORD *)(v28 + 76) + 4 * v29);
        if ( *(_QWORD *)(v33 + 392) >= 0i64 )
        {
          *(_DWORD *)(v32 - 4) = *(_DWORD *)(v33 + 392);
          ++v30;
          v31 += 12;
          v32 += 16;
          *(_DWORD *)(v32 - 16) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 396);
          *(_DWORD *)(v32 - 12) = 1;
          *(_DWORD *)(v32 - 8) = v29;
          *(_DWORD *)(v32 - 7156) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 392);
          *(_DWORD *)(v32 - 7152) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 396);
          *(_DWORD *)(v32 - 7148) = 13;
          *(_DWORD *)(v32 - 7144) = 20;
          *(_DWORD *)(v31 - 16) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 392);
          *(_DWORD *)(v31 - 12) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 396);
          *(_DWORD *)(v31 - 8) = 15;
          *(_DWORD *)(v32 - 248728) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 392);
          *(_DWORD *)(v32 - 248724) = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v1 + 320) + 76) + 4 * v29) + 396);
          *(_DWORD *)(v32 - 248720) = 13;
          *(_DWORD *)(v32 - 248716) = 20;
        }
        v28 = *(_DWORD *)(v1 + 320);
        ++v29;
      }
      while ( v29 < *(_WORD *)(v28 + 72) );
    }
    *(_DWORD *)(v1 + 253020) = v30;
    *(_DWORD *)(v1 + 245884) = v30;
    *(_DWORD *)(v1 + 254240) = v30;
    *(_DWORD *)(v1 + 4312) = v30;
  }
  v34 = 0;
  if ( *(_DWORD *)(v1 + 244296) > 0 )
  {
    v35 = v1 + 239940;
    while ( *(_BYTE *)(v1 + v34 + 287072) == 1 )
    {
      v36 = *(_DWORD *)v35;
      if ( *(_DWORD *)v35 > 0 )
        goto LABEL_62;
LABEL_63:
      if ( *(_DWORD *)v35 < 0 )
        *(_DWORD *)v35 = *(_DWORD *)v35 * *(_DWORD *)(v1 + 20) * *(_DWORD *)(v1 + 24) / -100;
      ++v34;
      v35 += 44;
      if ( v34 >= *(_DWORD *)(v1 + 244296) )
        goto LABEL_66;
    }
    if ( *(_BYTE *)(v1 + v34 + 287072) != 2
      || (*(_DWORD *)(v35 + 12) = *(_DWORD *)(v1 + 20) * *(_DWORD *)(v1 + 24) * *(_DWORD *)(v35 + 12) / 10000,
          v36 = *(_DWORD *)v35,
          *(_DWORD *)v35 <= 0) )
      goto LABEL_63;
LABEL_62:
    *(_DWORD *)v35 = v36 * *(_DWORD *)(v1 + 20) * *(_DWORD *)(v1 + 24) / 10000;
    goto LABEL_63;
  }
LABEL_66:
  v37 = 0;
  if ( *(_DWORD *)(v1 + 259392) > 0 )
  {
    v38 = v1 + 251436;
    do
    {
      if ( *(_DWORD *)(v38 + 12) > 0 )
      {
        *(_DWORD *)(16 * *(_DWORD *)(v1 + 245884) + v1 + 244300) = *(_DWORD *)v38;
        *(_DWORD *)(16 * (*(_DWORD *)(v1 + 245884) + 15269) + v1) = *(_DWORD *)(v38 + 4);
        *(_DWORD *)(16 * *(_DWORD *)(v1 + 245884) + v1 + 244308) = 13;
        *(_DWORD *)(16 * (*(_DWORD *)(v1 + 245884))++ + v1 + 244312) = 20;
      }
      ++v37;
      v38 += 16;
    }
    while ( v37 < *(_DWORD *)(v1 + 259392) );
  }
  v39 = 0;
  if ( *(_DWORD *)(v1 + 2724) > 0 )
  {
    v40 = v1 + 348;
    v41 = v1 + 287180;
    do
    {
      if ( *(_DWORD *)v41 == 1 )
      {
        v42 = (signed int)((unsigned __int64)(1759218605i64
                                            * *(_DWORD *)v40
                                            * *(_DWORD *)(v1 + 20)
                                            * *(_DWORD *)(v1 + 24)) >> 32) >> 12;
        *(_DWORD *)v40 = ((unsigned int)v42 >> 31) + v42;
      }
      else
      {
        if ( *(_DWORD *)v41 == 2 )
          *(_DWORD *)(v40 + 8) = *(_DWORD *)(v40 + 8) * *(_DWORD *)(v1 + 20) * *(_DWORD *)(v1 + 24) / 10000;
      }
      ++v39;
      v41 += 4;
      v40 += 24;
    }
    while ( v39 < *(_DWORD *)(v1 + 2724) );
  }
  v43 = 0;
  if ( *(_DWORD *)(v1 + 259392) > 0 )
  {
    v44 = v1 + 251436;
    do
    {
      if ( *(_DWORD *)(v44 + 12) > 0 )
      {
        *(_DWORD *)(16 * *(_DWORD *)(v1 + 4312) + v1 + 2728) = *(_DWORD *)v44;
        *(_DWORD *)(16 * *(_DWORD *)(v1 + 4312) + v1 + 2732) = *(_DWORD *)(v44 + 4);
        *(_DWORD *)(16 * (*(_DWORD *)(v1 + 4312) + 171) + v1) = 13;
        *(_DWORD *)(16 * (*(_DWORD *)(v1 + 4312))++ + v1 + 2740) = 20;
      }
      ++v43;
      v44 += 16;
    }
    while ( v43 < *(_DWORD *)(v1 + 259392) );
  }
  result = *(_DWORD *)(v1 + 239936);
  v60 = 0;
  if ( result > 0 )
  {
    v46 = -5108 - v1;
    v47 = v1 + 5108;
    v64 = v1 + 287584;
    while ( 1 )
    {
      switch ( *(_DWORD *)v64 )
      {
        case 0x40:
          if ( result < result + v61 - 1 )
          {
            v48 = v1 + 4 * result + 287584;
            v66 = (void *)(v1 + 2380 * result + 4316);
            do
            {
              *(_DWORD *)v48 = -1;
              memcpy(v66, (const void *)(v47 - 792), 0x94Cu);
              ++result;
              v48 += 4;
              v66 = (char *)v66 + 2380;
            }
            while ( result < *(_DWORD *)(v1 + 239936) + v61 - 1 );
          }
          v49 = 0;
          if ( *(_DWORD *)(v1 + 259392) > 0 )
          {
            v50 = v1 + 251448;
            do
            {
              if ( *(_DWORD *)v50 > 0 )
              {
                v51 = v74[*(_DWORD *)v50];
                if ( v51 <= 1 )
                  v52 = v60;
                else
                  v52 = *(_DWORD *)(v1 + 239936) + v51 - 2;
                *(_DWORD *)(2380 * v52 + 8 * *(_DWORD *)(2380 * v52 + v1 + 5108) + v1 + 4316) = *(_DWORD *)(v50 - 12);
                *(_DWORD *)(2380 * v52 + 8 * (*(_DWORD *)(2380 * v52 + v1 + 5108))++ + 4320 + v1) = *(_DWORD *)(v50 - 8);
              }
              ++v49;
              v50 += 16;
            }
            while ( v49 < *(_DWORD *)(v1 + 259392) );
          }
          *(_DWORD *)(v1 + 239936) += v61 - 1;
          break;
        case 0x41:
        case 0x42:
          v53 = 0;
          if ( *(_DWORD *)(v1 + 259392) > 0 )
          {
            v54 = v46 + v47;
            v55 = v1 + 251440;
            do
            {
              v56 = *(_DWORD *)(v55 - 4);
              v55 += 16;
              *(_DWORD *)(v54 + 8 * *(_DWORD *)v47 + v1 + 4316) = v56;
              *(_DWORD *)(v54 + 8 * *(_DWORD *)v47 + 4320 + v1) = *(_DWORD *)(v55 - 16);
              ++v53;
              ++*(_DWORD *)v47;
            }
            while ( v53 < *(_DWORD *)(v1 + 259392) );
          }
          break;
        case 0x3F:
          v57 = 0;
          if ( *(_DWORD *)(v1 + 259392) > 0 )
          {
            v58 = v1 + 251436;
            while ( 1 )
            {
              if ( *(_DWORD *)(v58 + 12) > 0 )
              {
                *(_DWORD *)(v46 + v47 + 8 * *(_DWORD *)v47 + v1 + 4316) = *(_DWORD *)v58;
                *(_DWORD *)(v46 + v47 + 8 * (*(_DWORD *)v47)++ + 4320 + v1) = *(_DWORD *)(v58 + 4);
              }
              ++v57;
              v58 += 16;
              if ( v57 >= *(_DWORD *)(v1 + 259392) )
                break;
              v46 = -5108 - v1;
            }
          }
          break;
        default:
          break;
      }
      result = *(_DWORD *)(v1 + 239936);
      v47 += 2380;
      v22 = __OFSUB__(v60 + 1, result);
      v21 = v60++ + 1 - result < 0;
      v64 += 4;
      if ( !(v21 ^ v22) )
        break;
      v46 = -5108 - v1;
    }
  }
  return result;
}
// 537E00: using guessed type int var_24[9];

//----- (005386A0) --------------------------------------------------------
char __thiscall _RandomMapScript__sub_5386A0_if_teams_together(int this)
{
  int v1; // eax@1
  int v2; // ebx@1
  int v3; // esi@1
  int v4; // edx@2
  int v5; // ecx@2
  int v6; // edi@4
  int v7; // ecx@6
  int v8; // edi@10
  bool v9; // zf@12
  int v10; // edi@15
  int v11; // ebx@15
  int v12; // ebp@15
  int v13; // eax@15
  signed int v14; // edi@15
  char *v15; // esi@15
  char v16; // bl@16
  int v17; // eax@16
  char *v18; // eax@19
  signed int v19; // ecx@19
  int v20; // esi@25
  unsigned int v21; // ecx@25
  int v22; // edx@26
  unsigned int v23; // ecx@26
  char *v24; // edi@26
  int i; // ecx@26
  int v26; // eax@29
  int v27; // ebx@29
  signed int v28; // edx@29
  int v29; // edx@29
  int v30; // eax@30
  char *v31; // ecx@31
  int v32; // edi@31
  int v33; // esi@41
  int v34; // ecx@43
  int v35; // ecx@50
  bool v36; // sf@50
  unsigned __int8 v37; // of@50
  signed int v39; // [sp+10h] [bp-23Ch]@1
  char *v40; // [sp+10h] [bp-23Ch]@29
  int v41; // [sp+10h] [bp-23Ch]@41
  int v42; // [sp+14h] [bp-238h]@2
  signed int v43; // [sp+14h] [bp-238h]@29
  char *v44; // [sp+14h] [bp-238h]@41
  int v45; // [sp+18h] [bp-234h]@1
  int v46; // [sp+1Ch] [bp-230h]@2
  int v47; // [sp+1Ch] [bp-230h]@15
  int v48; // [sp+20h] [bp-22Ch]@1
  int v49; // [sp+24h] [bp-228h]@1
  int v50; // [sp+28h] [bp-224h]@30
  int v51; // [sp+28h] [bp-224h]@40
  int v52; // [sp+2Ch] [bp-220h]@15
  int v53; // [sp+30h] [bp-21Ch]@15
  int v54; // [sp+34h] [bp-218h]@15
  int v55; // [sp+38h] [bp-214h]@15
  char v56; // [sp+3Ch] [bp-210h]@15
  char v57[100]; // [sp+5Ch] [bp-1F0h]@26
  char v58; // [sp+C0h] [bp-18Ch]@31

  v1 = *(_DWORD *)(this + 259392);
  v2 = *(_DWORD *)(this + 24);
  v3 = *(_DWORD *)(this + 20);
  v49 = this;
  v39 = 0;
  v45 = 0;
  v48 = 0;
  if ( v1 <= 0 )
    goto LABEL_54;
  v4 = this + 254276;
  v5 = this + 251448;
  v42 = v5;
  v46 = v1;
  do
  {
    if ( *(_DWORD *)v5 > 0 )
    {
      v6 = *(_DWORD *)(v4 - 16);
      ++v39;
      if ( -2 * v6 + *(_DWORD *)(v4 + 8) - *(_DWORD *)v4 < v3 )
        v3 = -2 * v6 + *(_DWORD *)(v4 + 8) - *(_DWORD *)v4;
      v7 = *(_DWORD *)(v4 + 4);
      if ( *(_DWORD *)(v4 + 12) + -2 * v6 - v7 < v2 )
        v2 = *(_DWORD *)(v4 + 12) + -2 * v6 - v7;
      if ( v6 + *(_DWORD *)v4 > v45 )
        v45 = v6 + *(_DWORD *)v4;
      v8 = v7 + v6;
      if ( v8 > v48 )
        v48 = v8;
    }
    v5 = v42 + 16;
    v4 += 52;
    v9 = v46 == 1;
    v42 += 16;
    --v46;
  }
  while ( !v9 );
  if ( v39 < 1 )
LABEL_54:
    v39 = 1;
  v10 = 6 * v3 / 10;
  v11 = 6 * v2 / 10;
  v12 = 2 * v3 / 10;
  v47 = v11 + v10;
  v13 = 2 * (v11 + v10) / v39;
  v54 = 6 * v3 / 10;
  v52 = v11;
  v53 = v10 + v11 + v10;
  v14 = 0;
  v15 = &v56;
  v55 = v13;
  while ( 1 )
  {
    v16 = 1;
    v17 = 8 * rand() / 32767 + 1;
    *(_DWORD *)v15 = v17;
    if ( v17 == 9 )
      *(_DWORD *)v15 = 8;
    if ( v14 <= 0 )
      goto LABEL_55;
    v18 = &v56;
    v19 = v14;
    do
    {
      if ( *(_DWORD *)v18 == *(_DWORD *)v15 )
        v16 = 0;
      v18 += 4;
      --v19;
    }
    while ( v19 );
    if ( v16 )
    {
LABEL_55:
      ++v14;
      v15 += 4;
      if ( v14 >= 8 )
        break;
    }
  }
  v20 = v49;
  v21 = *(_DWORD *)(v49 + 259392);
  if ( (signed int)v21 > 0 )
  {
    v22 = *(_DWORD *)(v49 + 259392);
    v23 = v21 >> 2;
    memset(v57, 0, 4 * v23);
    v24 = &v57[4 * v23];
    for ( i = v22 & 3; i; --i )
      *v24++ = 0;
  }
  v26 = rand();
  v27 = *(_DWORD *)(v49 + 259392);
  v43 = 8;
  v28 = (signed int)(2 * v47 * v26 + ((unsigned __int64)(-2147418109i64 * 2 * v47 * v26) >> 32)) >> 14;
  v40 = &v56;
  v29 = ((unsigned int)v28 >> 31) + v28;
  do
  {
    v50 = *(_DWORD *)v40;
    v30 = 0;
    if ( v27 > 0 )
    {
      v31 = &v58;
      v32 = v20 + 251448;
      do
      {
        if ( !v57[v30] )
        {
          if ( *(_DWORD *)v32 > 0 )
          {
            if ( *(_DWORD *)v32 == v50 )
            {
              *(_DWORD *)v31 = v29;
              v29 += v55;
              v57[v30] = 1;
              if ( v29 >= 2 * v47 )
                v29 -= 2 * v47;
            }
          }
        }
        ++v30;
        v32 += 16;
        v31 += 4;
      }
      while ( v30 < v27 );
      v20 = v49;
    }
    v9 = v43 == 1;
    v40 += 4;
    --v43;
  }
  while ( !v9 );
  v51 = 0;
  if ( v27 > 0 )
  {
    v33 = v20 + 254256;
    v44 = &v58;
    v41 = v49 + 251448;
    do
    {
      if ( *(_DWORD *)v41 > 0 )
      {
        v34 = *(_DWORD *)v44;
        if ( *(_DWORD *)v44 >= v54 )
        {
          if ( v34 >= v47 )
          {
            if ( v34 >= v53 )
            {
              *(_DWORD *)(v33 - 4) = v45 + v12 / 2;
              *(_DWORD *)v33 = v48 + v52 + v12 + v53 - v34;
            }
            else
            {
              *(_DWORD *)(v33 - 4) = v45 + v54 + v12 + v47 - v34;
              *(_DWORD *)v33 = v48 + v52 + v12 / 2;
            }
          }
          else
          {
            *(_DWORD *)(v33 - 4) = v45 + v54 + v12 / 2;
            *(_DWORD *)v33 = v48 + v12 + v34 - v54;
          }
        }
        else
        {
          *(_DWORD *)(v33 - 4) = v45 + v12 + v34;
          *(_DWORD *)v33 = v48 + v12 / 2;
        }
      }
      v35 = *(_DWORD *)(v49 + 259392);
      v33 += 52;
      v37 = __OFSUB__(v51 + 1, v35);
      v36 = v51++ + 1 - v35 < 0;
      v41 += 16;
      v44 += 4;
    }
    while ( v36 ^ v37 );
  }
  return 1;
}
// 5386A0: using guessed type char var_1F0[100];

//----- (00538A10) --------------------------------------------------------
int __thiscall RGE_RMM_Script_Controller__sub_538A10(void *this)
{
  int result; // eax@1

  sub_539AA0(this, 8500, 0, 1, 0, 0, 0);
  sub_539AA0(this, 8501, 1, 1, 0, 0, 0);
  sub_539AA0(this, 8502, 2, 1, 2, 0, 0);
  sub_539AA0(this, 8503, 3, 4, 0, 0, 0);
  sub_539AA0(this, 8504, 4, 4, 0, 0, 0);
  sub_539AA0(this, 8505, 5, 0, 0, 0, 0);
  sub_539AA0(this, 8506, 6, 0, 0, 0, 0);
  sub_539AA0(this, 8507, 7, 0, 0, 0, 0);
  sub_539AA0(this, 8508, 8, 2, 0, 0, 0);
  sub_539AA0(this, 8509, 9, 0, 0, 0, 0);
  sub_539AA0(this, 8510, 10, 5, 0, 0, 0);
  sub_539AA0(this, 8511, 11, 0, 0, 0, 0);
  sub_539AA0(this, 8512, 12, 0, 0, 0, 0);
  sub_539AA0(this, 8513, 13, 0, 0, 0, 0);
  sub_539AA0(this, 8514, 14, 0, 0, 0, 0);
  sub_539AA0(this, 8515, 15, 0, 0, 0, 0);
  sub_539AA0(this, 8516, 16, 0, 0, 0, 0);
  sub_539AA0(this, 8517, 17, 0, 0, 0, 0);
  sub_539AA0(this, 8518, 18, 2, 0, 0, 0);
  sub_539AA0(this, 8571, 71, 2, 2, 0, 0);
  sub_539AA0(this, 8572, 72, 2, 0, 0, 0);
  sub_539AA0(this, 8519, 19, 3, 0, 0, 0);
  sub_539AA0(this, 8520, 20, 0, 0, 0, 0);
  sub_539AA0(this, 8521, 21, 3, 0, 0, 0);
  sub_539AA0(this, 8522, 22, 2, 0, 0, 0);
  sub_539AA0(this, 8523, 23, 2, 0, 0, 0);
  sub_539AA0(this, 8524, 24, 2, 0, 0, 0);
  sub_539AA0(this, 8525, 25, 2, 0, 0, 0);
  sub_539AA0(this, 8526, 26, 2, 0, 0, 0);
  sub_539AA0(this, 8527, 27, 2, 0, 0, 0);
  sub_539AA0(this, 8528, 28, 2, 0, 0, 0);
  sub_539AA0(this, 8529, 29, 0, 0, 0, 0);
  sub_539AA0(this, 8530, 30, 0, 0, 0, 0);
  sub_539AA0(this, 8531, 31, 2, 0, 0, 0);
  sub_539AA0(this, 8532, 32, 0, 0, 0, 0);
  sub_539AA0(this, 8533, 33, 2, 0, 0, 0);
  sub_539AA0(this, 8534, 34, 0, 0, 0, 0);
  sub_539AA0(this, 8535, 35, 2, 0, 0, 0);
  sub_539AA0(this, 8536, 36, 2, 0, 0, 0);
  sub_539AA0(this, 8537, 37, 2, 0, 0, 0);
  sub_539AA0(this, 8538, 38, 2, 0, 0, 0);
  sub_539AA0(this, 8539, 39, 2, 0, 0, 0);
  sub_539AA0(this, 8540, 40, 2, 0, 0, 0);
  sub_539AA0(this, 8541, 41, 2, 0, 0, 0);
  sub_539AA0(this, 8542, 42, 0, 0, 0, 0);
  sub_539AA0(this, 8543, 43, 3, 0, 0, 0);
  sub_539AA0(this, 8544, 44, 2, 0, 0, 0);
  sub_539AA0(this, 8545, 45, 2, 0, 0, 0);
  sub_539AA0(this, 8546, 46, 2, 0, 0, 0);
  sub_539AA0(this, 8547, 47, 0, 0, 0, 0);
  sub_539AA0(this, 8548, 48, 3, 0, 0, 0);
  sub_539AA0(this, 8549, 49, 0, 0, 0, 0);
  sub_539AA0(this, 8550, 50, 2, 0, 0, 0);
  sub_539AA0(this, 8551, 51, 2, 0, 0, 0);
  sub_539AA0(this, 8552, 52, 2, 0, 0, 0);
  sub_539AA0(this, 8553, 53, 2, 0, 0, 0);
  sub_539AA0(this, 8554, 54, 0, 0, 0, 0);
  sub_539AA0(this, 8555, 55, 0, 0, 0, 0);
  sub_539AA0(this, 8556, 56, 3, 0, 0, 0);
  sub_539AA0(this, 8557, 57, 0, 0, 0, 0);
  sub_539AA0(this, 8558, 58, 0, 0, 0, 0);
  sub_539AA0(this, 8559, 59, 2, 0, 0, 0);
  sub_539AA0(this, 8560, 60, 2, 0, 0, 0);
  sub_539AA0(this, 8561, 61, 2, 0, 0, 0);
  sub_539AA0(this, 8562, 62, 0, 0, 0, 0);
  sub_539AA0(this, 8563, 63, 0, 0, 0, 0);
  sub_539AA0(this, 8564, 64, 0, 0, 0, 0);
  sub_539AA0(this, 8565, 65, 0, 0, 0, 0);
  sub_539AA0(this, 8566, 66, 0, 0, 0, 0);
  sub_539AA0(this, 8567, 67, 0, 0, 0, 0);
  sub_539AA0(this, 8568, 68, 0, 0, 0, 0);
  sub_539AA0(this, 8569, 69, 0, 0, 0, 0);
  sub_539AA0(this, 8570, 70, 0, 0, 0, 0);
  sub_539AA0(this, 8573, 73, 2, 0, 0, 0);
  sub_539AA0(this, 8574, 74, 2, 0, 0, 0);
  sub_539AA0(this, 8575, 75, 0, 0, 0, 0);
  sub_539AA0(this, 8576, 76, 0, 0, 0, 0);
  sub_539AA0(this, 8577, 77, 0, 0, 0, 0);
  sub_539AA0(this, 8578, 78, 2, 0, 0, 0);
  sub_539AA0(this, 8579, 79, 0, 0, 0, 0);
  sub_539AA0(this, 8580, 80, 2, 0, 0, 0);
  sub_539AA0(this, 8581, 81, 2, 0, 0, 0);
  sub_539AA0(this, 8582, 82, 3, 0, 0, 0);
  sub_539AA0(this, 8583, 83, 3, 3, 0, 0);
  sub_539AA0(this, 8584, 84, 3, 2, 0, 0);
  sub_539AA0(this, 8585, 85, 3, 2, 2, 0);
  sub_539AA0(this, 8586, 86, 2, 0, 0, 0);
  sub_539AA0(this, 8587, 87, 0, 0, 0, 0);
  sub_539AA0(this, 8588, 88, 2, 2, 0, 0);
  sub_539AA0(this, 8589, 89, 0, 0, 0, 0);
  sub_539AA0(this, 8591, 91, 2, 0, 0, 0);
  sub_539AA0(this, 8592, 92, 5, 2, 0, 0);
  sub_539AA0(this, 8593, 93, 2, 0, 0, 0);
  result = sub_539BB0(*((_DWORD *)this + 64857), 94, 1);
  *((_DWORD *)this + 64857) = result;
  return result;
}

//----- (00539230) --------------------------------------------------------
void *__thiscall sub_539230(void *this, int a2, const char *a3)
{
  int v3; // esi@1
  void *result; // eax@2
  FILE *File; // [sp+4h] [bp-108h]@3
  char Filename; // [sp+8h] [bp-104h]@3

  v3 = (int)this;
  if ( a2 == -1 )
  {
    sub_539230(54000, &NULL);
    result = (void *)sub_5392D0(v3, a3, 0);
  }
  else
  {
    File = 0;
    Filename = 0;
    result = sub_5437D0('bina', a2, &Filename, &File);
    if ( result )
    {
      fclose(File);
      sub_5392D0(v3, &Filename, 1);
      result = (void *)_unlink(&Filename);
    }
  }
  return result;
}

//----- (005392D0) --------------------------------------------------------
int __thiscall sub_5392D0(int this, const char *name, char a3)
{
  char v4; // al@1
  int v5; // ecx@1
  int v6; // edi@1
  const char *v7; // ebp@2
  const char *v8; // edi@11
  FILE *v9; // ebp@13
  int result; // eax@22
  char v11; // [sp+13h] [bp-20Dh]@1
  int v12; // [sp+14h] [bp-20Ch]@14
  char Filename; // [sp+18h] [bp-208h]@11
  char v14; // [sp+11Ch] [bp-104h]@13

  v4 = 0;
  v5 = *(_DWORD *)(this + 285852) + 1;
  v6 = 0;
  v11 = 0;
  *(_DWORD *)(this + 285852) = v5;
  if ( v5 > 0 )
  {
    v7 = (const char *)(this + 259852);
    while ( !v4 )
    {
      if ( strcmp(v7, name) )
      {
        v4 = v11;
      }
      else
      {
        v4 = 1;
        v11 = 1;
      }
      ++v6;
      v7 += 260;
      if ( v6 >= *(_DWORD *)(this + 285852) )
      {
        if ( !v4 )
          goto LABEL_10;
        goto LABEL_21;
      }
    }
    goto LABEL_21;
  }
LABEL_10:
  if ( a3 )
  {
    v8 = name;
    sprintf(&Filename, "%s", name);
  }
  else
  {
    sprintf(&Filename, "%s%s", g_game->init_data + 6267 /* ->rms_dir */, name);
    v8 = name;
  }
  sprintf(&v14, "%s", v8);
  v9 = fopen(&Filename, "r");
  strcpy((char *)(this + 260 * *(_DWORD *)(this + 285852) + 259852), v8);
  if ( !v9 )
  {
LABEL_21:
    Pinfo_DEPRECATED(dword_6B566C);
    goto LABEL_22;
  }
  Pinfo_DEPRECATED(dword_6B566C);
  Pinfo_DEPRECATED(dword_6B566C);
  Pinfo_DEPRECATED(dword_6B566C);
  v12 = 0;
  while ( sub_539560(this, v9, (int)&v12) )
  {
    if ( v12 )
      sub_539D80((void *)this, v9, v12);
  }
  fclose(v9);
  if ( *(_DWORD *)(this + 259440) > 0 )
  {
    Pinfo_DEPRECATED(dword_6B566C);
    *(_DWORD *)(this + 259440) = 0;
  }
  Pinfo_DEPRECATED(dword_6B566C);
  Pinfo_DEPRECATED(dword_6B566C);
  Pinfo_DEPRECATED(dword_6B566C);
LABEL_22:
  result = *(_DWORD *)(this + 285852) - 1;
  *(_DWORD *)(this + 285852) = result;
  return result;
}

//----- (00539540) --------------------------------------------------------
bool __stdcall sub_539540(FILE *File, int a2
{
  return fscanf(File, "%s", a2 != -1;
}

//----- (00539560) --------------------------------------------------------
bool __thiscall sub_539560(int this, FILE *File, int a3)
{
  int v3; // esi@1
  bool result; // al@2
  _BYTE v5[100]; // [sp+8h] [bp-64h]@1
  __int16 v6; // [sp+69h] [bp-3h]@1
  char v7; // [sp+6Bh] [bp-1h]@1

  v3 = this;
  v5[0] = NULL;
  memset(&v5[1], 0, 0x60u);
  v6 = 0;
  v7 = 0;
  if ( !*(_DWORD *)(this + 259432) )
  {
    result = sub_539540(File, (int)v5);
    if ( !result )
      return result;
    *(_DWORD *)(v3 + 259432) = sub_539CF0(v3, (int)v5);
  }
  *(_DWORD *)a3 = *(_DWORD *)(v3 + 259432);
  if ( !*(_DWORD *)(v3 + 259432) )
  {
    if ( !*(_DWORD *)(v3 + 259440) )
      Pinfo_DEPRECATED(dword_6B566C);
  }
  *(_DWORD *)(v3 + 259432) = 0;
  return 1;
}

//----- (00539610) --------------------------------------------------------
bool __thiscall sub_539610(void *this, FILE *File, int a3)
{
  int v3; // esi@1
  bool result; // al@1
  int v5; // eax@2
  char Str; // [sp+8h] [bp-64h]@1
  char v7; // [sp+9h] [bp-63h]@1
  __int16 v8; // [sp+69h] [bp-3h]@1
  char v9; // [sp+6Bh] [bp-1h]@1

  v3 = (int)this;
  Str = NULL;
  memset(&v7, 0, 0x60u);
  v8 = 0;
  v9 = 0;
  result = sub_539540(File, (int)&Str);
  if ( result )
  {
    v5 = sub_539CF0(v3, (int)&Str);
    if ( !v5 || *(_BYTE *)(v5 + 100) )
    {
      *(_DWORD *)a3 = atoi(&Str);
      result = 1;
    }
    else
    {
      *(_DWORD *)(v3 + 259432) = v5;
      result = 0;
    }
  }
  return result;
}

//----- (005396A0) --------------------------------------------------------
char __thiscall sub_5396A0(void *this, FILE *File, char *a3)
{
  int v3; // esi@1
  int v4; // eax@4
  int v5; // eax@6
  int v6; // edx@6
  unsigned int v7; // kr0C_4@6
  char v8; // bl@6
  int v9; // edi@16
  signed int v10; // ecx@16
  bool v11; // zf@18
  signed int v12; // ecx@19
  const void *v13; // esi@19
  unsigned int v14; // edx@19
  char *v15; // edi@19
  signed int v16; // ecx@19
  int *v17; // edi@22
  signed int v18; // ecx@22
  signed int v19; // ecx@25
  const void *v20; // esi@25
  unsigned int v21; // edx@25
  char *v22; // edi@25
  signed int v23; // ecx@25
  int v24; // edi@32
  signed int v25; // ecx@32
  signed int v26; // ecx@35
  const void *v27; // esi@35
  unsigned int v28; // edx@35
  char *v29; // edi@35
  signed int v30; // ecx@35
  int *v31; // edi@38
  signed int v32; // ecx@38
  signed int v33; // ecx@41
  const void *v34; // esi@41
  unsigned int v35; // edx@41
  char *v36; // edi@41
  signed int v37; // ecx@41
  char v39; // [sp+13h] [bp-6Dh]@1
  int v40; // [sp+14h] [bp-6Ch]@1
  int v41; // [sp+18h] [bp-68h]@1
  const char v42[100]; // [sp+1Ch] [bp-64h]@1
  __int16 v43; // [sp+7Dh] [bp-3h]@1
  char v44; // [sp+7Fh] [bp-1h]@1

  v3 = (int)this;
  v42[0] = NULL;
  memset((void *)&v42[1], 0, 0x60u);
  v41 = (int)this;
  v43 = 0;
  v44 = 0;
  v40 = 0;
  v39 = 1;
  while ( 2 )
  {
    if ( !sub_539540(File, (int)v42) )
      return 0;
    if ( !v40 )
    {
      v4 = sub_539CF0(v3, (int)v42);
      if ( v4 )
      {
        if ( !*(_BYTE *)(v4 + 100) )
        {
          *(_DWORD *)(v3 + 259432) = v4;
          return 0;
        }
      }
    }
    v5 = 0;
    v6 = 0;
    v7 = strlen(v42) + 1;
    v8 = 0;
    if ( (signed int)(v7 - 1) <= 0 )
      goto LABEL_53;
    while ( *((_BYTE *)&v41 + v5 + 4) != 34 )
    {
LABEL_10:
      ++v5;
      if ( v5 >= (signed int)(v7 - 1) )
        goto LABEL_13;
    }
    if ( !v6 )
    {
      v6 = v5 + 1;
      goto LABEL_10;
    }
    v42[v5] = 0;
    v8 = 1;
LABEL_13:
    if ( !v6 )
    {
LABEL_53:
      if ( v40 )
      {
        v24 = (int)" ";
        v25 = -1;
        do
        {
          if ( !v25 )
            break;
          v11 = *(_BYTE *)v24++ == 0;
          --v25;
        }
        while ( !v11 );
        v26 = ~v25;
        v27 = (const void *)(v24 - v26);
        v28 = v26;
        v29 = a3;
        v30 = -1;
        do
        {
          if ( !v30 )
            break;
          v11 = *v29++ == 0;
          --v30;
        }
        while ( !v11 );
        memcpy(v29 - 1, v27, v28);
        v31 = (int *)v42;
        v32 = -1;
        do
        {
          if ( !v32 )
            break;
          v11 = *(_BYTE *)v31 == 0;
          v31 = (int *)((char *)v31 + 1);
          --v32;
        }
        while ( !v11 );
        v33 = ~v32;
        v34 = (char *)v31 - v33;
        v35 = v33;
        v36 = a3;
        v37 = -1;
        do
        {
          if ( !v37 )
            break;
          v11 = *v36++ == 0;
          --v37;
        }
        while ( !v11 );
        memcpy(v36 - 1, v34, v35);
        goto LABEL_45;
      }
      strcpy(a3, v42);
      return 1;
    }
    if ( v40 )
    {
      v9 = (int)" ";
      v10 = -1;
      *((_BYTE *)&v41 + v6 + 3) = 0;
      do
      {
        if ( !v10 )
          break;
        v11 = *(_BYTE *)v9++ == 0;
        --v10;
      }
      while ( !v11 );
      v12 = ~v10;
      v39 = 0;
      v13 = (const void *)(v9 - v12);
      v14 = v12;
      v15 = a3;
      v16 = -1;
      do
      {
        if ( !v16 )
          break;
        v11 = *v15++ == 0;
        --v16;
      }
      while ( !v11 );
      memcpy(v15 - 1, v13, v14);
      v17 = (int *)v42;
      v18 = -1;
      do
      {
        if ( !v18 )
          break;
        v11 = *(_BYTE *)v17 == 0;
        v17 = (int *)((char *)v17 + 1);
        --v18;
      }
      while ( !v11 );
      v19 = ~v18;
      v20 = (char *)v17 - v19;
      v21 = v19;
      v22 = a3;
      v23 = -1;
      do
      {
        if ( !v23 )
          break;
        v11 = *v22++ == 0;
        --v23;
      }
      while ( !v11 );
      memcpy(v22 - 1, v20, v21);
    }
    else
    {
      strcpy(a3, &v42[v6]);
    }
    ++v40;
    if ( !v8 )
    {
LABEL_45:
      if ( v39 )
      {
        v3 = v41;
        continue;
      }
    }
    return 1;
  }
}

//----- (005398A0) --------------------------------------------------------
bool __thiscall sub_5398A0(void *this, FILE *File, char *a3)
{
  int v3; // esi@1
  bool result; // al@1
  int v5; // eax@2
  const char v6[100]; // [sp+8h] [bp-64h]@1
  __int16 v7; // [sp+69h] [bp-3h]@1
  char v8; // [sp+6Bh] [bp-1h]@1

  v3 = (int)this;
  v6[0] = NULL;
  memset((void *)&v6[1], 0, 0x60u);
  v7 = 0;
  v8 = 0;
  result = sub_539540(File, (int)v6);
  if ( result )
  {
    v5 = sub_539CF0(v3, (int)v6);
    if ( !v5 || *(_BYTE *)(v5 + 100) )
    {
      strcpy(a3, v6);
      result = 1;
    }
    else
    {
      *(_DWORD *)(v3 + 259432) = v5;
      result = 0;
    }
  }
  return result;
}

//----- (00539940) --------------------------------------------------------
bool __thiscall sub_539940(void *this, FILE *File, int a3)
{
  int v3; // esi@1
  bool result; // al@1
  int v5; // eax@2
  _BYTE v6[100]; // [sp+8h] [bp-64h]@1
  __int16 v7; // [sp+69h] [bp-3h]@1
  char v8; // [sp+6Bh] [bp-1h]@1

  v3 = (int)this;
  v6[0] = NULL;
  memset(&v6[1], 0, 0x60u);
  v7 = 0;
  v8 = 0;
  result = sub_539540(File, (int)v6);
  if ( result )
  {
    v5 = sub_539CF0(v3, (int)v6);
    *(_DWORD *)a3 = v5;
    if ( !v5 || *(_BYTE *)(v5 + 100) )
    {
      result = 1;
    }
    else
    {
      *(_DWORD *)(v3 + 259432) = v5;
      result = 0;
    }
  }
  return result;
}

//----- (005399C0) --------------------------------------------------------
void __thiscall sub_5399C0(void *this, int a2, char a3, int a4, char a5, char a6, char a7, char a8)
{
  void *v8; // ebp@1
  void *v9; // ebx@2
  int v10; // esi@2
  signed int v11; // eax@4
  int v12; // eax@6

  v8 = this;
  if ( a2 )
  {
    v9 = calloc(1u, 0x78u);
    strcpy((char *)v9, (const char *)a2);
    *((_DWORD *)v9 + 26) = a4;
    *((_BYTE *)v9 + 100) = a3;
    *((_BYTE *)v9 + 108) = a5;
    *((_BYTE *)v9 + 109) = a6;
    *((_BYTE *)v9 + 110) = a7;
    *((_BYTE *)v9 + 111) = a8;
    v10 = *((_DWORD *)v8 + 64857);
    if ( !v10 )
    {
      *((_DWORD *)v8 + 64857) = v9;
      return;
    }
    do
    {
      v11 = sub_539C70(v10, a2);
      if ( !v11 )
      {
        Pinfo_DEPRECATED(dword_6B566C);
        return;
      }
      if ( v11 <= 0 )
      {
        v12 = *(_DWORD *)(v10 + 116);
        if ( !v12 )
        {
          *(_DWORD *)(v10 + 116) = v9;
          return;
        }
      }
      else
      {
        v12 = *(_DWORD *)(v10 + 112);
        if ( !v12 )
        {
          *(_DWORD *)(v10 + 112) = v9;
          return;
        }
      }
      v10 = v12;
    }
    while ( v12 );
  }
}

//----- (00539AA0) --------------------------------------------------------
void __thiscall sub_539AA0(void *this, int string_id, int a3, char a4, char a5, char a6, char a7)
{
  int string = (*(int (__stdcall **)(int))(*(_DWORD *)g_game + 36))(string_id);
  sub_539AE0(this, string, 0, a3, a4, a5, a6, a7);
}

//----- (00539AE0) --------------------------------------------------------
void __thiscall sub_539AE0(void *this, int string, char a3, int a4, char a5, char a6, char a7, char a8)
{
  void *v8; // ebp@1
  void *v9; // ebx@2
  int v10; // esi@2
  int v11; // eax@4
  int v12; // eax@6

  v8 = this;
  if ( string )
  {
    v9 = calloc(1u, 0x78u);
    strcpy((char *)v9, (const char *)string);
    *((_DWORD *)v9 + 26) = a4;
    *((_BYTE *)v9 + 100) = a3;
    *((_BYTE *)v9 + 108) = a5;
    v10 = (int)((char *)v8 + 259428);
    *((_BYTE *)v9 + 109) = a6;
    *((_BYTE *)v9 + 110) = a7;
    *((_BYTE *)v9 + 111) = a8;
    if ( *((_DWORD *)v8 + 64857) )
    {
      v11 = *(_DWORD *)v10;
      if ( *(_DWORD *)v10 )
      {
        while ( 1 )
        {
          if ( sub_539C70(v11, a2) > 0 )
          {
            *((_DWORD *)v9 + 29) = *(_DWORD *)v10;
            *(_DWORD *)v10 = v9;
            return;
          }
          v12 = *(_DWORD *)v10 + 116;
          if ( !*(_DWORD *)v12 )
            break;
          v10 = *(_DWORD *)v10 + 116;
          v11 = *(_DWORD *)v12;
          if ( !v11 )
            return;
        }
        *(_DWORD *)(*(_DWORD *)v10 + 116) = v9;
      }
    }
    else
    {
      *(_DWORD *)v10 = v9;
    }
  }
}

//----- (00539BB0) --------------------------------------------------------
int __stdcall sub_539BB0(int a1, signed int a2, char a3)
{
  int result; // eax@2
  char v4; // dl@3
  int v5; // ebp@3
  int v6; // esi@4
  int v7; // eax@6
  int v8; // eax@12
  int v9; // ST00_4@12
  int v10; // [sp+14h] [bp+Ch]@4

  if ( a2 > 2 )
  {
    v4 = a3;
    v5 = a2 / 2;
    if ( a2 / 2 <= 0 )
    {
      v6 = a1;
    }
    else
    {
      v6 = a1;
      v10 = a2 / 2;
      do
      {
        if ( v4 )
        {
          v7 = *(_DWORD *)(v6 + 116);
          *(_DWORD *)(v7 + 112) = v6;
          *(_DWORD *)(v6 + 116) = 0;
        }
        else
        {
          v7 = *(_DWORD *)(v6 + 112);
          *(_DWORD *)(v7 + 116) = v6;
          *(_DWORD *)(v6 + 112) = 0;
        }
        v6 = v7;
        --v10;
      }
      while ( v10 );
    }
    if ( v4 )
    {
      v8 = sub_539BB0(*(_DWORD *)(v6 + 116), a2 - v5 - 1, 1);
      v9 = *(_DWORD *)(v6 + 112);
      *(_DWORD *)(v6 + 116) = v8;
      *(_DWORD *)(v6 + 112) = sub_539BB0(v9, v5, 0);
      result = v6;
    }
    else
    {
      *(_DWORD *)(v6 + 116) = sub_539BB0(*(_DWORD *)(v6 + 116), v5, 1);
      *(_DWORD *)(v6 + 112) = sub_539BB0(*(_DWORD *)(v6 + 112), a2 - v5 - 1, 0);
      result = v6;
    }
  }
  else
  {
    result = a1;
  }
  return result;
}

//----- (00539C70) --------------------------------------------------------
signed int __stdcall sub_539C70(int a1, int a2)
{
  int v2; // edx@1
  int v3; // eax@4
  char v4; // cl@5
  char v5; // cl@7
  char v6; // al@8
  signed int result; // eax@10

  v2 = 0;
  if ( !a1 || !a2 )
    goto LABEL_15;
  if ( *(_BYTE *)a1 )
  {
    v3 = a1;
    do
    {
      v4 = *(_BYTE *)(a2 - a1 + v3);
      if ( !v4 )
        break;
      if ( *(_BYTE *)v3 != v4 )
        return (((*(_BYTE *)(v2 + a1) <= *(_BYTE *)(v2 + a2)) - 1) & 2) - 1;
      v5 = *(_BYTE *)(v3 + 1);
      ++v2;
      ++v3;
    }
    while ( v5 );
  }
  v6 = *(_BYTE *)(v2 + a1);
  if ( v6 )
    goto LABEL_16;
  if ( *(_BYTE *)(v2 + a2) )
LABEL_16:
    result = v6 != 0 ? 1 : -1;
  else
LABEL_15:
    result = 0;
  return result;
}

//----- (00539CF0) --------------------------------------------------------
int __thiscall sub_539CF0(int this, int a2)
{
  int v2; // esi@1
  signed int v3; // eax@2
  int result; // eax@7

  v2 = *(_DWORD *)(this + 259428);
  if ( v2 )
  {
    while ( 1 )
    {
      v3 = sub_539C70(v2, a2);
      if ( !v3 )
        break;
      if ( v3 <= 0 )
        v2 = *(_DWORD *)(v2 + 116);
      else
        v2 = *(_DWORD *)(v2 + 112);
      if ( !v2 )
        goto LABEL_7;
    }
    result = v2;
  }
  else
  {
LABEL_7:
    result = 0;
  }
  return result;
}

//----- (00539D30) --------------------------------------------------------
void __stdcall sub_539D30(void **a1)
{
  if ( *((_DWORD *)*a1 + 28) )
    sub_539D30((char *)*a1 + 112);
  if ( *((_DWORD *)*a1 + 29) )
    sub_539D30((char *)*a1 + 116);
  free(*a1);
  *a1 = 0;
}

//----- (00539D80) --------------------------------------------------------
char __thiscall sub_539D80(void *this, FILE *File, int a3)
{
  int v3; // esi@1
  int v4; // edi@1
  char *v5; // ebx@1
  int v6; // ebp@1
  char v7; // al@8
  char result; // al@27
  int v9; // eax@28
  int v10; // eax@41
  int v11; // ecx@42
  int v12; // edx@42
  int v13; // eax@47
  int v14; // edx@47
  int v15; // eax@66
  int v16; // eax@71
  char *v17; // [sp-10h] [bp-518h]@11
  const char *v18; // [sp-Ch] [bp-514h]@11
  char *v19; // [sp-8h] [bp-510h]@11
  int v20; // [sp-8h] [bp-510h]@76
  char *v21; // [sp-4h] [bp-50Ch]@11
  char v22; // [sp+13h] [bp-4F5h]@1
  int v23; // [sp+14h] [bp-4F4h]@1
  char Dest; // [sp+1Ch] [bp-4ECh]@1
  char v25; // [sp+1Dh] [bp-4EBh]@1
  __int16 v26; // [sp+20Dh] [bp-2FBh]@1
  char v27; // [sp+20Fh] [bp-2F9h]@1
  char v28; // [sp+210h] [bp-2F8h]@1
  char v29; // [sp+211h] [bp-2F7h]@1
  __int16 v30; // [sp+401h] [bp-107h]@1
  char v31; // [sp+403h] [bp-105h]@1
  char v32; // [sp+404h] [bp-104h]@80

  v3 = (int)this;
  Dest = NULL;
  memset(&v25, 0, 0x1F0u);
  v26 = 0;
  v27 = 0;
  v28 = NULL;
  memset(&v29, 0, 0x1F0u);
  v30 = 0;
  v31 = 0;
  v22 = 1;
  v23 = a3 + 108;
  v4 = a3 + 108;
  v5 = (char *)this + 287996;
  v6 = (int)((char *)this + 288396);
  while ( *(_BYTE *)v4 )
  {
    if ( !v22 )
      return 0;
    if ( *(_BYTE *)v4 == 5 )
    {
      if ( sub_5396A0((void *)this, File, v5) )
        sprintf(&Dest, "%s %s", &Dest, v5);
      else
        v22 = 0;
    }
    v7 = *(_BYTE *)v4;
    if ( *(_BYTE *)v4 == 1 )
    {
      if ( sub_5398A0((void *)this, File, v5) )
      {
        v21 = v5;
        v19 = &Dest;
        v18 = "%s %s";
        v17 = &Dest;
LABEL_24:
        sprintf(v17, v18, v19, v21);
        goto LABEL_25;
      }
LABEL_10:
      v22 = 0;
      goto LABEL_25;
    }
    if ( v7 == 2 )
    {
      if ( sub_539610((void *)this, File, v6 - 416) )
      {
        sprintf(&Dest, "%s %d", &Dest, *(_DWORD *)(v6 - 416));
        v4 = v23;
      }
      else
      {
        v4 = v23;
        v22 = 0;
      }
      goto LABEL_25;
    }
    if ( v7 == 3 )
    {
      if ( sub_539940((void *)this, File, v6) && *(_DWORD *)v6 )
      {
        v21 = *(char **)v6;
        v19 = &Dest;
        v18 = "%s %s";
        v17 = &Dest;
        goto LABEL_24;
      }
      goto LABEL_10;
    }
    if ( v7 == 4 )
    {
      if ( sub_539940((void *)this, File, v6) )
      {
        v21 = *(char **)v6;
        v19 = &Dest;
        v18 = "%s %s";
        v17 = &Dest;
        goto LABEL_24;
      }
      v22 = 0;
    }
LABEL_25:
    v6 += 4;
    v5 += 100;
    ++v4;
    v23 = v4;
    if ( v4 + -108 - a3 >= 4 )
      break;
  }
  if ( !v22 )
    return 0;
  v9 = *(_DWORD *)(this + 259440);
  if ( !v9 )
  {
    if ( *(_DWORD *)(this + 4 * *(_DWORD *)(this + 259848) + 259448) == 2 )
    {
      switch ( *(_DWORD *)(a3 + 104) )
      {
        case 7:
          ++*(_BYTE *)(this + 285856 /* ->current_random */);
          *(_DWORD *)(this + 4 * *(_BYTE *)(this + 285856 /* ->current_random */) + 285860) = 100 * rand() / 32767;
          *(_DWORD *)(this + 4 * *(_BYTE *)(this + 285856 /* ->current_random */) + 286260) = 1;
          break;
        case 8:
          if ( *(_BYTE *)(this + 285856 /* ->current_random */) )
          {
            int current_random = *(_BYTE *)(this + 285856 /* ->current_random */);
            if ( *(_DWORD *)(this + 4 * current_random + 286260) == 1 )
            {
              v11 = *(_DWORD *)(this + 4 * current_random + 285860);
              v12 = *(_DWORD *)(this + 287980);
              if ( v11 > v12 )
              {
                *(_DWORD *)(this + 4 * current_random + 285860) = v11 - v12;
              }
              else
              {
                Pinfo_DEPRECATED(dword_6B566C);
                *(_DWORD *)(this + 4 * *(_BYTE *)(this + 285856 /* ->current_random */) + 286260) = 2;
              }
            }
            else
            {
              *(_DWORD *)(this + 4 * current_random + 286260) = 3;
            }
          }
          else
          {
            Pinfo_DEPRECATED(dword_6B566C);
          }
          break;
        case 9:
          if ( *(_BYTE *)(this + 285856 /* ->current_random */) )
          {
            Pinfo_DEPRECATED(dword_6B566C);
            --*(_BYTE *)(this + 285856 /* ->current_random */);
          }
          else
          {
            Pinfo_DEPRECATED(dword_6B566C);
          }
          break;
      }
    }
    v13 = *(_DWORD *)(this + 259848);
    v14 = *(_DWORD *)(this + 4 * v13 + 259448);
    if ( !*(_BYTE *)(this + 285856 /* ->current_random */) || *(_DWORD *)(this + 4 * *(_BYTE *)(this + 285856 /* ->current_random */) + 286260) == 2 )
    {
      switch ( *(_DWORD *)(a3 + 104) )
      {
        case 3:
          ++v13;
          *(_DWORD *)(this + 259848) = v13;
          if ( v14 != 2 )
            goto LABEL_51;
          if ( *(_DWORD *)(this + 288396) )
            *(_DWORD *)(this + 4 * v13 + 259448) = 2;
          else
            *(_DWORD *)(this + 4 * v13 + 259448) = 1;
          break;
        case 4:
          if ( v13 > 0 )
          {
            if ( v14 != 1 )
              goto LABEL_51;
            if ( *(_DWORD *)(this + 288396) )
            {
              Pinfo_DEPRECATED(dword_6B566C);
              *(_DWORD *)(this + 4 * *(_DWORD *)(this + 259848) + 259448) = 2;
            }
          }
          else
          {
            Pinfo_DEPRECATED(dword_6B566C);
          }
          break;
        case 5:
          if ( v13 > 0 )
          {
            if ( v14 == 1 )
            {
              Pinfo_DEPRECATED(dword_6B566C);
              *(_DWORD *)(this + 4 * *(_DWORD *)(this + 259848) + 259448) = 2;
            }
            else
            {
LABEL_51:
              *(_DWORD *)(this + 4 * v13 + 259448) = 3;
            }
          }
          else
          {
            Pinfo_DEPRECATED(dword_6B566C);
          }
          break;
        case 6:
          if ( v13 > 0 )
          {
            v15 = v13 - 1;
            *(_DWORD *)(this + 259848) = v15;
            if ( *(_DWORD *)(this + 4 * v15 + 259448) == 2 )
              Pinfo_DEPRECATED(dword_6B566C);
          }
          else
          {
            Pinfo_DEPRECATED(dword_6B566C);
          }
          break;
        default:
          break;
      }
    }
    if ( *(_DWORD *)(this + 4 * *(_DWORD *)(this + 259848) + 259448) == 2
      && (!*(_BYTE *)(this + 285856 /* ->current_random */) || *(_DWORD *)(this + 4 * *(_BYTE *)(this + 285856 /* ->current_random */) + 286260) == 2) )
    {
      v16 = a3;
      switch ( *(_DWORD *)(a3 + 104) )
      {
        case 0:
          sub_5399C0((void *)this, this + 287996, 1, 0, 0, 0, 0, 0);
          return 1;
        case 2:
          sub_5399C0((void *)this, this + 287996, 2, *(_DWORD *)(this + 287984), 0, 0, 0, 0);
          return 1;
        case 69:
          v9 = *(_DWORD *)(this + 259440);
          goto LABEL_75;
        case 70:
          v20 = dword_6B566C;
          goto LABEL_98;
        case 10:
          if ( RGE_Game__get_map_type_id(g_game) == 44 ) // is custom map
            goto LABEL_99;
          sub_5392D0(this, (const char *)(this + 287996), 0);
          return 1;
        case 92:
          if ( RGE_Game__get_map_type_id(g_game) == 44 ) // is custom map
            goto LABEL_99;
          sprintf(&v32, "%s%s", g_game->init_data + 6267 /* ->rms_dir */, this + 287996);
          sub_539230((void *)this, *(_DWORD *)(this + 287984), (const char *)(this + 287996));
          return 1;
        case 0x0B:
        case 0x11:
        case 0x22:
        case 0x2A:
        case 0x2F:
        case 0x3E:
        case 0x4F:
          sub_53A650(this, *(_DWORD *)(a3 + 104));
          return 1;
        case 67:
          if ( !*(_DWORD *)(this + 259444) )
          {
            *(_DWORD *)(this + 259444) = 1;
            return 1;
          }
LABEL_97:
          v20 = dword_6B566C;
          goto LABEL_98;
        case 68:
          if ( *(_DWORD *)(this + 259444) )
          {
            *(_DWORD *)(this + 259444) = 0;
            return 1;
          }
          v20 = dword_6B566C;
LABEL_98:
          Pinfo_DEPRECATED(v20);
          break;
        case 12:
        case 13:
        case 14:
        case 15:
        case 16:
        case 18:
        case 19:
        case 20:
        case 21:
        case 22:
        case 23:
        case 24:
        case 25:
        case 26:
        case 27:
        case 28:
        case 29:
        case 30:
        case 31:
        case 32:
        case 33:
        case 35:
        case 36:
        case 37:
        case 38:
        case 39:
        case 40:
        case 41:
        case 43:
        case 44:
        case 45:
        case 46:
        case 48:
        case 49:
        case 50:
        case 51:
        case 52:
        case 53:
        case 54:
        case 55:
        case 56:
        case 57:
        case 58:
        case 59:
        case 60:
        case 61:
        case 63:
        case 64:
        case 65:
        case 66:
        case 71:
        case 72:
        case 73:
        case 74:
        case 75:
        case 76:
        case 77:
        case 78:
        case 80:
        case 81:
        case 82:
        case 83:
        case 84:
        case 85:
        case 86:
        case 87:
        case 88:
        case 89:
        case 90:
        case 91:
          v16 = a3;
          goto LABEL_89;
        case 1:
        case 3:
        case 4:
        case 5:
        case 6:
        case 7:
        case 8:
        case 9:
          goto LABEL_99;
        default:
LABEL_89:
          switch ( *(_DWORD *)(this + 259436 /* ->current_type */) )
          {
            case 0xB:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 16))(this, v16);
              result = 1;
              break;
            case 0x11:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 20))(this, v16);
              result = 1;
              break;
            case 0x22:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 28))(this, v16);
              result = 1;
              break;
            case 0x2A:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 24))(this, v16);
              result = 1;
              break;
            case 0x2F:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 32))(this, v16);
              result = 1;
              break;
            case 0x3E:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 36))(this, v16);
              result = 1;
              break;
            case 0x4F:
              (*(void (__thiscall **)(int, int))(*(_DWORD *)this + 40))(this, v16);
              result = 1;
              break;
            default:
              goto LABEL_97;
          }
          return result;
      }
    }
    goto LABEL_99;
  }
  if ( *(_DWORD *)(a3 + 104) == 69 )
  {
LABEL_75:
    *(_DWORD *)(this + 259440) = v9 + 1;
    result = 1;
  }
  else
  {
    if ( *(_DWORD *)(a3 + 104) == 70 )
    {
      *(_DWORD *)(this + 259440) = v9 - 1;
      return 1;
    }
LABEL_99:
    result = 1;
  }
  return result;
}
// 445610: using guessed type int __thiscall RGE_Game__get_map_type_id(_DWORD);

//----- (0053A650) --------------------------------------------------------
int __thiscall sub_53A650(int this, int current_type)
{
  *(_DWORD *)(this + 259436 /* ->current_type */) = current_type;
  int result = current_type - 17;
  switch ( current_type )
  {
    case 0x11:
      result = -1;
      *(_BYTE *)(this + 259425 /* ->current_gen_stat_land */) = 1;
      *(_DWORD *)(this + 286660) = -1;
      *(_DWORD *)(this + 286664) = -1;
      break;
    case 0x22:
      *(_BYTE *)(this + 259424 /* ->current_gen_stat_cliffs */) = 1;
      break;
    case 0x2A:
      *(_DWORD *)(this + 287068) = -1;
      *(_BYTE *)(this + 259422 /* ->current_gen_stat_terrain */) = 1;
      break;
    case 0x2F:
      *(_BYTE *)(this + 259423 /* ->current_gen_stat_objects */) = 1;
      break;
    case 0x3E:
      *(_DWORD *)(this + 287580) = -1;
      *(_BYTE *)(this + 259421 /* ->current_gen_stat_connections */) = 1;
      break;
    case 0x4F:
      result = -1;
      *(_BYTE *)(this + 259420 /* ->current_gen_stat_elevation */) = 1;
      *(_DWORD *)(this + 287172) = -1;
      *(_DWORD *)(this + 287176) = -1;
      break;
    default:
      return result;
  }
  return result;
}

//----- (0053A740) --------------------------------------------------------
char __stdcall _rms__type_0xB_53A740(int a1)
{
  signed int v1; // eax@1

  v1 = *(_DWORD *)(a1 + 104);
  if ( v1 < 12 || v1 > 16 )
    Pinfo_DEPRECATED(dword_6B566C);
  return 1;
}

//----- (0053A770) --------------------------------------------------------
char __thiscall _rms__type_0x11_53A770(int this, int a2)
{
  int v2; // esi@1
  int v3; // eax@5
  int v4; // edx@5
  char result; // al@5
  int v6; // edi@6
  int v7; // ecx@6
  int v8; // eax@6
  int v9; // ecx@8
  int v10; // eax@8
  int v11; // ecx@10
  int v12; // eax@11
  int v13; // edi@17
  int v14; // eax@21
  int v15; // eax@25
  int v16; // edi@29
  int v17; // ebx@33
  int v18; // edi@37
  int v19; // ebx@41
  int v20; // eax@45
  int v21; // eax@49
  int v22; // ebp@52
  signed int v23; // ebx@54
  int v24; // edi@54
  int v25; // edi@59
  int v26; // ebx@60
  int v27; // eax@64
  int v28; // eax@68
  int v29; // eax@72
  int v30; // eax@76
  int v31; // eax@80
  signed int v32; // eax@84
  int v33; // eax@89
  int v34; // eax@91
  int v35; // [sp+14h] [bp+4h]@53

  this = this;
  if ( !*(_DWORD *)(this + 259444) )
  {
    if ( *(_DWORD *)(a2 + 104) == 19 )
    {
      result = 1;
      *(_BYTE *)(this + 259396) = *(_BYTE *)(*(_DWORD *)(this + 288396) + 104);
      return result;
    }
    if ( *(_DWORD *)(a2 + 104) == 20 )
    {
      v6 = *(_DWORD *)(this + 259392);
      v7 = *(_DWORD *)(this + 320);
      *(_DWORD *)(this + 286660) = v6;
      v8 = *(_WORD *)(v7 + 72) + v6 - 2;
      for ( *(_DWORD *)(this + 286664) = v8; v6 <= *(_DWORD *)(this + 286664); ++v6 )
        (*(void (__thiscall **)(int, int, int))(*(_DWORD *)this + 48))(this, v6, v6 - *(_DWORD *)(this + 286660) + 1);
      v9 = *(_DWORD *)(this + 259392);
      v10 = *(_WORD *)(*(_DWORD *)(this + 320) + 72) - 1;
      *(_BYTE *)(this + 286668) = 1;
      *(_BYTE *)(this + 286669) = 0;
      *(_DWORD *)(this + 259392) = v10 + v9;
      return 1;
    }
    if ( *(_DWORD *)(a2 + 104) == 32 )
    {
      v3 = *(_DWORD *)(this + 259392);
      v4 = *(_DWORD *)this;
      *(_DWORD *)(this + 286660) = v3;
      *(_DWORD *)(this + 286664) = v3;
      *(_DWORD *)(this + 259392) = v3 + 1;
      (*(void (__stdcall **)(_DWORD, _DWORD))(v4 + 48))(*(_DWORD *)(this + 286660), 0);
      *(_BYTE *)(this + 286668) = 0;
      *(_BYTE *)(this + 286669) = 1;
      return 1;
    }
    goto LABEL_95;
  }
  v11 = *(_DWORD *)(this + 286660);
  if ( v11 < 0 || (v12 = *(_DWORD *)(this + 286664), v12 < 0) )
  {
LABEL_95:
    Pinfo_DEPRECATED(dword_6B566C);
    return 1;
  }
  switch ( *(_DWORD *)(a2 + 104) )
  {
    case 0x47:
      if ( !*(_BYTE *)(this + 286669) )
        goto LABEL_95;
      *(_DWORD *)(this + 52 * v11 + 254252) = *(_DWORD *)(this + 20) * *(_DWORD *)(this + 287980) / 100;
      *(_DWORD *)(this + 52 * *(_DWORD *)(this + 286660) + 254256) = *(_DWORD *)(this + 24) * *(_DWORD *)(this + 287984) / 100;
      result = 1;
      break;
    case 0x12:
      if ( v11 > v12 )
        return 1;
      v13 = this + 52 * v11 + 254244;
      do
      {
        v13 += 52;
        ++v11;
        *(_DWORD *)(v13 - 52) = *(_DWORD *)(this + 287980)
                              * *(_DWORD *)(this + 20)
                              * *(_DWORD *)(this + 24)
                              / (100
                               * (v12 - *(_DWORD *)(this + 286660) + 1));
        v12 = *(_DWORD *)(this + 286664);
      }
      while ( v11 <= v12 );
      result = 1;
      break;
    case 0x4A:
      if ( v11 > v12 )
        return 1;
      v14 = this + 52 * v11 + 254244;
      do
      {
        ++v11;
        *(_DWORD *)v14 = *(_DWORD *)(this + 287980);
        v14 += 52;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x15:
      if ( v11 > v12 )
        return 1;
      v15 = this + 52 * v11 + 254248;
      do
      {
        ++v11;
        v15 += 52;
        *(_DWORD *)(v15 - 52) = *(_DWORD *)(*(_DWORD *)(this + 288396) + 104);
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x17:
      if ( v11 > v12 )
        return 1;
      v16 = this + 52 * v11 + 254276;
      do
      {
        v16 += 52;
        ++v11;
        *(_DWORD *)(v16 - 52) = *(_DWORD *)(this + 287980) * *(_DWORD *)(this + 20) / 100;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x18:
      if ( v11 > v12 )
        return 1;
      v17 = this + 52 * v11 + 254284;
      do
      {
        v17 += 52;
        ++v11;
        *(_DWORD *)(v17 - 52) = *(_DWORD *)(this + 20) - *(_DWORD *)(this + 287980) * *(_DWORD *)(this + 20) / 100;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x19:
      if ( v11 > v12 )
        return 1;
      v18 = this + 4 * (v11 + 4 * (3 * v11 + 14670) + 4890);
      do
      {
        v18 += 52;
        ++v11;
        *(_DWORD *)(v18 - 52) = *(_DWORD *)(this + 287980) * *(_DWORD *)(this + 24) / 100;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x1A:
      if ( v11 > v12 )
        return 1;
      v19 = this + 52 * v11 + 254288;
      do
      {
        v19 += 52;
        ++v11;
        *(_DWORD *)(v19 - 52) = *(_DWORD *)(this + 24) - *(_DWORD *)(this + 287980) * *(_DWORD *)(this + 24) / 100;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x1B:
      if ( v11 > v12 )
        return 1;
      v20 = this + 52 * v11 + 254292;
      do
      {
        ++v11;
        *(_BYTE *)v20 = *(_BYTE *)(this + 287980);
        v20 += 52;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x1C:
      if ( v11 > v12 )
        return 1;
      v21 = this + 52 * v11 + 254268;
      do
      {
        v21 += 52;
        ++v11;
        *(_BYTE *)(v21 - 52) = *(_BYTE *)(this + 287980) + 10;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x1D:
      v22 = *(_DWORD *)(this + 286660);
      if ( v11 > v12 )
        return 1;
      v35 = this + 52 * v22 + 254268;
      do
      {
        v23 = 1;
        v24 = v22 - *(_DWORD *)(this + 286660) + 1;
        if ( v24 > 1 )
        {
          do
          {
            if ( (*(int (__stdcall **)(int))(**(_DWORD **)(*(_DWORD *)(*(_DWORD *)(this + 320) + 76) + 4 * v23) + 28))(v24) )
              break;
            ++v23;
          }
          while ( v23 < v24 );
        }
        ++v22;
        *(_BYTE *)v35 = v23 + 1;
        v35 += 52;
      }
      while ( v22 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x1E:
      v25 = *(_DWORD *)(this + 286660);
      if ( v11 > v12 )
        return 1;
      v26 = this + 52 * v25 + 254268;
      do
      {
        v26 += 52;
        ++v25;
        *(_BYTE *)(v26 - 52) = (*(_WORD *)(*(_DWORD *)(this + 320) + 72) - 1) * rand() / 32767 + 2;
      }
      while ( v25 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x1F:
      if ( v11 > v12 )
        return 1;
      v27 = this + 52 * v11 + 254264;
      do
      {
        ++v11;
        *(_DWORD *)v27 = *(_DWORD *)(this + 287980);
        v27 += 52;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x48:
      if ( v11 > v12 )
        return 1;
      v28 = 16 * v11 + this + 251444;
      do
      {
        v28 += 16;
        ++v11;
        *(_DWORD *)(v28 - 16) = *(_DWORD *)(this + 287980) + 10;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x16:
      if ( v11 > v12 )
        return 1;
      v29 = this + 52 * v11 + 254260;
      do
      {
        ++v11;
        *(_DWORD *)v29 = *(_DWORD *)(this + 287980);
        v29 += 52;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x49:
      if ( v11 > v12 )
        return 1;
      v30 = this + 52 * v11 + 254272;
      do
      {
        ++v11;
        *(_DWORD *)v30 = *(_DWORD *)(this + 287980);
        v30 += 52;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x56:
      if ( v11 > v12 )
        return 1;
      v31 = this + 4 * v11 + 286672;
      do
      {
        ++v11;
        *(_DWORD *)v31 = *(_DWORD *)(this + 287980);
        v31 += 4;
      }
      while ( v11 <= *(_DWORD *)(this + 286664) );
      result = 1;
      break;
    case 0x21:
      if ( *(_BYTE *)(this + 286669) )
      {
        v32 = *(_DWORD *)(this + 287980);
        if ( v32 >= 0 || v32 <= 9 )
        {
          if ( v32 < *(_WORD *)(*(_DWORD *)(this + 320) + 72) )
          {
            *(_DWORD *)(16 * v11 + this + 251448) = v32;
            v34 = 16 * *(_DWORD *)(this + 286660) + this + 251444;
            if ( *(_DWORD *)v34 )
              return 1;
            *(_DWORD *)v34 = 1;
            result = 1;
          }
          else
          {
            Pinfo_DEPRECATED(dword_6B566C);
            if ( *(_BYTE *)(this + 286669) )
            {
              v33 = *(_DWORD *)(this + 253020) - 1;
              --*(_DWORD *)(this + 259392);
              *(_DWORD *)(this + 253020) = v33;
            }
            *(_BYTE *)(this + 286669) = 0;
            result = 1;
          }
        }
        else
        {
          Pinfo_DEPRECATED(dword_6B566C);
          result = 1;
        }
      }
      else
      {
        Pinfo_DEPRECATED(dword_6B566C);
        result = 1;
      }
      break;
    default:
      Pinfo_DEPRECATED(dword_6B566C);
      result = 1;
      break;
  }
  return result;
}

//----- (0053AEF0) --------------------------------------------------------
int __thiscall sub_53AEF0(int this, int a2, int a3)
{
  int v3; // eax@1
  int result; // eax@4

  v3 = this + 16 * a2;
  *(_DWORD *)(v3 + 251448) = a3;
  *(_DWORD *)(v3 + 251444) = a3 > 0;
  *(_DWORD *)(this + 253020) = a2 + 1;
  result = this + 52 * a2;
  *(_DWORD *)(result + 254276) = 0;
  *(_DWORD *)(this + 4 * (a2 + 4 * (3 * a2 + 14670) + 4890)) = 0;
  *(_DWORD *)(result + 254284) = *(_DWORD *)(this + 20);
  *(_DWORD *)(result + 254288) = *(_DWORD *)(this + 24);
  *(_DWORD *)(result + 254272) = 8;
  *(_BYTE *)(result + 254268) = a3;
  *(_DWORD *)(result + 254264) = 0;
  *(_BYTE *)(result + 254292) = 20;
  *(_DWORD *)(result + 254260) = 3;
  *(_DWORD *)(result + 254252) = -1;
  *(_DWORD *)(result + 254256) = -1;
  *(_DWORD *)(result + 254244) = *(_DWORD *)(this + 20) * *(_DWORD *)(this + 24);
  *(_DWORD *)(this + 4 * a2 + 286672) = -1;
  return result;
}

//----- (0053AFB0) --------------------------------------------------------
char __thiscall _rms__sub_53AFB0(RandomMapScript* this, int a2)
{
  int v2; // eax@3
  int v3; // esi@3
  char result; // al@3
  int v5; // eax@4

  if ( !*(_DWORD *)(this + 259444) )
  {
    if ( *(_DWORD *)(a2 + 104) == 43 )
    {
      v2 = *(_DWORD *)(this + 244296);
      v3 = *(_DWORD *)(this + 288396);
      *(_DWORD *)(this + 287068) = v2;
      *(_DWORD *)(this + 244296) = v2 + 1;
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239948) = *(_DWORD *)(v3 + 104);
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239940) = *(_DWORD *)(this + 20);
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239952) = 1;
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239956) = 0;
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239964) = 20;
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239968) = 0;
      *(_BYTE *)(*(_DWORD *)(this + 287068) + this + 287072) = 0;
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239972) = 0;
      *(_DWORD *)(this + 44 * (*(_DWORD *)(this + 287068) + 5454)) = 255;
      *(_DWORD *)(this + 44 * *(_DWORD *)(this + 287068) + 239980) = 0;
      return 1;
    }
    return 1;
  }
  v5 = *(_DWORD *)(this + 287068);
  if ( v5 < 0 )
  {
LABEL_17:
    Pinfo_DEPRECATED(dword_6B566C);
    return 1;
  }
  switch ( *(_DWORD *)(a2 + 104) )
  {
    case 0x13:
      *(_DWORD *)(this + 44 * v5 + 239960) = *(_DWORD *)(*(_DWORD *)(this + 288396) + 104);
      result = 1;
      break;
    case 0x12:
      *(_DWORD *)(this + 44 * v5 + 239940) = -*(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x4A:
      *(_DWORD *)(this + 44 * v5 + 239940) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x2D:
      *(_DWORD *)(this + 44 * v5 + 239952) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x2E:
      *(_DWORD *)(this + 44 * v5 + 239956) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x49:
      *(_DWORD *)(this + 44 * v5 + 239964) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x4D:
      *(_DWORD *)(this + 44 * v5 + 239968) = 1;
      result = 1;
      break;
    case 0x4B:
      *(_BYTE *)(v5 + this + 287072) = 2;
      result = 1;
      break;
    case 0x4C:
      *(_BYTE *)(v5 + this + 287072) = 1;
      result = 1;
      break;
    case 0x58:
      *(_DWORD *)(this + 44 * v5 + 239972) = *(_DWORD *)(this + 287980);
      *(_DWORD *)(this + 44 * (*(_DWORD *)(this + 287068) + 5454)) = *(_DWORD *)(this + 287984);
      result = 1;
      break;
    case 0x59:
      *(_DWORD *)(this + 44 * v5 + 239980) = 1;
      result = 1;
      break;
    default:
      goto LABEL_17;
  }
  return result;
}

//----- (0053B2B0) --------------------------------------------------------
char __thiscall _rms__type_0x22_53B2B0(int this, int a2)
{
  char result; // al@2

  switch ( *(_DWORD *)(a2 + 104) )
  {
    case 0x23:
      result = 1;
      *(_DWORD *)(this + 253024 /* ->cliffs_min_number */) = *(_DWORD *)(this + 287980);
      break;
    case 0x24:
      *(_DWORD *)(this + 253028 /* ->cliffs_max_number */) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x25:
      result = 1;
      *(_DWORD *)(this + 253032 /* ->min_length_cliffs */) = *(_DWORD *)(this + 287980);
      break;
    case 0x26:
      *(_DWORD *)(this + 253036 /* ->max_length_cliffs */) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x27:
      result = 1;
      *(_DWORD *)(this + 253040 /* ->cliff_curliness */) = *(_DWORD *)(this + 287980);
      break;
    case 0x28:
      *(_DWORD *)(this + 253048 /* ->cliffs_min_distance */) = *(_DWORD *)(this + 287980);
      result = 1;
      break;
    case 0x29:
      result = 1;
      *(_DWORD *)(this + 253044 /* ->terrain_min_distance */) = *(_DWORD *)(this + 287980);
      break;
    default:
      Pinfo_DEPRECATED(dword_6B566C);
      result = 1;
      break;
  }
  return result;
}

//----- (0053B380) --------------------------------------------------------
char __thiscall _rms__type_0x2F_53B380(int this, int a2)
{
  int v2; // eax@3
  int v3; // edx@3
  char result; // al@3
  int v5; // eax@4
  int v6; // edx@7
  int v7; // edx@8
  int v8; // edx@24
  int v9; // edx@25
  int v10; // esi@26
  int v11; // eax@29
  int v12; // eax@32

  if ( *(_DWORD *)(this + 259444) )
  {
    v5 = *(_DWORD *)(this + 287576);
    if ( v5 >= 0 )
    {
      switch ( *(_DWORD *)(a2 + 104) )
      {
        case 0x31:
          v6 = 7 * v5;
          result = 1;
          *(_BYTE *)(this + 8 * v6 + 245897) = 1;
          break;
        case 0x57:
          v7 = 7 * v5;
          result = 1;
          *(_BYTE *)(this + 8 * v7 + 245897) = 2;
          break;
        case 0x32:
          if ( !*(_BYTE *)(this + 56 * (v5 + 4391)) )
          {
            *(_DWORD *)(this + 56 * v5 + 245900) = *(_DWORD *)(this + 56 * v5 + 245908);
            *(_BYTE *)(this + 56 * (*(_DWORD *)(this + 287576) + 4391)) = 1;
          }
          *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245908) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x33:
          if ( *(_BYTE *)(this + 56 * (v5 + 4391)) )
          {
            *(_DWORD *)(this + 56 * v5 + 245900) = *(_DWORD *)(this + 287980);
            result = 1;
          }
          else
          {
            *(_DWORD *)(this + 56 * v5 + 245908) = *(_DWORD *)(this + 287980);
            result = 1;
          }
          break;
        case 0x34:
          *(_DWORD *)(this + 56 * v5 + 245904) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x35:
          *(_DWORD *)(this + 56 * v5 + 245912) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x36:
          if ( !*(_BYTE *)(this + 56 * (v5 + 4391)) )
          {
            *(_DWORD *)(this + 56 * v5 + 245900) = *(_DWORD *)(this + 56 * v5 + 245908);
            *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245908) = 1;
          }
          result = 1;
          *(_BYTE *)(this + 56 * (*(_DWORD *)(this + 287576) + 4391)) = 1;
          break;
        case 0x37:
          if ( !*(_BYTE *)(this + 56 * (v5 + 4391)) )
          {
            *(_DWORD *)(this + 56 * v5 + 245900) = *(_DWORD *)(this + 56 * v5 + 245908);
            *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245908) = 1;
          }
          result = 1;
          *(_BYTE *)(this + 56 * (*(_DWORD *)(this + 287576) + 4391)) = 2;
          break;
        case 0x38:
          *(_DWORD *)(this + 56 * v5 + 245892) = *(_DWORD *)(*(_DWORD *)(this + 288396) + 104);
          result = 1;
          break;
        case 0x39:
          v8 = 7 * v5;
          result = 1;
          *(_DWORD *)(this + 8 * v8 + 245916) = 0;
          break;
        case 0x3A:
          v9 = 7 * v5;
          result = 1;
          *(_DWORD *)(this + 8 * v9 + 245920) = 1;
          break;
        case 0x3B:
          v10 = 7 * v5;
          result = 1;
          *(_DWORD *)(this + 8 * v10 + 245920) = *(_DWORD *)(this + 287980) + 10;
          break;
        case 0x4E:
          *(_DWORD *)(this + 56 * v5 + 245932) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x5D:
          *(_DWORD *)(this + 56 * v5 + 245936) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x3C:
          v11 = this + 56 * v5 + 245920;
          if ( *(_DWORD *)v11 == -1 )
            *(_DWORD *)v11 = -2;
          *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245924) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x3D:
          v12 = this + 56 * v5 + 245920;
          if ( *(_DWORD *)v12 == -1 )
            *(_DWORD *)v12 = -2;
          *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245928) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        case 0x5B:
          *(_DWORD *)(this + 56 * v5 + 245940) = *(_DWORD *)(this + 287980);
          result = 1;
          break;
        default:
          Pinfo_DEPRECATED(dword_6B566C);
          goto LABEL_37;
      }
    }
    else
    {
      Pinfo_DEPRECATED(dword_6B566C);
      result = 1;
    }
  }
  else
  {
    if ( *(_DWORD *)(a2 + 104) == 48 )
    {
      v2 = *(_DWORD *)(this + 251432);
      v3 = *(_DWORD *)(this + 288396);
      *(_DWORD *)(this + 287576) = v2;
      *(_DWORD *)(this + 251432) = v2 + 1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245888) = *(_DWORD *)(v3 + 104);
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245892) = -1;
      *(_BYTE *)(this + 56 * (*(_DWORD *)(this + 287576) + 4391)) = 0;
      *(_BYTE *)(this + 56 * *(_DWORD *)(this + 287576) + 245897) = 0;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245900) = 1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245904) = 0;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245908) = 1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245912) = 3;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245916) = -1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245920) = -1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245924) = -1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245928) = -1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245932) = 0;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245936) = 0;
      result = 1;
      *(_DWORD *)(this + 56 * *(_DWORD *)(this + 287576) + 245940) = 0;
    }
    else
    {
LABEL_37:
      result = 1;
    }
  }
  return result;
}

//----- (0053B930) --------------------------------------------------------
char __thiscall _rms__type_0x3E_53B930(int this, int a2)
{
  signed int v2; // eax@2
  int v3; // eax@4
  signed int v4; // eax@4
  int v5; // esi@5
  char result; // al@6
  int v7; // eax@8
  signed int v8; // esi@11
  int v9; // edx@12
  int v10; // edx@15

  if ( *(_DWORD *)(this + 259444) )
  {
    v7 = *(_DWORD *)(this + 287580);
    if ( v7 >= 0 )
    {
      switch ( *(_DWORD *)(a2 + 104) )
      {
        case 0x52:
          v8 = 0;
          do
          {
            v9 = v8++ + *(_DWORD *)(this + 287580);
            *(_DWORD *)(this + 4 * (v9 + 594 * *(_DWORD *)(this + 287580)) + 5904) = *(_DWORD *)(*(_DWORD *)(this + 288396)
                                                                                               + 104);
          }
          while ( v8 < 99 );
          result = 1;
          break;
        case 0x53:
          *(_DWORD *)(this + 4 * (595 * v7 + *(_DWORD *)(*(_DWORD *)(this + 288396) + 104)) + 5904) = *(_DWORD *)(*(_DWORD *)(this + 288400) + 104);
          result = 1;
          break;
        case 0x54:
          v10 = 595 * v7 + *(_DWORD *)(*(_DWORD *)(this + 288396) + 104);
          result = 1;
          *(float *)(this + 4 * v10 + 6300) = (double)*(signed int *)(this + 287984);
          break;
        case 0x55:
          *(_DWORD *)(this + 4 * (*(_DWORD *)(*(_DWORD *)(this + 288396) + 104) + 595 * v7) + 5112) = *(_DWORD *)(this + 287984);
          *(_DWORD *)(this
                    + 4 * (*(_DWORD *)(*(_DWORD *)(this + 288396) + 104) + 595 * *(_DWORD *)(this + 287580))
                    + 5508) = *(_DWORD *)(this + 287988);
          goto LABEL_17;
        default:
LABEL_17:
          result = 1;
          break;
      }
    }
    else
    {
      Pinfo_DEPRECATED(dword_6B566C);
      result = 1;
    }
  }
  else
  {
    v2 = *(_DWORD *)(a2 + 104);
    if ( v2 < 63 || v2 > 66 )
    {
      Pinfo_DEPRECATED(dword_6B566C);
      result = 1;
    }
    else
    {
      v3 = *(_DWORD *)(this + 239936);
      *(_DWORD *)(this + 287580) = v3;
      *(_DWORD *)(this + 239936) = v3 + 1;
      v4 = 0;
      do
      {
        *(_DWORD *)(this + 4 * (v4 + *(_DWORD *)(this + 287580) + 594 * *(_DWORD *)(this + 287580)) + 6300) = 1.0f;
        *(_DWORD *)(this + 4 * (v4 + *(_DWORD *)(this + 287580) + 594 * *(_DWORD *)(this + 287580)) + 5112) = 1;
        *(_DWORD *)(this + 4 * (v4 + *(_DWORD *)(this + 287580) + 594 * *(_DWORD *)(this + 287580)) + 5508) = 0;
        v5 = v4++ + *(_DWORD *)(this + 287580);
        *(_DWORD *)(this + 4 * (v5 + 594 * *(_DWORD *)(this + 287580)) + 5904) = -1;
      }
      while ( v4 < 99 );
      *(_DWORD *)(this + 4 * *(_DWORD *)(this + 287580) + 287584) = *(_DWORD *)(a2 + 104);
      result = 1;
    }
  }
  return result;
}

//----- (0053BB70) --------------------------------------------------------
char __thiscall _rms__type_0x4F_53BB70(int this, int a2)
{
  int v2; // eax@3
  int v3; // edx@3
  int v4; // edi@4
  int v5; // esi@4
  int v6; // edx@5
  int v7; // edx@7
  char result; // al@8
  int v9; // esi@9
  int v10; // edx@10
  int v11; // eax@13
  int v12; // edx@14
  int v13; // eax@17
  int v14; // edx@18
  int v15; // eax@21
  int v16; // edx@22
  int v17; // eax@25
  int v18; // edx@26
  int v19; // eax@29
  int v20; // edx@30
  int v21; // eax@33
  int v22; // edx@34

  if ( !*(_DWORD *)(this + 259444) )
  {
    if ( *(_DWORD *)(a2 + 104) == 80 )
    {
      v2 = *(_DWORD *)(this + 2724);
      v3 = v2 + *(_DWORD *)(this + 287980);
      *(_DWORD *)(this + 287172) = v2;
      *(_DWORD *)(this + 2724) = v3;
      *(_DWORD *)(this + 287176) = v3;
      if ( v2 < v3 )
      {
        v4 = this + 4 * v2 + 287180;
        v5 = this + 24 * v2 + 352;
        do
        {
          *(_DWORD *)(v5 - 4) = *(_DWORD *)(this + 20);
          v6 = v2 - *(_DWORD *)(this + 287172) + 1;
          *(_DWORD *)v5 = v6;
          if ( v6 > 7 )
            *(_DWORD *)v5 = 7;
          *(_DWORD *)(v5 + 4) = 1;
          v4 += 4;
          *(_DWORD *)(v5 + 8) = (v2 == *(_DWORD *)(this + 287172)) + 1;
          v5 += 24;
          v7 = v2++ - *(_DWORD *)(this + 287172);
          *(_DWORD *)(v5 - 12) = v7;
          *(_DWORD *)(v4 - 4) = 0;
        }
        while ( v2 < *(_DWORD *)(this + 287176) );
        return 1;
      }
    }
    return 1;
  }
  v9 = *(_DWORD *)(this + 287172);
  if ( v9 < 0 || (v10 = *(_DWORD *)(this + 287176), v10 < 0) )
  {
    Pinfo_DEPRECATED(dword_6B566C);
    return 1;
  }
  switch ( *(_DWORD *)(a2 + 104) )
  {
    case 0x51:
      if ( *(_DWORD *)(this + 287980) <= 0 || (v11 = v9 + 1, v9 + 1 >= v10) )
        return 1;
      v12 = this + 8 * (3 * v11 + 45);
      do
      {
        ++v11;
        *(_DWORD *)v12 = *(_DWORD *)(this + 287980);
        v12 += 24;
      }
      while ( v11 < *(_DWORD *)(this + 287176) );
      result = 1;
      break;
    case 0x13:
      v13 = *(_DWORD *)(this + 287172);
      if ( v9 >= v10 )
        return 1;
      v14 = this + 24 * v9 + 368;
      do
      {
        ++v13;
        v14 += 24;
        *(_DWORD *)(v14 - 24) = *(_DWORD *)(*(_DWORD *)(this + 288396) + 104);
      }
      while ( v13 < *(_DWORD *)(this + 287176) );
      result = 1;
      break;
    case 0x2D:
      v15 = *(_DWORD *)(this + 287172);
      if ( v9 >= v10 )
        return 1;
      v16 = this + 24 * v9 + 356;
      do
      {
        ++v15;
        *(_DWORD *)v16 = *(_DWORD *)(this + 287980);
        v16 += 24;
      }
      while ( v15 < *(_DWORD *)(this + 287176) );
      result = 1;
      break;
    case 0x4A:
      v17 = *(_DWORD *)(this + 287172);
      if ( v9 >= v10 )
        return 1;
      v18 = this + 24 * v9 + 348;
      do
      {
        ++v17;
        *(_DWORD *)v18 = *(_DWORD *)(this + 287980);
        v18 += 24;
      }
      while ( v17 < *(_DWORD *)(this + 287176) );
      result = 1;
      break;
    case 0x4B:
      v19 = *(_DWORD *)(this + 287172);
      if ( v9 >= v10 )
        return 1;
      v20 = this + 4 * v9 + 287180;
      do
      {
        *(_DWORD *)v20 = 1;
        ++v19;
        v20 += 4;
      }
      while ( v19 < *(_DWORD *)(this + 287176) );
      result = 1;
      break;
    case 0x4C:
      v21 = *(_DWORD *)(this + 287172);
      if ( v9 >= v10 )
        return 1;
      v22 = this + 4 * v9 + 287180;
      do
      {
        *(_DWORD *)v22 = 2;
        ++v21;
        v22 += 4;
      }
      while ( v21 < *(_DWORD *)(this + 287176) );
      result = 1;
      break;
    default:
      Pinfo_DEPRECATED(dword_6B566C);
      result = 1;
      break;
    case 0x4D:
      return 1;
  }
  return result;
}

//----- (0053BE20) --------------------------------------------------------
int __thiscall RGE_RMM_Objects_Generator__constructor(int this, int a2, int a3, int a4, const void *a5, char a6)
{
  int _this; // ebp@1
  int v7; // eax@4
  int v8; // eax@5
  int v9; // edx@7

  _this = this;
  _RGE_Random_Map_Module(this, a2, a3, 1);
  *(_DWORD *)_this = &STATIC_TERRAIN;
  *(_DWORD *)(_this + 56) = a4;
  if ( a5 )
  {
    memcpy((void *)(_this + 60), a5, 0x1BE0u);
  }
  else
  {
    *(_DWORD *)(_this + 5604) = 0;
    *(_DWORD *)(_this + 7192) = 0;
  }
  *(_DWORD *)(_this + 36) = 0x40400000u;
  *(_DWORD *)(_this + 7240) = 0;
  *(_BYTE *)(_this + 7238) = a6;
  v7 = operator new(0xCu);
  if ( v7 )
    v8 = sub_57ED60(v7, *(_DWORD *)(_this + 56));
  else
    v8 = 0;
  v9 = *(_DWORD *)(_this + 56);
  *(_DWORD *)(_this + 7244) = v8;
  sub_57EE80(v8, *(_DWORD *)(*(_DWORD *)(**(_DWORD **)(v9 + 76) + 116) + 332));
  *(_DWORD *)(_this + 7248) = 0;
  return _this;
}
// 64068C: using guessed type int (__thiscall *STATIC_TERRAIN)(void *Memory, char);

//----- (0053BFF0) --------------------------------------------------------
int __thiscall RGE_RMM_Objects_Generator__sub_53BFF0(int this, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9)
{
  int result; // eax@1

  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 60) = a2;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 64) = -1;
  *(_BYTE *)(this + 56 * *(_DWORD *)(this + 5604) + 68) = 0;
  *(_BYTE *)(this + 56 * *(_DWORD *)(this + 5604) + 69) = 0;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 72) = 1;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 76) = 1;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 80) = a3;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 84) = 2;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 88) = a8;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 92) = *(_DWORD *)(this + 7192);
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 96) = a6;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 100) = a7;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 104) = a9;
  *(_DWORD *)(this + 56 * *(_DWORD *)(this + 5604) + 108) = 0;
  *(_DWORD *)(this + 56 * (*(_DWORD *)(this + 5604) + 2)) = 0;
  *(_DWORD *)(16 * *(_DWORD *)(this + 7192) + this + 5608) = a4;
  *(_DWORD *)(16 * *(_DWORD *)(this + 7192) + this + 5612) = a5;
  *(_DWORD *)(16 * (*(_DWORD *)(this + 7192) + 351) + this) = *(_DWORD *)(this + 7192);
  *(_DWORD *)(16 * *(_DWORD *)(this + 7192) + this + 5620 /* ->something_dp */) = a8;
  result = *(_DWORD *)(this + 7192) + 1;
  ++*(_DWORD *)(this + 5604);
  *(_DWORD *)(this + 7192) = result;
  return result;
}

//----- (0053C1B0) --------------------------------------------------------
char __fastcall sub_53C1B0(int a1)
{
  int v1; // esi@1
  void *v2; // edi@3
  char v3; // dl@3
  unsigned int v4; // ecx@3
  int v5; // edi@3
  int i; // ecx@3
  int v7; // edi@6
  int v8; // ebx@7

  v1 = a1;
  if ( *(_BYTE *)(a1 + 7238) )
  {
    LOWORD(a1) = *(_WORD *)(a1 + 24) - 1;
    sub_585230(
      *(void **)(v1 + 12),
      **(_DWORD **)(*(_DWORD *)(v1 + 56) + 76),
      *(_DWORD *)(v1 + 56),
      0,
      0,
      *(_WORD *)(v1 + 20) - 1,
      a1,
      1,
      0,
      0);
  }
  v2 = *(void **)(v1 + 40);
  v3 = *(_BYTE *)(v1 + 20) * *(_BYTE *)(v1 + 24);
  v4 = (unsigned int)(*(_DWORD *)(v1 + 20) * *(_DWORD *)(v1 + 24)) >> 2;
  memset(v2, 16843009, 4 * v4);
  v5 = (int)((char *)v2 + 4 * v4);
  for ( i = v3 & 3; i; --i )
    *(_BYTE *)v5++ = 1;
  sub_5418D0(v1);
  memset((void *)(v1 + 7196), 0, 0x28u);
  *(_WORD *)(v1 + 7236) = 0;
  v7 = 0;
  if ( *(_DWORD *)(v1 + 5604) > 0 )
  {
    v8 = v1 + 60;
    do
    {
      sub_53C260(v1, v8);
      ++v7;
      v8 += 56;
    }
    while ( v7 < *(_DWORD *)(v1 + 5604) );
  }
  destructor_409010(*(_DWORD *)(*(_DWORD *)(v1 + 12) + 41588));
  return 1;
}

//----- (0053C260) --------------------------------------------------------
int __thiscall sub_53C260(int this, int a2)
{
  char v2; // al@1
  int v3; // edi@1
  int v4; // edx@2
  int v5; // eax@5
  int result; // eax@7
  int v7; // ebp@8
  int v8; // ebx@9
  __int64 v9; // ST04_8@11

  v2 = *(_BYTE *)(a2 + 9);
  v3 = this;
  if ( v2 == 1 )
  {
    v4 = *(_DWORD *)(a2 + 20) * *(_DWORD *)(this + 20) * *(_DWORD *)(this + 24) / 10000;
    *(_DWORD *)(a2 + 20) = v4;
    if ( v4 >= 1 )
      goto LABEL_7;
    goto LABEL_6;
  }
  if ( v2 == 2 )
  {
    v5 = *(_DWORD *)(a2 + 20) * (*(_WORD *)(*(_DWORD *)(this + 56) + 72) - 1);
    *(_DWORD *)(a2 + 20) = v5;
    if ( v5 < 1 )
    {
LABEL_6:
      *(_DWORD *)(a2 + 20) = 1;
      goto LABEL_7;
    }
  }
LABEL_7:
  result = *(_DWORD *)(a2 + 32);
  if ( result < 0 )
  {
    if ( result == -1 )
    {
      result = sub_53C9D0((void *)this, a2);
    }
    else
    {
      if ( result == -2 )
        result = sub_53C720((void *)this, a2, *(_DWORD *)(a2 + 36));
    }
  }
  else
  {
    result = *(_DWORD *)(this + 7192);
    v7 = 0;
    if ( result > 0 )
    {
      v8 = this + 5612;
      do
      {
        if ( *(_DWORD *)(v8 + 4) == *(_DWORD *)(a2 + 32) )
        {
          HIDWORD(v9) = *(_DWORD *)v8;
          LODWORD(v9) = *(_DWORD *)(v8 - 4);
          sub_53CC60(v3, a2, v9, *(_DWORD *)(a2 + 36), *(_DWORD *)(a2 + 40), v7);
        }
        result = *(_DWORD *)(v3 + 7192);
        ++v7;
        v8 += 16;
      }
      while ( v7 < result );
    }
  }
  return result;
}

//----- (0053C340) --------------------------------------------------------
int __thiscall sub_53C340(int this, int a2, __int64 a3, int a4, int a5)
{
  int v5; // ebx@1
  int v6; // edi@1
  int v7; // esi@3
  int v8; // ebp@3
  int v9; // ecx@3
  int v10; // eax@7
  int v11; // eax@9
  int v12; // eax@13
  int v13; // edx@13
  int v14; // ecx@14
  int v15; // esi@14
  int v16; // edx@15
  int v17; // eax@16
  int v18; // esi@18
  int v19; // ebp@23
  int result; // eax@23
  int v21; // eax@27
  signed int v22; // edx@27
  int v23; // esi@27
  int v24; // edx@27
  int v25; // [sp+10h] [bp-10h]@15
  int v26; // [sp+14h] [bp-Ch]@16
  int v27; // [sp+18h] [bp-8h]@14
  int v28; // [sp+1Ch] [bp-4h]@14
  int v29; // [sp+28h] [bp+8h]@3
  int v30; // [sp+2Ch] [bp+Ch]@3
  int v31; // [sp+2Ch] [bp+Ch]@26
  int v32; // [sp+34h] [bp+14h]@13
  int v33; // [sp+34h] [bp+14h]@23

  v5 = 0;
  v6 = this;
  *(_DWORD *)(a2 + 16) = 0;
  *(_DWORD *)(a2 + 20) = 0;
  if ( a3 < 0 || a5 < 0 )
  {
    v11 = *(_DWORD *)(this + 24);
    v29 = 0;
    v8 = *(_DWORD *)(this + 20) - 1;
LABEL_12:
    v30 = v11 - 1;
    goto LABEL_13;
  }
  v5 = a3 - a5;
  v7 = HIDWORD(a3) - a5;
  v8 = a5 + a3;
  v9 = a5 + HIDWORD(a3);
  LODWORD(a3) = HIDWORD(a3) - a5;
  v30 = a5 + HIDWORD(a3);
  if ( v5 < 0 )
    v5 = 0;
  if ( v7 < 0 )
    v29 = 0;
  v10 = *(_DWORD *)(v6 + 20);
  if ( v8 >= v10 )
    v8 = v10 - 1;
  v11 = *(_DWORD *)(v6 + 24);
  if ( v9 >= v11 )
    goto LABEL_12;
LABEL_13:
  v12 = v30;
  v32 = a2;
  v13 = v29;
  if ( v29 <= v30 )
  {
    v14 = 4 * v29;
    v27 = 4 * v29;
    v15 = v30 - v29 + 1;
    v28 = v30 - v29 + 1;
    do
    {
      v16 = v5;
      v25 = v5;
      if ( v5 <= v8 )
      {
        v17 = 24 * v5;
        v26 = 24 * v5;
        do
        {
          if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v6 + 44) + v14) + v16) )
          {
            v18 = v17 + *(_DWORD *)(*(_DWORD *)(v6 + 52) + v14);
            sub_541860(v32, v17 + *(_DWORD *)(*(_DWORD *)(v6 + 52) + v14));
            v16 = v25;
            v17 = v26;
            v14 = v27;
            v32 = v18;
          }
          ++v16;
          v17 += 24;
          v25 = v16;
          v26 = v17;
        }
        while ( v16 <= v8 );
        v12 = v30;
        v15 = v28;
      }
      v14 += 4;
      --v15;
      v27 = v14;
      v28 = v15;
    }
    while ( v15 );
    v13 = v29;
  }
  v19 = v8 - v5 - 1;
  result = v12 - v13 - 1;
  v33 = result;
  if ( v19 > 1 )
  {
    if ( result > 1 )
    {
      result = v19 * result / 4;
      if ( result > 0 )
      {
        v31 = result;
        do
        {
          v21 = rand();
          v22 = (signed int)(v19 * v21 + ((unsigned __int64)(-2147418109i64 * v19 * v21) >> 32)) >> 14;
          v23 = v5 + ((unsigned int)v22 >> 31) + v22;
          v24 = v29 + v33 * rand() / 32767;
          if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v6 + 44) + 4 * v24) + v23) )
            sub_541860(a2, *(_DWORD *)(*(_DWORD *)(v6 + 52) + 4 * v24) + 24 * v23);
          result = v31-- - 1;
        }
        while ( v31 );
      }
    }
  }
  return result;
}

//----- (0053C500) --------------------------------------------------------
char __thiscall sub_53C500(int this, int a2, int a3, int a4)
{
  signed int v4; // ebx@1
  int v5; // edi@2
  int v6; // esi@2
  int v7; // edx@3
  int v8; // ecx@4
  int v9; // eax@6
  char result; // al@11

  v4 = *(_DWORD *)(a2 + 36);
  if ( v4 <= -1 || (v5 = *(_DWORD *)(this + 7192), v6 = 0, v5 <= 0) )
  {
LABEL_11:
    result = 0;
  }
  else
  {
    v7 = this + 5612;
    while ( 1 )
    {
      v8 = a3 - *(_DWORD *)(v7 - 4);
      if ( v8 < 0 )
        v8 = -v8;
      v9 = a4 - *(_DWORD *)v7;
      if ( a4 - *(_DWORD *)v7 < 0 )
        v9 = -v9;
      if ( v8 < v4 && v9 < v4 )
        break;
      ++v6;
      v7 += 16;
      if ( v6 >= v5 )
        goto LABEL_11;
    }
    result = 1;
  }
  return result;
}

//----- (0053C560) --------------------------------------------------------
void __thiscall sub_53C560(int this, int a2, int a3, int a4, char a5, int a6)
{
  int v6; // ebp@1
  int v7; // edi@1
  int v8; // esi@1
  bool v9; // zf@1
  bool v10; // sf@1
  int v11; // edx@2
  int v12; // eax@2
  int v13; // esi@2
  int v14; // edx@3
  int v15; // eax@13
  int v16; // ebx@13
  int v17; // eax@15
  int v18; // esi@15
  int v19; // edx@18
  int v20; // esi@19
  int v21; // [sp+10h] [bp-8h]@1
  int v22; // [sp+14h] [bp-4h]@3
  int v23; // [sp+1Ch] [bp+4h]@1
  int v24; // [sp+20h] [bp+8h]@1
  int v25; // [sp+24h] [bp+Ch]@1

  v6 = a2 - a4;
  v7 = a3 - a4;
  v8 = a4 + a3;
  v21 = a2 - a4;
  v9 = a4 == 0;
  v10 = a4 < 0;
  v25 = a4 + a2;
  v24 = v8;
  v23 = 0;
  if ( !(v10 | v9) )
  {
    v11 = *(_DWORD *)(this + 56);
    v12 = 0;
    v13 = *(_WORD *)(v11 + 72);
    if ( v13 > 0 )
    {
      v14 = *(_DWORD *)(v11 + 76);
      v22 = v14;
      while ( !*(_DWORD *)(*(_DWORD *)(*(_DWORD *)v14 + 116) + 4 * a6) )
      {
        ++v12;
        v14 += 4;
        if ( v12 >= v13 )
          goto LABEL_8;
      }
      v23 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(this + 56) + 96)
                      + 4 * *(_WORD *)(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v22 + 4 * v12) + 116) + 4 * a6) + 110));
LABEL_8:
      v6 = v21;
    }
    if ( v6 < 0 )
      v6 = 0;
    if ( v7 < 0 )
      v7 = 0;
    v15 = *(_DWORD *)(this + 20);
    v16 = v25;
    if ( v25 >= v15 )
    {
      v16 = v15 - 1;
      v25 = v15 - 1;
    }
    v17 = *(_DWORD *)(this + 24);
    v18 = v24;
    if ( v24 >= v17 )
    {
      v18 = v17 - 1;
      v24 = v17 - 1;
    }
    for ( ; v7 <= v18; ++v7 )
    {
      v19 = v6;
      if ( v6 <= v16 )
      {
        v20 = 32 * v6;
        do
        {
          if ( v23 )
          {
            if ( *(float *)(v23 + 4 * *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(this + 16) + 4 * v7) + v20 + 5)) > 0.0 )
              *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(this + 44) + 4 * v7) + v19) = a5;
          }
          v16 = v25;
          ++v19;
          v20 += 32;
        }
        while ( v19 <= v25 );
        v18 = v24;
      }
    }
  }
}

//----- (0053C680) --------------------------------------------------------
int __thiscall sub_53C680(void *this, int a2, int a3, int a4)
{
  void *v4; // ebp@1
  int v5; // ebx@1
  int v6; // ecx@1
  int v7; // edi@1
  int result; // eax@1
  bool v9; // sf@1
  int v10; // edx@5
  int v11; // edx@7
  int v12; // esi@11
  int v13; // edi@11
  int v14; // [sp+14h] [bp+4h]@1
  int i; // [sp+18h] [bp+8h]@9
  int v16; // [sp+1Ch] [bp+Ch]@1

  v4 = this;
  v5 = a2 - a4;
  v6 = a3 - a4;
  v7 = a2 + a4;
  result = a3 + a4;
  v9 = a2 - a4 < 0;
  v14 = a2 + a4;
  v16 = a3 + a4;
  if ( v9 )
    v5 = 0;
  if ( v6 < 0 )
    v6 = 0;
  v10 = *((_DWORD *)v4 + 5);
  if ( v7 >= v10 )
  {
    v14 = v10 - 1;
    v7 = v10 - 1;
  }
  v11 = *((_DWORD *)v4 + 6);
  if ( result >= v11 )
  {
    v16 = v11 - 1;
    result = v11 - 1;
  }
  for ( i = v6; i <= result; ++i )
  {
    if ( v5 <= v7 )
    {
      v12 = 24 * v5;
      v13 = v7 - v5 + 1;
      do
      {
        sub_5418A0(v12 + *(_DWORD *)(*((_DWORD *)v4 + 13) + 4 * i));
        v12 += 24;
        --v13;
      }
      while ( v13 );
      v7 = v14;
      result = v16;
    }
  }
  return result;
}

//----- (0053C720) --------------------------------------------------------
int __thiscall sub_53C720(void *this, int a2, int a3)
{
  int v3; // edi@1
  int v4; // esi@1
  signed int v5; // edx@1
  signed int v6; // eax@1
  int v7; // ecx@1
  int v8; // ecx@1
  int v9; // eax@1
  int v10; // edx@1
  int v11; // eax@1
  int v12; // ebx@1
  int v13; // ebp@1
  int v14; // edx@1
  int v15; // eax@4
  int v16; // eax@11
  float v17; // ebp@11
  unsigned int v19; // [sp+44h] [bp-40h]@1
  int v20; // [sp+48h] [bp-3Ch]@1
  float v21; // [sp+4Ch] [bp-38h]@7
  float v22; // [sp+50h] [bp-34h]@7
  int v23; // [sp+54h] [bp-30h]@1
  int v24; // [sp+58h] [bp-2Ch]@1
  int v25; // [sp+5Ch] [bp-28h]@1
  int v26; // [sp+60h] [bp-24h]@7
  char v27; // [sp+64h] [bp-20h]@1
  int v28; // [sp+68h] [bp-1Ch]@1
  char v29; // [sp+6Ch] [bp-18h]@1

  v3 = a2;
  v4 = (int)this;
  v25 = *(_DWORD *)(a2 + 52);
  v5 = (signed int)(10 * v25 + ((unsigned __int64)(-18407002690i64 * v25) >> 32)) >> 3;
  v24 = ((unsigned int)v5 >> 31) + v5;
  sub_541740((int)&v29);
  sub_53C340(v4, (int)&v29, -1i64, -1, -1);
  v6 = *(_DWORD *)(v3 + 28);
  v7 = v6 < -1;
  LOBYTE(v7) = v6 <= -1;
  v8 = v6 & (v7 - 1);
  v9 = *(_DWORD *)(v4 + 56);
  v10 = *(_DWORD *)(v9 + 76);
  v11 = *(_DWORD *)(v9 + 96);
  v12 = *(_DWORD *)(v10 + 4 * v8);
  v13 = *(_DWORD *)(*(_DWORD *)(v12 + 116) + 4 * *(_DWORD *)v3);
  v14 = *(_WORD *)(v13 + 110);
  v20 = *(_DWORD *)(*(_DWORD *)(v12 + 116) + 4 * *(_DWORD *)v3);
  *(_DWORD *)(v4 + 7240) = constructor_408EE0(
                             *(_DWORD *)(*(_DWORD *)(v4 + 12) + 41588),
                             *(const void **)(v11 + 4 * v14),
                             0x2Au,
                             (int)&v28);
  v23 = *(_DWORD *)(v3 + 20);
  while ( sub_541820((int)&v29, (int)&v19, (int)&a2, (int)&v27) )
  {
    if ( v23 <= 0 )
      break;
    if ( sub_53D710(v4, v19, a2, v25, v24) )
    {
      v15 = *(_DWORD *)(v3 + 4);
      if ( v15 < 0 || (v13 = v20, *(_BYTE *)(32 * v19 + *(_DWORD *)(*(_DWORD *)(v4 + 16) + 4 * a2) + 5) == v15) )
      {
        if ( !sub_53C500(v4, v3, v19, a2) )
        {
          v21 = (double)(signed int)v19;
          v22 = (double)a2;
          v26 = (signed __int16)(signed __int64)*(float *)(v13 + 52);
          if ( *(float *)(v13 + 52) - (double)v26 > 0.0 )
            v21 = v21 + 0.5;
          v26 = (signed __int16)(signed __int64)*(float *)(v13 + 56);
          if ( *(float *)(v13 + 56) - (double)v26 > 0.0 )
            v22 = v22 + 0.5;
          v16 = *(_DWORD *)v13;
          v17 = v22;
          if ( !(unsigned __int8)(*(int (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD, signed int, signed int, signed int, _DWORD, signed int, _DWORD, signed int))(v16 + 36))(
                                   v20,
                                   v12,
                                   LODWORD(v21),
                                   LODWORD(v22),
                                   0,
                                   0,
                                   1,
                                   1,
                                   1,
                                   0,
                                   1,
                                   0,
                                   1) )
          {
            sub_53C680((void *)v4, v19, a2, *(_DWORD *)(v3 + 44));
            sub_53C680((void *)v4, v19, a2, *(_DWORD *)(v3 + 48));
            if ( *(_BYTE *)(v3 + 8) )
            {
              if ( *(_BYTE *)(v3 + 8) == 1 )
              {
                sub_53D1B0((void *)v4, v3, __PAIR__(a2, v19), v12);
              }
              else
              {
                if ( *(_BYTE *)(v3 + 8) == 2 )
                  sub_53D370((void *)v4, v3, v19, a2, v12);
              }
            }
            else
            {
              (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD, signed int))(*(_DWORD *)v12 + 172))(
                v12,
                *(_DWORD *)v3,
                LODWORD(v21),
                LODWORD(v17),
                0,
                1);
            }
            sub_53C560(v4, v19, a2, *(_DWORD *)(v3 + 44), 0, *(_DWORD *)v3);
            --v23;
          }
          v13 = v20;
        }
      }
    }
  }
  return sub_541770((int)&v29);
}

//----- (0053C9D0) --------------------------------------------------------
int __thiscall sub_53C9D0(void *this, int a2)
{
  int v2; // edi@1
  int v3; // esi@1
  signed int v4; // edx@1
  signed int v5; // eax@1
  int v6; // ecx@1
  int v7; // ecx@1
  int v8; // eax@1
  int v9; // ebx@1
  int v10; // ebp@1
  unsigned int v12; // [sp+44h] [bp-3Ch]@1
  float v13; // [sp+48h] [bp-38h]@6
  float v14; // [sp+4Ch] [bp-34h]@6
  int v15; // [sp+50h] [bp-30h]@1
  int v16; // [sp+54h] [bp-2Ch]@1
  int v17; // [sp+58h] [bp-28h]@1
  int v18; // [sp+5Ch] [bp-24h]@6
  char v19; // [sp+60h] [bp-20h]@1
  int v20; // [sp+64h] [bp-1Ch]@1
  char v21; // [sp+68h] [bp-18h]@1

  v2 = a2;
  v3 = (int)this;
  v17 = *(_DWORD *)(a2 + 52);
  v4 = (signed int)(10 * v17 + ((unsigned __int64)(-18407002690i64 * v17) >> 32)) >> 3;
  v16 = ((unsigned int)v4 >> 31) + v4;
  sub_541740((int)&v21);
  sub_53C340(v3, (int)&v21, -1i64, -1, -1);
  v5 = *(_DWORD *)(v2 + 28);
  v6 = v5 < -1;
  LOBYTE(v6) = v5 <= -1;
  v7 = v5 & (v6 - 1);
  v8 = *(_DWORD *)(v3 + 56);
  v9 = *(_DWORD *)(*(_DWORD *)(v8 + 76) + 4 * v7);
  v10 = *(_DWORD *)(*(_DWORD *)(v9 + 116) + 4 * *(_DWORD *)v2);
  *(_DWORD *)(v3 + 7240) = constructor_408EE0(
                             *(_DWORD *)(*(_DWORD *)(v3 + 12) + 41588),
                             *(const void **)(*(_DWORD *)(v8 + 96) + 4 * *(_WORD *)(v10 + 110)),
                             0x2Au,
                             (int)&v20);
  v15 = *(_DWORD *)(v2 + 20);
  while ( sub_541820((int)&v21, (int)&v12, (int)&a2, (int)&v19) )
  {
    if ( v15 <= 0 )
      break;
    if ( sub_53D710(v3, v12, a2, v17, v16)
      && (*(_DWORD *)(v2 + 4) < 0
       || *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v3 + 16) + 4 * a2) + 32 * v12 + 5) == *(_DWORD *)(v2 + 4)) )
    {
      v14 = (double)(signed int)v12;
      v13 = (double)a2;
      v18 = (signed __int16)(signed __int64)*(float *)(v10 + 52);
      if ( *(float *)(v10 + 52) - (double)v18 > 0.0 )
        v14 = v14 + 0.5;
      v18 = (signed __int16)(signed __int64)*(float *)(v10 + 56);
      if ( *(float *)(v10 + 56) - (double)v18 > 0.0 )
        v13 = v13 + 0.5;
      if ( !(unsigned __int8)(*(int (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD, signed int, signed int, signed int, _DWORD, signed int, _DWORD, signed int))(*(_DWORD *)v10 + 36))(
                               v10,
                               v9,
                               LODWORD(v14),
                               LODWORD(v13),
                               0,
                               0,
                               1,
                               1,
                               1,
                               0,
                               1,
                               0,
                               1) )
      {
        sub_53C680((void *)v3, v12, a2, *(_DWORD *)(v2 + 44));
        sub_53C680((void *)v3, v12, a2, *(_DWORD *)(v2 + 48));
        if ( *(_BYTE *)(v2 + 8) )
        {
          if ( *(_BYTE *)(v2 + 8) == 1 )
          {
            sub_53D1B0((void *)v3, v2, __PAIR__(a2, v12), v9);
          }
          else
          {
            if ( *(_BYTE *)(v2 + 8) == 2 )
              sub_53D370((void *)v3, v2, v12, a2, v9);
          }
        }
        else
        {
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD, signed int))(*(_DWORD *)v9 + 172))(
            v9,
            *(_DWORD *)v2,
            LODWORD(v14),
            LODWORD(v13),
            0,
            1);
        }
        sub_53C560(v3, v12, a2, *(_DWORD *)(v2 + 44), 0, *(_DWORD *)v2);
        --v15;
      }
    }
  }
  return sub_541770((int)&v21);
}

//----- (0053CC60) --------------------------------------------------------
char __thiscall sub_53CC60(int this, int a2, __int64 a3, int a4, int a5, int a6)
{
  int v6; // ebp@1
  int v7; // eax@5
  int v8; // eax@7
  signed int v9; // eax@9
  int v10; // ecx@9
  int v11; // eax@12
  int v12; // eax@18
  char result; // al@19
  int v14; // eax@22
  char v15; // al@22
  int v16; // ecx@22
  int v17; // eax@22
  int v18; // esi@23
  char v19; // al@29
  int v20; // eax@31
  int v21; // edx@31
  int v22; // ecx@31
  int v23; // edi@38
  signed int v24; // edi@48
  char v25; // [sp+45h] [bp-101h]@12
  unsigned int v26; // [sp+46h] [bp-100h]@26
  unsigned int v27; // [sp+4Ah] [bp-FCh]@26
  int v28; // [sp+4Eh] [bp-F8h]@12
  char v29; // [sp+55h] [bp-F1h]@22
  float v30; // [sp+56h] [bp-F0h]@38
  int v31; // [sp+5Ah] [bp-ECh]@22
  int v32; // [sp+5Eh] [bp-E8h]@1
  int v33; // [sp+62h] [bp-E4h]@38
  int v34; // [sp+66h] [bp-E0h]@1
  int v35; // [sp+6Ah] [bp-DCh]@1
  int v36; // [sp+6Eh] [bp-D8h]@1
  char v37; // [sp+72h] [bp-D4h]@26
  int v38; // [sp+76h] [bp-D0h]@1
  int v39; // [sp+7Ah] [bp-CCh]@18
  int v40; // [sp+7Eh] [bp-C8h]@1
  char v41; // [sp+82h] [bp-C4h]@9
  int v42; // [sp+92h] [bp-B4h]@58
  int v43; // [sp+9Ah] [bp-ACh]@22
  int v44[42]; // [sp+9Eh] [bp-A8h]@22

  v6 = this;
  v38 = *(_DWORD *)(a2 + 52);
  v40 = 10 * v38 / 14;
  v32 = a3 + a4;
  v35 = a3 - a4;
  v34 = HIDWORD(a3) - a4;
  v36 = a4 + HIDWORD(a3);
  if ( (signed int)a3 - a4 < 0 )
    v35 = 0;
  if ( HIDWORD(a3) - a4 < 0 )
    v34 = 0;
  v7 = *(_DWORD *)(this + 20);
  if ( v32 >= v7 )
    v32 = v7 - 1;
  v8 = *(_DWORD *)(this + 24);
  if ( a4 + HIDWORD(a3) >= v8 )
    v36 = v8 - 1;
  sub_541740((int)&v41);
  sub_53C340(v6, (int)&v41, a3, a4, a5);
  v9 = *(_DWORD *)(a2 + 28);
  v10 = 0;
  if ( v9 > -1 || (v9 = *(_DWORD *)(16 * a6 + v6 + 5620 /* ->something_dp */), v9 > 0) )
    v10 = v9;
  v25 = 0;
  v11 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)(v6 + 56) + 76) + 4 * v10);
  v28 = v11;
  if ( *(_BYTE *)(v11 + 349) == 16 && *(_DWORD *)a2 == 448 )
  {
    *(_DWORD *)a2 = 751;
    v25 = 1;
  }
  if ( *(_BYTE *)(v11 + 349) == 15 && *(_DWORD *)a2 == 448 )
  {
    *(_DWORD *)a2 = 751;
    v25 = 1;
  }
  v12 = *(_DWORD *)(*(_DWORD *)(v11 + 116) + 4 * *(_DWORD *)a2);
  v39 = v12;
  if ( !v12 )
    return sub_541770((int)&v41);
  if ( *(_WORD *)(v12 + 22) == 27 )
  {
    sub_53D870(v6, a2, a4, a5, v10);
    *(_DWORD *)(v6 + 7240) = 0;
    return sub_541770((int)&v41);
  }
  memcpy(v44, *(const void **)(*(_DWORD *)(*(_DWORD *)(v6 + 56) + 96) + 4 * *(_WORD *)(v12 + 110)), sizeof(v44));
  v44[*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v6 + 16) + 4 * HIDWORD(a3)) + 32 * a3 + 5)] = 1.0f;
  v14 = constructor_408EE0(*(_DWORD *)(*(_DWORD *)(v6 + 12) + 41588), v44, 0x2Au, (int)&v43);
  *(_DWORD *)(v6 + 7240) = v14;
  v15 = sub_4089A0(v14, a3, SHIDWORD(a3));
  v16 = *(_DWORD *)a2;
  v29 = v15;
  v17 = *(_DWORD *)(a2 + 20);
  v31 = *(_DWORD *)(a2 + 20);
  if ( v16 == 83 )
  {
    v18 = v28;
    if ( v17 == 1 )
      v31 = (signed __int64)*(float *)(*(_DWORD *)(v28 + 168) + 336);
  }
  else
  {
    v18 = v28;
  }
  if ( sub_541820((int)&v41, (int)&v27, (int)&v26, (int)&v37) )
  {
    while ( 1 )
    {
      if ( v31 <= 0 )
        goto LABEL_62;
      if ( !sub_53C500(v6, a2, v27, v26) )
      {
        v19 = sub_4089A0(*(_DWORD *)(v6 + 7240), v27, v26);
        if ( v29 == v19 )
        {
          if ( sub_53D710(v6, v27, v26, v38, v40) )
          {
            v20 = *(_DWORD *)(a2 + 4);
            v21 = v26;
            v22 = v27;
            if ( v20 < 0 )
              goto LABEL_34;
            if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v6 + 16) + 4 * v26) + 32 * v27 + 5) == v20 )
              break;
          }
        }
      }
LABEL_61:
      if ( !sub_541820((int)&v41, (int)&v27, (int)&v26, (int)&v37) )
        goto LABEL_62;
    }
    v22 = v27;
    v21 = v26;
LABEL_34:
    if ( v22 <= v35 || v22 >= v32 || v21 <= v34 || v21 >= v36 )
    {
      v23 = v39;
      *(float *)&v28 = (double)(signed int)v27;
      v30 = (double)(signed int)v26;
      v33 = (signed __int16)(signed __int64)*(float *)(v39 + 52);
      if ( *(float *)(v39 + 52) - (double)v33 > 0.0 )
        *(float *)&v28 = *(float *)&v28 + 0.5;
      v33 = (signed __int16)(signed __int64)*(float *)(v39 + 56);
      if ( *(float *)(v39 + 56) - (double)v33 > 0.0 )
        v30 = v30 + 0.5;
      if ( (unsigned __int8)(*(int (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD, signed int, signed int, signed int, signed int, signed int, _DWORD, signed int))(*(_DWORD *)v39 + 36))(
                              v39,
                              v18,
                              v28,
                              LODWORD(v30),
                              0,
                              0,
                              1,
                              1,
                              1,
                              1,
                              1,
                              0,
                              1) )
      {
        if ( !*(_BYTE *)(a2 + 8) && !v42 && *(_WORD *)(v23 + 16) != 50 )
        {
          sub_53C680((void *)v6, v27, v26, *(_DWORD *)(a2 + 44));
          (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, signed int))(*(_DWORD *)v18 + 172))(
            v18,
            *(_DWORD *)a2,
            v28,
            LODWORD(v30),
            0,
            1);
          sub_53C560(v6, v27, v26, *(_DWORD *)(a2 + 44), 0, *(_DWORD *)a2);
        }
      }
      else
      {
        sub_53C680((void *)v6, v27, v26, *(_DWORD *)(a2 + 44));
        sub_53C680((void *)v6, v27, v26, *(_DWORD *)(a2 + 48));
        if ( *(_BYTE *)(a2 + 8) )
        {
          if ( *(_BYTE *)(a2 + 8) == 1 )
          {
            sub_53D1B0((void *)v6, a2, __PAIR__(v26, v27), v18);
          }
          else
          {
            if ( *(_BYTE *)(a2 + 8) == 2 )
              sub_53D370((void *)v6, a2, v27, v26, v18);
          }
        }
        else
        {
          v24 = *(_DWORD *)a2;
          if ( *(_DWORD *)a2 == 109 && *(float *)(*(_DWORD *)(v18 + 168) + 328) > 0.0 && !_Generic__get_id(v18) )
            v24 = 444;
          if ( *(_DWORD *)a2 == 83 && rand() > 16383 )
            v24 = 293;
          (*(void (__thiscall **)(int, signed int, int, _DWORD, _DWORD, signed int))(*(_DWORD *)v18 + 172))(
            v18,
            v24,
            v28,
            LODWORD(v30),
            0,
            1);
        }
        sub_53C560(v6, v27, v26, *(_DWORD *)(a2 + 44), 0, *(_DWORD *)a2);
        --v31;
      }
    }
    goto LABEL_61;
  }
LABEL_62:
  *(_DWORD *)(v6 + 7240) = 0;
  sub_541770((int)&v41);
  result = v25;
  if ( v25 )
    *(_DWORD *)a2 = 448;
  return result;
}
// 53CC60: using guessed type int var_A8[42];

//----- (0053D1B0) --------------------------------------------------------
int __thiscall sub_53D1B0(void *this, int a2, __int64 a3, int a4)
{
  int v4; // esi@1
  int v5; // ebx@1
  int v6; // ebp@1
  int v7; // esi@7
  int v9; // [sp+44h] [bp-28h]@3
  int v10; // [sp+48h] [bp-24h]@3
  int v11; // [sp+4Ch] [bp-20h]@1
  char v12; // [sp+50h] [bp-1Ch]@3
  char v13; // [sp+54h] [bp-18h]@1
  float v14; // [sp+70h] [bp+4h]@7
  float v15; // [sp+78h] [bp+Ch]@7

  v4 = (int)this;
  v11 = (int)this;
  sub_541740((int)&v13);
  v5 = a2;
  sub_53C340(v4, (int)&v13, a3, 0, *(_DWORD *)(a2 + 24));
  v6 = 2 * *(_DWORD *)(a2 + 16) * rand() / 32767 - *(_DWORD *)(a2 + 16) + *(_DWORD *)(a2 + 12);
  if ( v6 < 1 )
    v6 = 1;
  while ( sub_541820((int)&v13, (int)&v10, (int)&v9, (int)&v12) )
  {
    if ( v6 <= 0 )
      break;
    if ( *(_DWORD *)(v5 + 4) < 0
      || *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v4 + 16) + 4 * v9) + 32 * v10 + 5) == *(_DWORD *)(v5 + 4) )
    {
      v15 = (double)v10;
      v7 = *(_DWORD *)(*(_DWORD *)(a4 + 116) + 4 * *(_DWORD *)v5);
      v14 = (double)v9;
      if ( *(float *)(v7 + 52) - (double)(signed __int16)(signed __int64)*(float *)(v7 + 52) > 0.0 )
        v15 = v15 + 0.5;
      if ( *(float *)(v7 + 56) - (double)(signed __int16)(signed __int64)*(float *)(v7 + 56) > 0.0 )
        v14 = v14 + 0.5;
      if ( !(unsigned __int8)(*(int (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD, signed int, signed int, signed int, _DWORD, signed int, _DWORD, signed int))(*(_DWORD *)v7 + 36))(
                               v7,
                               a4,
                               LODWORD(v15),
                               LODWORD(v14),
                               0,
                               0,
                               1,
                               1,
                               1,
                               0,
                               1,
                               0,
                               1) )
      {
        (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD, signed int))(*(_DWORD *)a4 + 172))(
          a4,
          *(_DWORD *)v5,
          LODWORD(v15),
          LODWORD(v14),
          0,
          1);
        --v6;
      }
      v4 = v11;
    }
  }
  return sub_541770((int)&v13);
}

//----- (0053D370) --------------------------------------------------------
int __thiscall sub_53D370(void *this, int a2, int a3, int a4, int a5)
{
  int v5; // edi@1
  int v6; // eax@1
  int v7; // ebx@1
  int v8; // ecx@1
  int v9; // esi@1
  int v10; // ebp@1
  int v11; // eax@5
  int v12; // eax@7
  int v13; // ebp@9
  int v14; // esi@9
  int v15; // eax@9
  signed int v16; // edx@9
  int v17; // esi@13
  float v18; // STBC_4@18
  int v19; // STE4_4@19
  float v20; // STBC_4@21
  int v21; // STE4_4@22
  float v22; // STC0_4@24
  int v23; // STE4_4@25
  float v24; // STC0_4@27
  int v25; // STE4_4@28
  int v27; // [sp+F8h] [bp-34h]@11
  int v28; // [sp+FCh] [bp-30h]@11
  float v29; // [sp+100h] [bp-2Ch]@13
  float v30; // [sp+104h] [bp-28h]@13
  int v31; // [sp+108h] [bp-24h]@1
  int v32; // [sp+10Ch] [bp-20h]@1
  char v33; // [sp+110h] [bp-1Ch]@11
  int v34; // [sp+114h] [bp-18h]@1
  int v35; // [sp+124h] [bp-8h]@1
  int v36; // [sp+128h] [bp-4h]@1
  int v37; // [sp+134h] [bp+8h]@9
  int v38; // [sp+138h] [bp+Ch]@1

  v35 = 0;
  v36 = 0;
  v5 = (int)this;
  sub_541740((int)&v34);
  sub_541860((int)&v34, *(_DWORD *)(*(_DWORD *)(v5 + 52) + 4 * a4) + 24 * a3);
  v6 = *(_DWORD *)(a2 + 24);
  v7 = a3 - v6;
  v8 = a4 - v6;
  v9 = v6 + a3;
  v10 = v6 + a4;
  v31 = a4 - v6;
  v38 = v6 + a3;
  v32 = v10;
  if ( a3 - v6 < 0 )
    v7 = 0;
  if ( v8 < 0 )
    v31 = 0;
  v11 = *(_DWORD *)(v5 + 20);
  if ( v9 >= v11 )
    v38 = v11 - 1;
  v12 = *(_DWORD *)(v5 + 24);
  if ( v10 >= v12 )
    v32 = v12 - 1;
  v13 = *(_DWORD *)(a2 + 12);
  v14 = *(_DWORD *)(a2 + 16);
  v15 = rand();
  v16 = (signed int)(2 * v14 * v15 + ((unsigned __int64)(-2147418109i64 * 2 * v14 * v15) >> 32)) >> 14;
  v37 = ((unsigned int)v16 >> 31) + v16 - v14 + v13;
  if ( v37 < 1 )
    v37 = 1;
  while ( sub_541820((int)&v34, (int)&v28, (int)&v27, (int)&v33) )
  {
    if ( v37 <= 0 )
      break;
    v17 = *(_DWORD *)(*(_DWORD *)(a5 + 116) + 4 * *(_DWORD *)a2);
    v30 = (double)v28;
    v29 = (double)v27;
    if ( *(float *)(v17 + 52) - (double)(signed __int16)(signed __int64)*(float *)(v17 + 52) > 0.0 )
      v30 = v30 + 0.5;
    if ( *(float *)(v17 + 56) - (double)(signed __int16)(signed __int64)*(float *)(v17 + 56) > 0.0 )
      v29 = v29 + 0.5;
    (*(void (__thiscall **)(int, float *, float *, _DWORD, signed int))(*(_DWORD *)v17 + 40))(
      v17,
      &v30,
      &v29,
      *(_DWORD *)(v5 + 56),
      1);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD, signed int))(*(_DWORD *)a5 + 172))(
      a5,
      *(_DWORD *)a2,
      LODWORD(v30),
      LODWORD(v29),
      0,
      1);
    --v37;
    *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v5 + 44) + 4 * v27) + v28) = 0;
    if ( v28 > v7 )
    {
      v18 = v30 - 1.0;
      if ( !(unsigned __int8)(*(int (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD, signed int, signed int, signed int, _DWORD, signed int, _DWORD, signed int))(*(_DWORD *)v17 + 36))(
                               v17,
                               a5,
                               LODWORD(v18),
                               LODWORD(v29),
                               0,
                               0,
                               1,
                               1,
                               1,
                               0,
                               1,
                               0,
                               1) )
      {
        *(float *)&v19 = (double)rand();
        sub_541790(v5, (int)&v34, v28 - 1, v27, 0, v19);
      }
    }
    if ( v28 < v38 )
    {
      v20 = v30 + 1.0;
      if ( !(unsigned __int8)(*(int (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD, signed int, signed int, signed int, _DWORD, signed int, _DWORD, signed int))(*(_DWORD *)v17 + 36))(
                               v17,
                               a5,
                               LODWORD(v20),
                               LODWORD(v29),
                               0,
                               0,
                               1,
                               1,
                               1,
                               0,
                               1,
                               0,
                               1) )
      {
        *(float *)&v21 = (double)rand();
        sub_541790(v5, (int)&v34, v28 + 1, v27, 0, v21);
      }
    }
    if ( v27 > v31 )
    {
      v22 = v29 - 1.0;
      if ( !(unsigned __int8)(*(int (__thiscall **)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)v17 + 36))(
                               v17,
                               a5,
                               LODWORD(v30),
                               LODWORD(v22),
                               0,
                               0,
                               1,
                               1,
                               1,
                               0,
                               1,
                               0,
                               1) )
      {
        *(float *)&v23 = (double)rand();
        sub_541790(v5, (int)&v34, v28, v27 - 1, 0, v23);
      }
    }
    if ( v27 < v32 )
    {
      v24 = v29 + 1.0;
      if ( !(unsigned __int8)(*(int (__thiscall **)(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)v17 + 36))(
                               v17,
                               a5,
                               LODWORD(v30),
                               LODWORD(v24),
                               0,
                               0,
                               1,
                               1,
                               1,
                               0,
                               1,
                               0,
                               1) )
      {
        *(float *)&v25 = (double)rand();
        sub_541790(v5, (int)&v34, v28, v27 + 1, 0, v25);
      }
    }
  }
  return sub_541770((int)&v34);
}

//----- (0053D710) --------------------------------------------------------
bool __thiscall sub_53D710(int this, int a2, int a3, int a4, int a5)
{
  int v5; // esi@1
  int v6; // ebp@4
  int v7; // edi@4
  char v8; // bl@4
  int v10; // [sp+14h] [bp+4h]@5
  int v11; // [sp+18h] [bp+8h]@7
  int v12; // [sp+20h] [bp+10h]@9

  v5 = this;
  return !*(_DWORD *)(this + 7240)
      || a4 <= 0
      || a5 < 0
      || (v6 = a3, v7 = a2, v8 = sub_53D820(this, a2, a3), sub_53D820(v5, a2, a3 - a4) == v8)
      && (v10 = a3 - a5, sub_53D820(v5, v7 + a5, a3 - a5) == v8)
      && sub_53D820(v5, v7 + a4, a3) == v8
      && (v11 = a5 + a3, sub_53D820(v5, v7 + a5, a5 + v6) == v8)
      && sub_53D820(v5, v7, a4 + v6) == v8
      && (v12 = v7 - a5, sub_53D820(v5, v12, v11) == v8)
      && sub_53D820(v5, v7 - a4, v6) == v8
      && sub_53D820(v5, v12, v10) == v8;
}

//----- (0053D820) --------------------------------------------------------
char __thiscall sub_53D820(int this, int a2, int a3)
{
  int v3; // edx@1
  int v4; // eax@5
  char result; // al@6

  v3 = a2;
  if ( a2 >= 0 )
  {
    if ( a2 > *(_DWORD *)(this + 28) )
      v3 = *(_DWORD *)(this + 28);
  }
  else
  {
    v3 = 0;
  }
  v4 = a3;
  if ( a3 >= 0 )
  {
    if ( a3 > *(_DWORD *)(this + 32) )
      v4 = *(_DWORD *)(this + 32);
    result = sub_4089A0(*(_DWORD *)(this + 7240), v3, v4);
  }
  else
  {
    result = sub_4089A0(*(_DWORD *)(this + 7240), v3, 0);
  }
  return result;
}

//----- (0053D870) --------------------------------------------------------
char __thiscall sub_53D870(int this, int a2, int a3, int a4, int a5)
{
  int v5; // esi@1
  int v6; // eax@1
  int v7; // eax@2
  int v8; // ecx@3
  signed int v9; // eax@3
  int v10; // esi@3
  int v11; // edi@5
  int v12; // esi@7
  signed int v13; // edx@7
  int v14; // ebx@7
  signed int v15; // ebp@7
  int v16; // eax@7
  int v17; // ecx@7
  signed int v18; // eax@15
  signed int v19; // ecx@15
  char *v20; // edx@22
  unsigned __int8 v21; // al@22
  int v22; // esi@23
  int v23; // ebp@23
  signed int v24; // ebx@23
  float v25; // ST08_4@28
  float v26; // ST04_4@28
  char v27; // cl@29
  char v29; // [sp+20h] [bp-10h]@1
  char v30; // [sp+21h] [bp-Fh]@1
  char v31; // [sp+22h] [bp-Eh]@1
  char v32; // [sp+23h] [bp-Dh]@1
  float v33; // [sp+24h] [bp-Ch]@15
  int v34; // [sp+28h] [bp-8h]@3
  int v35; // [sp+2Ch] [bp-4h]@7
  signed int v36; // [sp+38h] [bp+8h]@7
  float v37; // [sp+38h] [bp+8h]@15
  signed int v38; // [sp+3Ch] [bp+Ch]@7

  v5 = this;
  v29 = 0;
  v6 = *(_DWORD *)(this + 7248);
  v30 = 0;
  v31 = 0;
  v32 = 0;
  if ( !v6 )
  {
    v7 = sub_57EE00(
           *(_DWORD *)(this + 7244),
           *(_DWORD *)(*(_DWORD *)(**(_DWORD **)(*(_DWORD *)(this + 56) + 76) + 116) + 332));
    *(_DWORD *)(v5 + 7248) = sub_57D010(v7, a3, a4, 1);
  }
  v8 = *(_DWORD *)(v5 + 56);
  LOBYTE(v9) = a5;
  v10 = *(_DWORD *)(v5 + 7248);
  v34 = *(_DWORD *)(*(_DWORD *)(v8 + 76) + 4 * a5);
  if ( v10 )
  {
    if ( a5 > 0 )
    {
      v11 = *(_DWORD *)(v10 + 8 * a5 + 4);
      if ( v11 )
      {
        while ( 1 )
        {
          LOBYTE(v9) = *(_BYTE *)(v11 + 4);
          if ( (_BYTE)v9 )
            break;
LABEL_37:
          v11 = *(_DWORD *)(v11 + 24);
          if ( !v11 )
            return v9;
        }
        v12 = *(_DWORD *)(v11 + 8);
        v13 = *(_DWORD *)(v11 + 12);
        v14 = *(_DWORD *)(v11 + 16);
        v15 = *(_DWORD *)(v11 + 20);
        v16 = *(_DWORD *)(v11 + 8) - v14;
        v17 = *(_DWORD *)(v11 + 12) - v15;
        v36 = *(_DWORD *)(v11 + 8);
        v35 = *(_DWORD *)(v11 + 8);
        v38 = v13;
        if ( v16 < 0 )
          v16 = -v16;
        if ( v17 < 0 )
          v17 = -v17;
        if ( v16 <= v17 )
          v16 = v17;
        if ( v16 < 4 )
          goto LABEL_24;
        if ( v13 > v15 )
        {
          v18 = 0;
          v19 = 667;
          v33 = (double)v36 + 2.0;
          v37 = (double)v13 - 1.0;
          goto LABEL_22;
        }
        if ( v12 >= v14 )
          goto LABEL_41;
        if ( v13 < v15 )
        {
          v18 = 1;
          v19 = 659;
          v33 = (double)v36 + 2.0;
          v37 = (double)v13 + 2.0;
          goto LABEL_22;
        }
        if ( v12 >= v14 )
        {
LABEL_41:
          v18 = 3;
          v19 = 88;
          v33 = (double)v36 + 0.5;
          v37 = (double)v13 + 2.0;
        }
        else
        {
          v18 = 2;
          v19 = 64;
          v33 = (double)v36 + 2.0;
          v37 = (double)v13 + 0.5;
        }
LABEL_22:
        v20 = &v29 + v18;
        v21 = *(&v29 + v18);
        if ( v21 < 2u )
        {
          v22 = v34;
          *v20 = v21 + 1;
          (*(void (__thiscall **)(int, signed int, _DWORD, _DWORD, _DWORD, signed int))(*(_DWORD *)v22 + 172))(
            v22,
            v19,
            LODWORD(v33),
            LODWORD(v37),
            0,
            1);
          v23 = v35;
          v24 = 4;
          goto LABEL_26;
        }
LABEL_24:
        v22 = v34;
        v23 = v35;
        v24 = 0;
        while ( 1 )
        {
LABEL_26:
          while ( 1 )
          {
            if ( v24 <= 0 )
            {
              v25 = (double)v38 + 0.5;
              v26 = (double)v35 + 0.5;
              (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD, signed int))(*(_DWORD *)v22 + 172))(
                v22,
                *(_DWORD *)a2,
                LODWORD(v26),
                LODWORD(v25),
                0,
                1);
            }
            else
            {
              --v24;
            }
            v27 = 0;
            if ( v23 < *(_DWORD *)(v11 + 16) )
            {
              ++v23;
              v27 = 1;
              v35 = v23;
            }
            v9 = *(_DWORD *)(v11 + 20);
            if ( *(_DWORD *)(v11 + 12) > v9 )
              break;
            if ( v38 >= v9 )
            {
LABEL_36:
              if ( !v27 )
                goto LABEL_37;
              v22 = v34;
            }
            else
            {
              ++v38;
            }
          }
          if ( v38 <= v9 )
            goto LABEL_36;
          --v38;
        }
      }
    }
  }
  return v9;
}

//----- (0053DAD0) --------------------------------------------------------
int __thiscall RGE_RMM_Land_Generator__constructor(int this, int a2, int a3, const void *a4)
{
  int v4; // ebx@1
  int result; // eax@2

  v4 = this;
  _RGE_Random_Map_Module(this, a2, a3, 1);
  *(_DWORD *)v4 = &off_640714;
  *(_DWORD *)(v4 + 36) = 1.0f;
  if ( a4 )
  {
    result = v4;
    memcpy((void *)(v4 + 56), a4, 0x1438u);
  }
  else
  {
    *(_DWORD *)(v4 + 5204) = 0;
    *(_BYTE *)(v4 + 5208) = 0;
    result = v4;
  }
  return result;
}
// 640714: using guessed type int (__thiscall *off_640714)(void *Memory, char);

//----- (0053DB30) --------------------------------------------------------
char __thiscall sub_53DB30(int this)
{
  int v1; // esi@1
  void *v2; // edi@1
  int v3; // edx@1
  int v4; // eax@1
  int v5; // edi@1
  int i; // ecx@1
  int v7; // eax@4

  v1 = this;
  sub_5418D0(this);
  v2 = *(void **)(v1 + 40);
  v3 = *(_DWORD *)(v1 + 24) * *(_DWORD *)(v1 + 20);
  v4 = -16843010;
  memset(v2, -16843010, 4 * ((unsigned int)v3 >> 2));
  v5 = (int)((char *)v2 + 4 * ((unsigned int)v3 >> 2));
  for ( i = v3 & 3; i; --i )
    *(_BYTE *)v5++ = -2;
  LOBYTE(v4) = *(_BYTE *)(v1 + 5208);
  LOWORD(i) = *(_WORD *)(v1 + 24) - 1;
  LOWORD(v3) = *(_WORD *)(v1 + 20) - 1;
  sub_585230(*(void **)(v1 + 12), 0, 0, 0, 0, v3, i, v4, 1, 0);
  sub_53DEA0(v1);
  LOBYTE(v7) = *(_BYTE *)(v1 + 5208);
  sub_581DD0(v7, *(_DWORD *)(v1 + 12), 0, 0, *(_DWORD *)(v1 + 20), *(_DWORD *)(v1 + 24), *(_BYTE *)(v1 + 5208));
  return 1;
}

//----- (0053DBB0) --------------------------------------------------------
char __thiscall sub_53DBB0(void *this, int a2, unsigned __int8 a3, int a4, int a5)
{
  int v5; // esi@1
  int v6; // ebp@1
  signed int v7; // eax@1
  int v8; // ebx@1
  int v9; // ecx@1
  signed __int64 v10; // qax@1
  int v11; // edx@5
  char result; // al@6
  int v13; // edi@9
  int v14; // esi@9
  int v15; // ebp@9
  int i; // eax@17
  unsigned __int8 v17; // cl@24
  int v18; // [sp+10h] [bp-2Ch]@1
  void *v19; // [sp+14h] [bp-28h]@1
  int v20; // [sp+18h] [bp-24h]@5
  int v21; // [sp+1Ch] [bp-20h]@1
  int v22; // [sp+20h] [bp-1Ch]@1
  int v23; // [sp+24h] [bp-18h]@1
  int v24; // [sp+28h] [bp-14h]@1
  int v25; // [sp+2Ch] [bp-10h]@1
  int v26; // [sp+30h] [bp-Ch]@1
  int v27; // [sp+34h] [bp-8h]@9
  int v28; // [sp+38h] [bp-4h]@9
  char v29; // [sp+44h] [bp+8h]@5
  int v30; // [sp+48h] [bp+Ch]@1
  int v31; // [sp+4Ch] [bp+10h]@10

  v5 = a4;
  v19 = this;
  v18 = 0;
  v6 = (int)((char *)this + 52 * a3);
  v7 = *(_DWORD *)(v6 + 76);
  v25 = a4 - v7;
  v8 = a5 - v7;
  v26 = v7 + a4;
  v30 = a5 + v7;
  v10 = (signed __int64)((double)v7 * 0.666666);
  v9 = a5 - 2;
  v23 = v5 - 2;
  v24 = v5 + 2;
  HIDWORD(v10) = a5 + 2;
  v21 = a5 - 2;
  v22 = a5 + 2;
  if ( v8 < a5 - 2 )
    v9 = v8;
  if ( v30 > SHIDWORD(v10) )
    HIDWORD(v10) = v30;
  v20 = HIDWORD(v10);
  v29 = *(_BYTE *)(v6 + 80);
  v11 = *((_DWORD *)v19 + 11);
  if ( *(_BYTE *)(v5 + *(_DWORD *)(v11 + 4 * a5)) == -2 )
  {
    if ( (signed int)v10 < 2 )
      LODWORD(v10) = 2;
    v28 = v10 + a5;
    v13 = v5 - v10;
    v14 = v10 + v5;
    v27 = a5 - v10;
    v15 = v9;
    if ( v9 <= v20 )
    {
      v31 = v11 + 4 * v9;
      do
      {
        if ( v15 >= 0 )
        {
          if ( v15 < *((_DWORD *)v19 + 6) )
          {
            for ( i = v13; i <= v14; ++i )
            {
              if ( i >= 0 )
              {
                if ( i < *((_DWORD *)v19 + 5) )
                {
                  v17 = *(_BYTE *)(*(_DWORD *)v31 + i);
                  if ( v17 == v29 )
                  {
                    if ( v15 >= v21 && v15 <= v22 && i >= v23 && i <= v24 )
                      ++v18;
                  }
                  else
                  {
                    if ( v17 < 0xFEu && i >= v25 && i <= v26 && v15 >= v8 && v15 <= v30 )
                      goto LABEL_6;
                  }
                }
                else
                {
                  if ( i < v24 - 1 )
                    ++v18;
                }
              }
              else
              {
                if ( i > v23 + 1 )
                  ++v18;
              }
            }
          }
          else
          {
            if ( v15 < v22 - 1 )
              v18 += 3;
          }
        }
        else
        {
          if ( v15 > v21 + 1 )
            v18 += 3;
        }
        if ( v15 < v27 )
        {
          --v13;
          ++v14;
        }
        if ( v15 > v28 )
        {
          --v13;
          ++v14;
        }
        ++v15;
        v31 += 4;
      }
      while ( v15 <= v20 );
    }
    result = v18;
  }
  else
  {
LABEL_6:
    result = 0;
  }
  return result;
}

//----- (0053DD90) --------------------------------------------------------
char __thiscall sub_53DD90(void *this, int a2, int a3, int a4)
{
  int v4; // ebp@2
  int v5; // edi@2
  int v6; // ecx@2
  int v7; // esi@2
  int v8; // eax@4
  int v9; // esi@5
  int v10; // edx@7
  int v11; // ebp@7
  int v12; // edx@8
  int v13; // ebx@10
  int v14; // ecx@10
  int v15; // esi@13
  int v16; // esi@15
  int v17; // ecx@15
  int v18; // eax@23
  void *v20; // [sp+0h] [bp-8h]@1
  unsigned __int8 v21; // [sp+4h] [bp-4h]@1
  int v22; // [sp+14h] [bp+Ch]@2

  v20 = this;
  v21 = *((_BYTE *)this + 4 * (a4 + 4 * (3 * a4 + 6) + 2));
  if ( v21 )
  {
    v4 = *((_DWORD *)this + 13 * a4 + 22);
    v5 = (int)((char *)this + 52 * a4);
    v6 = *(_DWORD *)(v5 + 96);
    v7 = v4 - a2;
    v22 = v4 - a2;
    if ( v4 - a2 <= a2 - v6 )
      v22 = a2 - v6;
    v8 = (v6 - v4) / 4;
    if ( v4 <= v8 )
      v9 = v4 + v7;
    else
      v9 = v8 + v7;
    v10 = *((_DWORD *)v20 + 5);
    v11 = *((_DWORD *)v20 + 5) - v8;
    if ( v6 >= v11 )
      v12 = v10 - v6;
    else
      v12 = v10 - v11;
    v13 = v12 + a2 - v6;
    v14 = v9;
    if ( v9 <= v13 )
      v14 = v13;
    if ( v14 <= 0 )
    {
      v16 = *(_DWORD *)(v5 + 92) - a3;
      v17 = a3 - *(_DWORD *)(v5 + 100);
    }
    else
    {
      v15 = *(_DWORD *)(v5 + 92);
      if ( v14 > (*(_DWORD *)(v5 + 100) - v15) / 3 )
        v14 = (*(_DWORD *)(v5 + 100) - v15) / 3;
      v16 = v14 + v15 - a3;
      v17 = a3 + v14 - *(_DWORD *)(v5 + 100);
    }
    if ( v16 <= v17 )
      v16 = v17;
    if ( v22 < 0 )
      v22 = 0;
    if ( v16 < 0 )
      v16 = 0;
    v18 = v21 * (v16 + v22);
    if ( v18 >= 100 )
      LOBYTE(v18) = 101;
  }
  else
  {
    LOBYTE(v18) = 0;
  }
  return v18;
}

//----- (0053DEA0) --------------------------------------------------------
char __thiscall sub_53DEA0(int this)
{
  int v1; // esi@1
  int v2; // ebx@2
  int v3; // edi@4
  int v4; // ebp@4
  int v5; // ecx@4
  int v6; // eax@4
  int v7; // ecx@4
  int v8; // ebx@4
  int v9; // edi@4
  int v10; // ebp@4
  int v11; // eax@8
  int v12; // eax@10
  int v13; // eax@12
  int v14; // eax@20
  bool v15; // zf@20
  bool v16; // sf@20
  unsigned __int8 v17; // of@20
  int v18; // ebx@32
  int v19; // ebp@33
  int v20; // ecx@35
  int v21; // eax@36
  int v22; // ebp@36
  int v23; // ebx@37
  int v24; // edi@37
  int v25; // ebp@41
  int v26; // eax@43
  int v27; // ecx@44
  int v28; // ST20_4@45
  int v29; // ST20_4@49
  int v30; // ST20_4@52
  int v31; // ST20_4@55
  int v32; // eax@58
  int v33; // eax@60
  int v34; // ebp@61
  int v35; // edi@61
  char v36; // bl@62
  int v37; // edi@64
  int v38; // edi@68
  int v39; // ecx@74
  int v40; // edi@75
  int v41; // ebx@76
  int v43; // [sp+14h] [bp-B0Ch]@39
  int v44; // [sp+18h] [bp-B08h]@39
  int v45; // [sp+1Ch] [bp-B04h]@12
  int v46; // [sp+20h] [bp-B00h]@1
  int v47; // [sp+24h] [bp-AFCh]@2
  int v48; // [sp+28h] [bp-AF8h]@12
  int i; // [sp+2Ch] [bp-AF4h]@2
  char v50; // [sp+33h] [bp-AEDh]@36
  int v51; // [sp+34h] [bp-AECh]@4
  int v52; // [sp+38h] [bp-AE8h]@18
  int *v53; // [sp+3Ch] [bp-AE4h]@2
  int v54; // [sp+40h] [bp-AE0h]@1
  char v55; // [sp+44h] [bp-ADCh]@39
  int v56; // [sp+48h] [bp-AD8h]@1
  int v57[99]; // [sp+4Ch] [bp-AD4h]@2
  int v58; // [sp+1D8h] [bp-948h]@2

  v1 = this;
  v46 = 0;
  v56 = *(_DWORD *)(this + 20) - 1;
  v54 = *(_DWORD *)(this + 24) - 1;
  if ( *(_DWORD *)(this + 5204) > 0 )
  {
    v2 = this + 72;
    v47 = (int)&v58;
    v53 = v57;
    for ( i = this + 72; ; v2 = i )
    {
      sub_541740(v47);
      v3 = *(_DWORD *)(v2 - 8);
      v4 = *(_DWORD *)(v2 - 4);
      v5 = *(_DWORD *)(v2 - 8);
      *v53 = 0;
      v6 = *(_DWORD *)v2;
      v7 = v5 - *(_DWORD *)v2;
      v8 = v4 - *(_DWORD *)v2;
      v9 = v6 + v3;
      v10 = v6 + v4;
      v51 = v7;
      if ( v7 < 0 )
      {
        v51 = 0;
        v7 = 0;
      }
      if ( v8 < 0 )
        v8 = 0;
      v11 = *(_DWORD *)(v1 + 20);
      if ( v9 >= v11 )
        v9 = v11 - 1;
      v12 = *(_DWORD *)(v1 + 24);
      if ( v10 >= v12 )
        v10 = v12 - 1;
      LOBYTE(v12) = *(_BYTE *)(i - 12);
      sub_585230(*(void **)(v1 + 12), 0, 0, v7, v8, v9, v10, v12, 1, 0);
      v13 = v51;
      v48 = v8;
      LOBYTE(v45) = *(_BYTE *)(i + 8);
      for ( v57[(unsigned __int8)v45] = (v9 - v51 + 1) * (v10 - v8 + 1); v48 <= v10; ++v48 )
      {
        if ( v13 <= v9 )
        {
          do
          {
            ++v13;
            *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v48) + v13 - 1) = v45;
          }
          while ( v13 <= v9 );
          v13 = v51;
        }
      }
      if ( v13 > 0 )
      {
        v52 = v8;
        if ( v8 <= v10 )
        {
          *(float *)&v48 = (double)v46;
          do
          {
            sub_541790(v1, v47, v13 - 1, v52, v48, 0);
            v14 = v52 + 1;
            v52 = v14;
            v17 = __OFSUB__(v14, v10);
            v15 = v14 == v10;
            v16 = v14 - v10 < 0;
            v13 = v51;
          }
          while ( (unsigned __int8)(v16 ^ v17) | v15 );
        }
      }
      if ( v8 > 0 )
      {
        v52 = v13;
        if ( v13 <= v9 )
        {
          *(float *)&v48 = (double)v46;
          do
            sub_541790(v1, v47, v52++, v8 - 1, v48, 0);
          while ( v52 <= v9 );
          v13 = v51;
        }
      }
      if ( v9 < *(_DWORD *)(v1 + 20) - 1 && v8 <= v10 )
      {
        *(float *)&v48 = (double)v46;
        do
          sub_541790(v1, v47, v9 + 1, v8++, v48, 0);
        while ( v8 <= v10 );
        v13 = v51;
      }
      if ( v10 < *(_DWORD *)(v1 + 24) - 1 )
      {
        v18 = v13;
        if ( v13 <= v9 )
        {
          v19 = v10 + 1;
          *(float *)&v48 = (double)v46;
          do
            sub_541790(v1, v47, v18++, v19, v48, 0);
          while ( v18 <= v9 );
        }
      }
      v20 = *(_DWORD *)(v1 + 5204);
      v17 = __OFSUB__(v46 + 1, v20);
      v16 = v46++ + 1 - v20 < 0;
      ++v53;
      i += 52;
      v47 += 24;
      if ( !(v16 ^ v17) )
        break;
    }
  }
  do
  {
    v21 = *(_DWORD *)(v1 + 5204);
    v22 = 0;
    v50 = 1;
    v46 = 0;
    if ( v21 <= 0 )
      break;
    v23 = (int)&v58;
    i = (int)v57;
    v24 = v1 + 84;
    do
    {
      if ( *(_DWORD *)i < *(_DWORD *)(v24 - 28) && sub_541820(v23, (int)&v44, (int)&v43, (int)&v55) )
      {
        v50 = 0;
        LOBYTE(v45) = sub_53DD90((void *)v1, v44, v43, v22);
        v45 = (unsigned __int8)v45;
        if ( (unsigned __int8)v45 > 100 * rand() / 32767 )
        {
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v43) + v44) = -1;
        }
        else
        {
          v45 = 32 * v44 + *(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v43);
          LOBYTE(v47) = *(_BYTE *)(v24 - 24);
          v25 = (unsigned __int8)sub_53DBB0((void *)v1, v47, v22, v44, v43);
          if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v43) + v44) == -2 && v25 > 0 )
          {
            *(_BYTE *)(v45 + 5) = v47;
            *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v43) + v44) = *(_BYTE *)(v24 - 4);
            v26 = v44;
            if ( v44 <= 0 )
            {
              v27 = v43;
            }
            else
            {
              v27 = v43;
              if ( *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v43) + v44 - 1) == -2 )
              {
                v45 = 100 * rand() / 32767 - v25 * *(_DWORD *)v24 + 250;
                *(float *)&v28 = (double)v45;
                sub_541790(v1, v23, v44 - 1, v43, 0, v28);
                v27 = v43;
                v26 = v44;
              }
            }
            if ( v26 < v56 && *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v27) + v26 + 1) == -2 )
            {
              v45 = 100 * rand() / 32767 - v25 * *(_DWORD *)v24 + 250;
              *(float *)&v29 = (double)v45;
              sub_541790(v1, v23, v44 + 1, v43, 0, v29);
              v27 = v43;
              v26 = v44;
            }
            if ( v27 > 0 && *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v27 - 4) + v26) == -2 )
            {
              v45 = 100 * rand() / 32767 - v25 * *(_DWORD *)v24 + 250;
              *(float *)&v30 = (double)v45;
              sub_541790(v1, v23, v44, v43 - 1, 0, v30);
              v27 = v43;
              v26 = v44;
            }
            if ( v27 < v54 && *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v27 + 4) + v26) == -2 )
            {
              v45 = 100 * rand() / 32767 - v25 * *(_DWORD *)v24 + 250;
              *(float *)&v31 = (double)v45;
              sub_541790(v1, v23, v44, v43 + 1, 0, v31);
            }
            ++*(_DWORD *)i;
          }
          v22 = v46;
        }
      }
      v32 = *(_DWORD *)(v1 + 5204);
      ++v22;
      v24 += 52;
      v23 += 24;
      v46 = v22;
      i += 4;
    }
    while ( v22 < v32 );
  }
  while ( !v50 );
  v33 = *(_DWORD *)(v1 + 5204);
  v46 = 0;
  if ( v33 > 0 )
  {
    v34 = (int)&v58;
    v35 = v1 + 80;
    v53 = &v58;
    v45 = v1 + 80;
    do
    {
      v36 = *(_BYTE *)v35;
      LOBYTE(v47) = *(_BYTE *)(v35 - 20);
      if ( sub_541820(v34, (int)&v44, (int)&v43, (int)&v55) )
      {
        do
        {
          if ( v44 >= 1
            && (v37 = v44 + *(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v43), *(_BYTE *)(v37 - 1) == v36)
            && v44 < v56
            && *(_BYTE *)(v37 + 1) == v36
            || v43 >= 1
            && (v38 = *(_DWORD *)(v1 + 44), *(_BYTE *)(v44 + *(_DWORD *)(v38 + 4 * v43 - 4)) == v36)
            && v43 < v54
            && *(_BYTE *)(*(_DWORD *)(v38 + 4 * v43 + 4) + v44) == v36 )
            *(_BYTE *)(32 * v44 + *(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * v43) + 5) = v47;
          v34 = (int)v53;
        }
        while ( sub_541820((int)v53, (int)&v44, (int)&v43, (int)&v55) );
        v35 = v45;
      }
      v39 = *(_DWORD *)(v1 + 5204);
      v35 += 52;
      v34 += 24;
      v17 = __OFSUB__(v46 + 1, v39);
      v16 = v46++ + 1 - v39 < 0;
      v45 = v35;
      v53 = (int *)v34;
    }
    while ( v16 ^ v17 );
  }
  v40 = 0;
  if ( *(_DWORD *)(v1 + 5204) > 0 )
  {
    v41 = (int)&v58;
    do
    {
      sub_541770(v41);
      ++v40;
      v41 += 24;
    }
    while ( v40 < *(_DWORD *)(v1 + 5204) );
  }
  return 1;
}
// 53DEA0: using guessed type int var_AD4[99];

//----- (0053E530) --------------------------------------------------------
int __thiscall RGE_RMM_Elevation_Generator__constructor(int this, int a2, int a3, const void *a4)
{
  int v4; // ebx@1

  v4 = this;
  _RGE_Random_Map_Module(this, a2, a3, 1);
  *(_DWORD *)v4 = &off_6407A8;
  memcpy((void *)(v4 + 56), a4, 0xF80u);
  *(_DWORD *)(v4 + 36) = 1.5f;
  return v4;
}
// 6407A8: using guessed type int (__thiscall *off_6407A8)(void *Memory, char);

//----- (0053E570) --------------------------------------------------------
char __thiscall sub_53E570(int this)
{
  int v1; // ebp@1
  int i; // edx@2
  int v3; // eax@3
  int v4; // ecx@4
  int v5; // ebx@7
  int v6; // eax@9
  int v7; // edx@9
  int v8; // ecx@9
  int v9; // eax@9
  signed int v11; // [sp-18h] [bp-2Ch]@9
  char v12; // [sp-14h] [bp-28h]@9
  signed int v13; // [sp-10h] [bp-24h]@9
  int v14; // [sp-Ch] [bp-20h]@9
  unsigned int v15; // [sp-8h] [bp-1Ch]@9
  char v16; // [sp-4h] [bp-18h]@9
  const void *v17; // [sp+10h] [bp-4h]@8

  v1 = this;
  sub_5418D0(this);
  if ( *(_DWORD *)(v1 + 2432) > 0 )
  {
    for ( i = 0; i < *(_DWORD *)(v1 + 24); ++i )
    {
      v3 = 0;
      if ( *(_DWORD *)(v1 + 20) > 0 )
      {
        v4 = 0;
        do
        {
          ++v3;
          v4 += 32;
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 16) + 4 * i) + v4 - 26) = 0;
        }
        while ( v3 < *(_DWORD *)(v1 + 20) );
      }
    }
  }
  sub_53E840(v1);
  v5 = 0;
  if ( *(_DWORD *)(v1 + 2432) > 0 )
  {
    v17 = (const void *)(v1 + 56);
    do
    {
      memcpy(&v11, v17, 0x18u);
      LOBYTE(v6) = sub_53EA90(v1, v11, v12, v13, v14, v15, v16);
      v7 = *(_DWORD *)(v1 + 20);
      v8 = *(_DWORD *)(v1 + 24) - 1;
      *(_DWORD *)&v16 = 8;
      v15 = v8;
      sub_5818F0(v6, *(_DWORD *)(v1 + 12), 0, 0, v7 - 1, v8, 8);
      v9 = *(_DWORD *)(v1 + 2432);
      ++v5;
      v17 = (char *)v17 + 24;
    }
    while ( v5 < v9 );
  }
  return 1;
}

//----- (0053E620) --------------------------------------------------------
char __thiscall sub_53E620(int this, int a2, int a3, char a4, unsigned __int8 a5, unsigned __int8 a6)
{
  int v6; // esi@1
  int v7; // edx@1
  int v8; // ebx@1
  int v9; // ebp@1
  int v10; // eax@5
  int v11; // eax@7
  int v12; // ecx@9
  int v13; // eax@9
  char v14; // bl@10
  int v15; // ecx@11
  int v16; // eax@12
  char result; // al@18
  int v18; // [sp+14h] [bp+4h]@10
  int v19; // [sp+24h] [bp+14h]@1

  v6 = a2 - a6;
  v7 = a3 - a6;
  v8 = a6 + a3;
  v9 = a6 + a2;
  v19 = a6 + a3;
  if ( v6 < 0 )
    v6 = 0;
  if ( v7 < 0 )
    v7 = 0;
  v10 = *(_DWORD *)(this + 20);
  if ( v9 >= v10 )
    v9 = v10 - 1;
  v11 = *(_DWORD *)(this + 24);
  if ( v8 >= v11 )
    v19 = v11 - 1;
  v12 = *(_DWORD *)(this + 16) + 4 * v7;
  v13 = 32 * v6 + *(_DWORD *)v12;
  if ( v7 > v19 )
  {
LABEL_18:
    result = 1;
  }
  else
  {
    v14 = a4;
    v18 = v12;
    while ( 1 )
    {
      v15 = v6;
      if ( v6 <= v9 )
        break;
LABEL_17:
      ++v7;
      v18 += 4;
      v13 = 32 * v6 + *(_DWORD *)v18;
      if ( v7 > v19 )
        goto LABEL_18;
    }
    v16 = v13 + 6;
    while ( v14 != -1 && *(_BYTE *)(v16 - 1) == v14 && *(_BYTE *)v16 >= a5 )
    {
      v14 = a4;
      ++v15;
      v16 += 32;
      if ( v15 > v9 )
        goto LABEL_17;
    }
    result = 0;
  }
  return result;
}

//----- (0053E6E0) --------------------------------------------------------
char __thiscall sub_53E6E0(int this, char a2, int a3, int a4, int a5, char a6, unsigned __int8 a7)
{
  int v7; // edx@1
  int v8; // ebx@1
  int v9; // edi@1
  int v10; // ebp@2
  int v11; // esi@2
  int v12; // ebx@2
  int v13; // eax@2
  int v14; // edx@6
  int v15; // edx@8
  int v16; // ecx@10
  int v17; // edi@10
  int v18; // edx@10
  int v19; // ecx@10
  int v20; // esi@11
  int v21; // edx@12
  int v22; // edx@18
  int v23; // ebp@20
  int v24; // esi@20
  int v25; // eax@20
  int v26; // edx@20
  int v27; // edi@24
  int v28; // edi@26
  int v29; // edi@28
  int v30; // ecx@28
  int v31; // esi@31
  int v32; // ecx@31
  int v33; // ecx@35
  int v35; // [sp+10h] [bp-Ch]@1
  int v36; // [sp+14h] [bp-8h]@2
  int v37; // [sp+18h] [bp-4h]@1
  int v38; // [sp+2Ch] [bp+10h]@2
  int v39; // [sp+30h] [bp+14h]@29

  v7 = a5;
  v8 = a3;
  v9 = a4;
  v37 = this;
  v35 = 0;
  if ( a5 <= 0 )
    goto LABEL_20;
  v10 = a3 - a5;
  v11 = a4 - a5;
  v12 = a5 + a3;
  v13 = a4 + a5;
  v38 = a5 + a3;
  v36 = a4 + v7;
  if ( v10 < 0 )
    v10 = 0;
  if ( v11 < 0 )
    v11 = 0;
  v14 = *(_DWORD *)(this + 20);
  if ( v12 >= v14 )
    v38 = v14 - 1;
  v15 = *(_DWORD *)(this + 24);
  if ( v13 >= v15 )
  {
    v13 = v15 - 1;
    v36 = v15 - 1;
  }
  v16 = *(_DWORD *)(this + 16);
  v17 = v16 + 4 * v11;
  v18 = 32 * v10 + *(_DWORD *)(v16 + 4 * v11);
  v19 = v11;
  if ( v11 > v13 )
  {
LABEL_19:
    this = v37;
    v9 = a4;
    v8 = a3;
LABEL_20:
    v23 = v8 - 2;
    v24 = v9 - 2;
    v25 = v8 + 2;
    v26 = v9 + 2;
    if ( v8 - 2 < 0 )
      v23 = 0;
    if ( v24 < 0 )
      v24 = 0;
    v27 = *(_DWORD *)(this + 20);
    if ( v25 >= v27 )
      v25 = v27 - 1;
    v28 = *(_DWORD *)(this + 24);
    if ( v26 >= v28 )
      v26 = v28 - 1;
    v29 = *(_DWORD *)(this + 16) + 4 * v24;
    v30 = 32 * v23 + *(_DWORD *)v29;
    if ( v24 <= v26 )
    {
      v39 = v26 - v24 + 1;
      do
      {
        if ( v23 <= v25 )
        {
          v31 = v30 + 6;
          v32 = v25 - v23 + 1;
          do
          {
            if ( *(_BYTE *)v31 == a2 )
              ++v35;
            v31 += 32;
            --v32;
          }
          while ( v32 );
        }
        v33 = *(_DWORD *)(v29 + 4);
        v29 += 4;
        v30 = 32 * v23 + v33;
        --v39;
      }
      while ( v39 );
    }
    return v35;
  }
  while ( 1 )
  {
    v20 = v10;
    if ( v10 <= v38 )
      break;
LABEL_18:
    v22 = *(_DWORD *)(v17 + 4);
    v17 += 4;
    ++v19;
    v18 = 32 * v10 + v22;
    if ( v19 > v13 )
      goto LABEL_19;
  }
  v21 = v18 + 6;
  while ( a6 != -1 && *(_BYTE *)(v21 - 1) == a6 && *(_BYTE *)v21 >= a7 )
  {
    ++v20;
    v21 += 32;
    if ( v20 > v38 )
    {
      v13 = v36;
      goto LABEL_18;
    }
  }
  return 0;
}

//----- (0053E840) --------------------------------------------------------
int __thiscall sub_53E840(int this)
{
  int v1; // ebp@1
  int v2; // ebx@1
  void *v3; // edi@1
  unsigned int v4; // edx@1
  int v5; // edi@1
  int i; // ecx@1
  int result; // eax@4
  int j; // edi@5
  int v9; // esi@7
  int v10; // eax@8
  int v11; // ecx@8
  int v12; // ecx@12
  signed int v13; // [sp+Ch] [bp-Ch]@6
  int v14; // [sp+10h] [bp-8h]@7

  v1 = this;
  v2 = 0;
  v3 = *(void **)(this + 40);
  v4 = *(_DWORD *)(this + 24) * *(_DWORD *)(this + 20);
  memset(v3, 0, 4 * (v4 >> 2));
  v5 = (int)((char *)v3 + 4 * (v4 >> 2));
  for ( i = v4 & 3; i; --i )
    *(_BYTE *)v5++ = 0;
  result = *(_DWORD *)(v1 + 24);
  if ( result > 0 )
  {
    do
    {
      for ( j = 0; j < *(_DWORD *)(v1 + 20); ++j )
      {
        v13 = 0;
        if ( *(_DWORD *)(v1 + 4020) <= 0 )
          goto LABEL_22;
        v9 = v1 + 2440;
        v14 = *(_DWORD *)(v1 + 4020);
        do
        {
          v10 = j - *(_DWORD *)(v9 - 4);
          v11 = v2 - *(_DWORD *)v9;
          if ( v10 < 0 )
            v10 = -v10;
          if ( v11 < 0 )
            v11 = -v11;
          v12 = *(_DWORD *)(v9 + 4) - (unsigned __int64)(signed __int64)sqrt((double)(v10 * v10 + v11 * v11));
          if ( v12 > 0 )
            v13 += v12 * *(_DWORD *)(v9 + 8);
          v9 += 16;
          --v14;
        }
        while ( v14 );
        if ( v13 <= 100 )
LABEL_22:
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v2) + j) = v13;
        else
          *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v1 + 44) + 4 * v2) + j) = 101;
      }
      result = *(_DWORD *)(v1 + 24);
      ++v2;
    }
    while ( v2 < result );
  }
  return result;
}

//----- (0053E940) --------------------------------------------------------
double __stdcall sub_53E940(int a1, int a2, int a3)
{
  return (double)(250 - 15 * a1);
}

//----- (0053E960) --------------------------------------------------------
int __thiscall sub_53E960(void *this, int a2, char a3, char a4)
{
  void *v4; // esi@1
  int v5; // ebx@1
  int v6; // edi@2
  int v7; // ebp@2
  int v8; // eax@4
  int v10; // [sp+8h] [bp-8h]@3
  int i; // [sp+Ch] [bp-4h]@1

  v4 = this;
  v5 = 0;
  for ( i = 0; i < *((_DWORD *)v4 + 6); ++i )
  {
    v6 = 0;
    v7 = 0;
    if ( *((_DWORD *)v4 + 5) > 0 )
    {
      v10 = 0;
      do
      {
        v8 = v5 + *((_DWORD *)v4 + 4);
        if ( *(_BYTE *)(*(_DWORD *)v8 + v6 + 5) == a3
          && *(_BYTE *)(*(_DWORD *)v8 + v6 + 6) == a4
          && !*(_BYTE *)(*(_DWORD *)(*((_DWORD *)v4 + 11) + v5) + v7) )
          sub_541860(a2, v10 + *(_DWORD *)(*((_DWORD *)v4 + 13) + v5));
        ++v7;
        v6 += 32;
        v10 += 24;
      }
      while ( v7 < *((_DWORD *)v4 + 5) );
    }
    v5 += 4;
  }
  return sub_541920(a2);
}

//----- (0053EA10) --------------------------------------------------------
int __thiscall sub_53EA10(int this, int a2, int a3, int a4)
{
  int v4; // ebp@1
  int v5; // ebx@1
  int result; // eax@1
  int v7; // edi@1
  bool v8; // sf@1
  int v9; // ecx@5
  int v10; // esi@9
  int v11; // edi@9
  int v12; // [sp+10h] [bp+4h]@1
  int i; // [sp+18h] [bp+Ch]@7

  v4 = this;
  v5 = a2 - a4;
  result = a3 - a4;
  v7 = a2 + a4;
  v8 = a2 - a4 < 0;
  v12 = a2 + a4;
  if ( v8 )
    v5 = 0;
  if ( result < 0 )
    result = 0;
  v9 = *(_DWORD *)(this + 20);
  if ( v7 >= v9 )
  {
    v12 = v9 - 1;
    v7 = v9 - 1;
  }
  for ( i = result; i <= v7; ++i )
  {
    if ( v5 <= v7 )
    {
      v10 = 24 * v5;
      v11 = v7 - v5 + 1;
      do
      {
        sub_5418A0(v10 + *(_DWORD *)(*(_DWORD *)(v4 + 52) + 4 * i));
        v10 += 24;
        --v11;
      }
      while ( v11 );
      v7 = v12;
    }
    result = i + 1;
  }
  return result;
}

//----- (0053EA90) --------------------------------------------------------
char __thiscall sub_53EA90(int this, signed int a2, char a3, signed int a4, int a5, unsigned int a6, char a7)
{
  int v7; // esi@1
  signed int v8; // ebx@1
  signed int v9; // ebp@1
  int v10; // eax@1
  int v11; // edi@4
  signed int v12; // ebx@6
  int v13; // edi@9
  int v14; // eax@13
  int v15; // ecx@15
  int v16; // ebx@24
  int v17; // edx@27
  int v18; // edi@27
  int v19; // ebp@27
  unsigned int v20; // ebp@28
  int v21; // edi@28
  int v22; // eax@28
  int v23; // eax@32
  signed int v24; // edx@32
  int v25; // ST14_4@32
  int v26; // ST14_4@36
  int v27; // ST14_4@39
  int v28; // ST14_4@42
  int v29; // edi@48
  signed int v30; // ebx@48
  int v32; // [sp+14h] [bp-5E00h]@10
  int v33; // [sp+18h] [bp-5DFCh]@10
  char v34; // [sp+1Fh] [bp-5DF5h]@23
  int v35; // [sp+20h] [bp-5DF4h]@32
  int v36; // [sp+24h] [bp-5DF0h]@1
  float v37; // [sp+28h] [bp-5DECh]@30
  int v38; // [sp+2Ch] [bp-5DE8h]@24
  int v39; // [sp+30h] [bp-5DE4h]@1
  char v40; // [sp+34h] [bp-5DE0h]@10
  int v41; // [sp+38h] [bp-5DDCh]@1
  char v42; // [sp+3Ch] [bp-5DD8h]@6
  int v43; // [sp+54h] [bp-5DC0h]@4

  v7 = this;
  v8 = a4;
  v9 = 0;
  v10 = *(_DWORD *)(this + 20) - 1;
  v36 = 0;
  v41 = v10;
  v39 = *(_DWORD *)(this + 24) - 1;
  if ( a4 > 999 )
  {
    a4 = 999;
    v8 = 999;
  }
  if ( v8 > 0 )
  {
    v11 = (int)&v43;
    do
    {
      sub_541740(v11);
      v11 += 24;
      --v8;
    }
    while ( v8 );
  }
  sub_541740((int)&v42);
  sub_53E960((void *)v7, (int)&v42, a7, a6);
  v12 = (signed int)(signed __int64)sqrt((double)a2 / (double)a4) / 2;
  if ( v12 < 2 )
    v12 = 2;
  if ( a4 > 0 )
  {
    v13 = (int)&v43;
    do
    {
      if ( !sub_541820((int)&v42, (int)&v32, (int)&v33, (int)&v40) )
        break;
      if ( !*(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v7 + 44) + 4 * v33) + v32) && sub_53E620(v7, v32, v33, a7, a6, a5) )
      {
        sub_53EA10(v7, v32, v33, v12);
        *(_BYTE *)(*(_DWORD *)(*(_DWORD *)(v7 + 16) + 4 * v33) + 32 * v32 + 6) = a3;
        v14 = v32;
        if ( v32 > 0 )
        {
          sub_541790(v7, v13, v32 - 1, v33, 0, 0);
          v14 = v32;
        }
        v15 = v33;
        if ( v33 > 0 )
        {
          sub_541790(v7, v13, v14, v33 - 1, 0, 0);
          v15 = v33;
          v14 = v32;
        }
        if ( v14 < *(_DWORD *)(v7 + 20) - 1 )
        {
          sub_541790(v7, v13, v14 + 1, v15, 0, 0);
          v15 = v33;
          v14 = v32;
        }
        if ( v15 < *(_DWORD *)(v7 + 24) - 1 )
          sub_541790(v7, v13, v14, v15 + 1, 0, 0);
        ++v9;
        ++v36;
        v13 += 24;
      }
    }
    while ( v9 < a4 );
  }
  while ( 1 )
  {
    v34 = 1;
    if ( a4 <= 0 )
      break;
    v16 = (int)&v43;
    v38 = a4;
    do
    {
      if ( v36 < a2 && sub_541820(v16, (int)&v32, (int)&v33, (int)&v40) )
      {
        v17 = *(_DWORD *)(v7 + 44);
        v34 = 0;
        v18 = 4 * v33;
        v19 = *(_DWORD *)(v17 + 4 * v33) + v32;
        if ( *(_BYTE *)v19 > 100 * rand() / 32767 )
        {
          *(_BYTE *)v19 = 101;
        }
        else
        {
          v20 = a6;
          v21 = 32 * v32 + *(_DWORD *)(*(_DWORD *)(v7 + 16) + v18);
          v22 = (unsigned __int8)sub_53E6E0(v7, a3, v32, v33, a5, a7, a6);
          if ( *(_BYTE *)(v21 + 6) == a6 && v22 > 0 )
          {
            v37 = sub_53E940(v22, v32, v33);
            *(_BYTE *)(v21 + 6) = a3;
            if ( v32 <= 0 )
            {
              v20 = a6;
            }
            else
            {
              if ( *(_BYTE *)(v21 - 26) == a6 )
              {
                v23 = rand();
                v24 = (signed int)(100 * v23 + ((unsigned __int64)(-214741810900i64 * v23) >> 32)) >> 14;
                v35 = ((unsigned int)v24 >> 31) + v24;
                *(float *)&v25 = (double)v35 + v37;
                sub_541790(v7, v16, v32 - 1, v33, 0, v25);
              }
            }
            if ( v32 < v41 && *(_BYTE *)(v21 + 38) == v20 )
            {
              v35 = 100 * rand() / 32767;
              *(float *)&v26 = (double)v35 + v37;
              sub_541790(v7, v16, v32 + 1, v33, 0, v26);
            }
            if ( v33 > 0 && *(_BYTE *)(v21 - 32 * *(_DWORD *)(v7 + 20) + 6) == v20 )
            {
              v35 = 100 * rand() / 32767;
              *(float *)&v27 = (double)v35 + v37;
              sub_541790(v7, v16, v32, v33 - 1, 0, v27);
            }
            if ( v33 < v39 && *(_BYTE *)(32 * *(_DWORD *)(v7 + 20) + v21 + 6) == v20 )
            {
              v35 = 100 * rand() / 32767;
              *(float *)&v28 = (double)v35 + v37;
              sub_541790(v7, v16, v32, v33 + 1, 0, v28);
            }
            ++v36;
          }
        }
      }
      v16 += 24;
      --v38;
    }
    while ( v38 );
    if ( v34 )
    {
      if ( a4 > 0 )
      {
        v29 = (int)&v43;
        v30 = a4;
        do
        {
          sub_541770(v29);
          v29 += 24;
          --v30;
        }
        while ( v30 );
      }
      return 1;
    }
  }
  return 1;
}

//----- (0053EF60) --------------------------------------------------------
int __thiscall sub_53EF60(int this, const char *a2, const char *a3, const char *a4, const char *Filename)
{
  int v5; // ebx@1
  int v6; // edi@1
  FILE *v7; // eax@1
  FILE *v8; // ebp@1
  int v9; // esi@2
  int v10; // ebp@4
  FILE *v11; // eax@11
  FILE *v12; // ebp@11
  int v13; // esi@13
  size_t *v14; // ebx@13
  signed int v15; // ebp@14
  int v16; // edi@15
  int v17; // eax@16
  FILE *v18; // ebp@21
  int v19; // esi@23
  int v20; // ebx@23
  int v21; // edi@25
  FILE *v22; // eax@32
  FILE *v23; // ebp@32
  int v24; // esi@34
  int v25; // ebx@34
  int v26; // edi@36
  int v27; // eax@37
  FILE *File; // [sp+10h] [bp-34h]@1
  FILE *Filea; // [sp+10h] [bp-34h]@11
  int v31; // [sp+14h] [bp-30h]@13
  int v32; // [sp+18h] [bp-2Ch]@1
  int v33; // [sp+1Ch] [bp-28h]@12
  int v34; // [sp+20h] [bp-24h]@22
  int v35; // [sp+24h] [bp-20h]@33
  char v36; // [sp+28h] [bp-1Ch]@16
  char v37; // [sp+2Ch] [bp-18h]@16
  char v38; // [sp+30h] [bp-14h]@16
  char v39; // [sp+34h] [bp-10h]@16
  char v40; // [sp+38h] [bp-Ch]@16
  char v41; // [sp+3Ch] [bp-8h]@37
  char v42; // [sp+40h] [bp-4h]@37
  int Filenamea; // [sp+54h] [bp+10h]@12
  int Filenameb; // [sp+54h] [bp+10h]@22
  int Filenamec; // [sp+54h] [bp+10h]@33

  v5 = 0;
  v6 = this;
  v32 = this;
  _RGE_Random_Map_Module(this, 0, 0, 0);
  *(_DWORD *)v6 = &off_640830;
  *(_DWORD *)(v6 + 56) = 0;
  *(_DWORD *)(v6 + 60) = -1;
  *(_DWORD *)(v6 + 64) = 0;
  v7 = fopen(Filename, "r");
  v8 = v7;
  File = v7;
  if ( !v7 )
  {
    v9 = v6 + 22296;
    *(_DWORD *)(v6 + 22300) = 0;
    *(_DWORD *)(v6 + 22296) = 0;
    goto LABEL_10;
  }
  v9 = v6 + 22296;
  fscanf(v7, " %d", v6 + 22296);
  if ( *(_DWORD *)(v6 + 22296) <= 0 )
  {
    *(_DWORD *)(v6 + 22300) = 0;
    goto LABEL_8;
  }
  *(_DWORD *)(v6 + 22300) = calloc(*(_DWORD *)(v6 + 22296), 72u);
  if ( *(_DWORD *)v9 <= 0 )
  {
LABEL_8:
    fclose(v8);
    goto LABEL_10;
  }
  v10 = 0;
  do
  {
    fscanf(File, "%d", *(_DWORD *)(v6 + 22300) + v10);
    ++v5;
    v10 += 72;
  }
  while ( v5 < *(_DWORD *)v9 );
  v5 = 0;
  fclose(File);
LABEL_10:
  if ( *(_DWORD *)v9 <= v5 )
  {
    *(_DWORD *)v9 = v5;
    *(_DWORD *)(v6 + 22300) = v5;
    return v6;
  }
  v11 = fopen(a2, "r");
  v12 = v11;
  Filea = v11;
  if ( v11 )
  {
    fscanf(v11, "%d", &v33);
    for ( Filenamea = 0; Filenamea < v33; ++Filenamea )
    {
      fscanf(v12, "%d", &v31);
      v13 = *(_DWORD *)(v6 + 22300) + 72 * v31 + 4;
      v14 = (size_t *)(*(_DWORD *)(v6 + 22300) + 72 * v31 + 40);
      fscanf(
        v12,
        "%d %d %d %d %d %d %d %d %d",
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 40,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 4,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 8,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 12,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 16,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 20,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 24,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 28,
        *(_DWORD *)(v6 + 22300) + 72 * v31 + 32);
      if ( (signed int)*v14 <= 0 )
      {
        *(_DWORD *)(v13 + 40) = 0;
      }
      else
      {
        *(_DWORD *)(v13 + 40) = calloc(*v14, 0x2Cu);
        v15 = 0;
        if ( (signed int)*v14 > 0 )
        {
          v16 = 0;
          do
          {
            v17 = v16 + *(_DWORD *)(v13 + 40);
            fscanf(
              Filea,
              "%d %d %d %d %d %d %d %d %d %d %d %d",
              v16 + *(_DWORD *)(v13 + 40),
              &v36,
              v17 + 8,
              v17 + 12,
              &v37,
              &v38,
              v17 + 20,
              v17 + 24,
              &v39,
              &v40,
              v17 + 32,
              v17 + 36);
            ++v15;
            *(_BYTE *)(*(_DWORD *)(v13 + 40) + v16 + 4) = v36;
            *(_BYTE *)(*(_DWORD *)(v13 + 40) + v16 + 16) = v37;
            *(_BYTE *)(*(_DWORD *)(v13 + 40) + v16 + 17) = v38;
            *(_BYTE *)(*(_DWORD *)(v13 + 40) + v16 + 28) = v39;
            *(_BYTE *)(*(_DWORD *)(v13 + 40) + v16 + 29) = v40;
            *(_DWORD *)(*(_DWORD *)(v13 + 40) + v16 + 40) = 8;
            v16 += 44;
          }
          while ( v15 < (signed int)*v14 );
          v6 = v32;
        }
        v12 = Filea;
      }
    }
    fclose(v12);
  }
  v18 = fopen(a3, "r");
  if ( v18 )
  {
    fscanf(v18, "%d", &v34);
    for ( Filenameb = 0; Filenameb < v34; ++Filenameb )
    {
      fscanf(v18, "%d", &v31);
      v19 = *(_DWORD *)(v6 + 22300) + 72 * v31 + 48;
      fscanf(v18, "%d", v19);
      v20 = 0;
      if ( *(_DWORD *)v19 <= 0 )
      {
        *(_DWORD *)(v19 + 4) = 0;
      }
      else
      {
        *(_DWORD *)(v19 + 4) = calloc(*(_DWORD *)v19, 0x18u);
        if ( *(_DWORD *)v19 > 0 )
        {
          v21 = 0;
          do
          {
            fscanf(
              v18,
              "%d %d %d %d %d",
              *(_DWORD *)(v19 + 4) + v21,
              *(_DWORD *)(v19 + 4) + v21 + 4,
              *(_DWORD *)(v19 + 4) + v21 + 8,
              *(_DWORD *)(v19 + 4) + v21 + 12,
              *(_DWORD *)(v19 + 4) + v21 + 16);
            ++v20;
            *(_DWORD *)(*(_DWORD *)(v19 + 4) + v21 + 20) = 20;
            v21 += 24;
          }
          while ( v20 < *(_DWORD *)v19 );
          v6 = v32;
        }
      }
    }
    fclose(v18);
  }
  v22 = fopen(a4, "r");
  v23 = v22;
  if ( !v22 )
    return v6;
  fscanf(v22, "%d", &v35);
  for ( Filenamec = 0; Filenamec < v35; ++Filenamec )
  {
    fscanf(v23, "%d", &v31);
    v24 = *(_DWORD *)(v6 + 22300) + 72 * v31 + 56;
    fscanf(v23, "%d", v24);
    v25 = 0;
    if ( *(_DWORD *)v24 <= 0 )
    {
      *(_DWORD *)(v24 + 4) = 0;
    }
    else
    {
      *(_DWORD *)(v24 + 4) = calloc(*(_DWORD *)v24, 0x2Cu);
      if ( *(_DWORD *)v24 > 0 )
      {
        v26 = 0;
        do
        {
          v27 = v26 + *(_DWORD *)(v24 + 4);
          fscanf(
            v23,
            "%d %d %d %d %d %d %d %d %d %d %d %d",
            v26 + *(_DWORD *)(v24 + 4),
            v27 + 4,
            &v41,
            &v42,
            v27 + 12,
            v27 + 16,
            v27 + 20,
            v27 + 24,
            v27 + 28,
            v27 + 32,
            v27 + 36,
            v27 + 40);
          ++v25;
          *(_BYTE *)(v26 + *(_DWORD *)(v24 + 4) + 8) = v41;
          *(_BYTE *)(v26 + *(_DWORD *)(v24 + 4) + 9) = v42;
          v26 += 44;
        }
        while ( v25 < *(_DWORD *)v24 );
        v6 = v32;
      }
    }
  }
  fclose(v23);
  return v6;
}
// 640830: using guessed type int (__thiscall *off_640830)(void *Memory, char);

//----- (0053F3F0) --------------------------------------------------------
void *__thiscall sub_53F3F0(void *Memory, char a2)
{
  void *v2; // esi@1

  v2 = Memory;
  sub_53F5E0((int)Memory);
  if ( a2 & 1 )
    operator delete(v2);
  return v2;
}
